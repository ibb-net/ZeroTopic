{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"OpenIBBOs Wiki","text":"<p>\u6b22\u8fce\u6765\u5230 OpenIBBOs \u6587\u6863\u4e2d\u5fc3\uff01</p>"},{"location":"#openibbos","title":"\ud83d\ude80 \u5173\u4e8e OpenIBBOs","text":"<p>OpenIBBOs \u662f\u4e00\u4e2a\u4e13\u4e3a\u5d4c\u5165\u5f0f\u5b9e\u65f6\u7cfb\u7edf\u8bbe\u8ba1\u7684\u96f6\u62f7\u8d1d\u901a\u4fe1\u6846\u67b6\uff0c\u57fa\u4e8e\u5bf9\u8c61\u5b57\u5178\u7684\u6570\u636e\u5b58\u50a8\u3001Topic \u603b\u7ebf\u7684\u53d1\u5e03\u8ba2\u9605\u673a\u5236\u548c\u89c4\u5219\u5f15\u64ce\uff0c\u63d0\u4f9b\u9ad8\u6548\u7684\u4e8b\u4ef6\u9a71\u52a8\u901a\u4fe1\u80fd\u529b\u3002</p>"},{"location":"#_1","title":"\u2728 \u6838\u5fc3\u7279\u6027","text":""},{"location":"#_2","title":"\ud83c\udfaf \u96f6\u62f7\u8d1d\u6570\u636e\u4f20\u9012","text":"<ul> <li>\u5bf9\u8c61\u5b57\u5178\u7edf\u4e00\u5b58\u50a8\uff1a\u6240\u6709\u6570\u636e\u96c6\u4e2d\u5b58\u50a8\u5728\u5bf9\u8c61\u5b57\u5178\u4e2d\uff0c\u591a\u8ba2\u9605\u8005\u5171\u4eab\u540c\u4e00\u4efd\u6570\u636e</li> <li>\u6307\u9488\u4f20\u9012\uff1a\u8ba2\u9605\u8005\u56de\u8c03\u76f4\u63a5\u63a5\u6536\u6570\u636e\u6307\u9488\uff0c\u65e0\u9700\u6570\u636e\u62f7\u8d1d</li> <li>\u5185\u5b58\u9ad8\u6548\uff1a\u5355\u4efd\u6570\u636e\uff0c\u591a\u8ba2\u9605\u8005\u5171\u4eab\uff0c\u5927\u5e45\u964d\u4f4e\u5185\u5b58\u5360\u7528</li> </ul>"},{"location":"#topic","title":"\ud83d\udce1 Topic \u603b\u7ebf\u67b6\u6784","text":"<ul> <li>\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\uff1a\u57fa\u4e8e Topic ID \u7684\u677e\u8026\u5408\u901a\u4fe1</li> <li>\u89c4\u5219\u5f15\u64ce\uff1a\u652f\u6301 OR/AND/MANUAL \u4e09\u79cd\u89c4\u5219\u7c7b\u578b</li> <li>\u65f6\u6548\u6027\u68c0\u67e5\uff1a\u53ef\u914d\u7f6e\u4e8b\u4ef6\u8d85\u65f6\u65f6\u95f4\uff0c\u786e\u4fdd\u6570\u636e\u65f6\u6548\u6027</li> <li>ISR \u5b89\u5168\uff1a\u652f\u6301\u4e2d\u65ad\u4e0a\u4e0b\u6587\u53d1\u5e03\u4e8b\u4ef6</li> </ul>"},{"location":"#_3","title":"\ud83d\udd27 \u89c4\u5219\u5904\u7406\u673a\u5236","text":"<ul> <li>OR \u89c4\u5219\uff1a\u4efb\u4e00\u4e8b\u4ef6\u89e6\u53d1\u5373\u53ef\u53d1\u5e03 Topic</li> <li>AND \u89c4\u5219\uff1a\u5168\u90e8\u4e8b\u4ef6\u89e6\u53d1\u540e\u624d\u53d1\u5e03 Topic</li> <li>MANUAL \u89c4\u5219\uff1a\u624b\u52a8\u89e6\u53d1 Topic \u53d1\u5e03</li> <li>\u8d85\u65f6\u63a7\u5236\uff1a\u652f\u6301\u4e8b\u4ef6\u65f6\u6548\u6027\u68c0\u67e5</li> </ul>"},{"location":"#_4","title":"\ud83d\udcda \u6587\u6863\u5bfc\u822a","text":""},{"location":"#_5","title":"\u5feb\u901f\u5f00\u59cb","text":"<ul> <li>\u5feb\u901f\u5f00\u59cb\u6307\u5357 - 5\u5206\u949f\u5feb\u901f\u4e0a\u624b</li> <li>\u5b89\u88c5\u6307\u5357 - \u8be6\u7ec6\u7684\u5b89\u88c5\u548c\u914d\u7f6e\u6b65\u9aa4</li> </ul>"},{"location":"#_6","title":"\u6838\u5fc3\u6982\u5ff5","text":"<ul> <li>Topic \u603b\u7ebf - \u53d1\u5e03\u8ba2\u9605\u901a\u4fe1\u673a\u5236</li> <li>\u5bf9\u8c61\u5b57\u5178 - \u7edf\u4e00\u6570\u636e\u5b58\u50a8</li> <li>\u73af\u5f62\u7f13\u51b2\u533a - \u9ad8\u6548\u7f13\u51b2\u533a\u5b9e\u73b0</li> </ul>"},{"location":"#_7","title":"\u67b6\u6784\u8bbe\u8ba1","text":"<ul> <li>\u786c\u4ef6\u7ebf\u7a0b vs \u76f4\u63a5API\u5206\u6790</li> <li>MCU\u786c\u4ef6\u4f18\u5316\u5206\u6790</li> <li>\u591aMCU microROS\u901a\u4fe1</li> </ul>"},{"location":"#_8","title":"\ud83d\udd17 \u76f8\u5173\u8d44\u6e90","text":"<ul> <li>GitHub \u4ed3\u5e93</li> <li>\u95ee\u9898\u53cd\u9988</li> <li>\u8d21\u732e\u6307\u5357</li> </ul>"},{"location":"#_9","title":"\ud83d\udcc4 \u8bb8\u53ef\u8bc1","text":"<p>\u672c\u9879\u76ee\u91c7\u7528 MIT License\u3002</p> <p>\u6700\u540e\u66f4\u65b0: 2025\u5e7411\u67085\u65e5</p>"},{"location":"CHANGELOG/","title":"\u53d8\u66f4\u65e5\u5fd7","text":"<p>\u6240\u6709\u91cd\u8981\u7684\u9879\u76ee\u53d8\u66f4\u90fd\u4f1a\u8bb0\u5f55\u5728\u6b64\u6587\u4ef6\u4e2d\u3002</p> <p>\u672c\u9879\u76ee\u9075\u5faa \u8bed\u4e49\u5316\u7248\u672c \u89c4\u8303\u3002</p>"},{"location":"CHANGELOG/#_2","title":"[\u672a\u53d1\u5e03]","text":""},{"location":"CHANGELOG/#_3","title":"\u8ba1\u5212\u4e2d","text":"<ul> <li>Service/Action \u67b6\u6784\u652f\u6301</li> <li>MQTT \u534f\u8bae\u9002\u914d</li> <li>microROS \u534f\u8bae\u9002\u914d</li> <li>\u4f20\u7edf API \u8c03\u7528\u8f6c\u670d\u52a1\u5316\u6539\u9020</li> </ul>"},{"location":"CHANGELOG/#010-2025-01-xx","title":"[0.1.0] - 2025-01-XX","text":""},{"location":"CHANGELOG/#_4","title":"\u65b0\u589e","text":"<ul> <li>\u2705 \u5bf9\u8c61\u5b57\u5178\uff08Object Dictionary\uff09\u6a21\u5757</li> <li>\u7edf\u4e00\u6570\u636e\u5b58\u50a8\u7ba1\u7406</li> <li>\u7248\u672c\u53f7\u673a\u5236\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027</li> <li>\u65f6\u95f4\u6233\u8ffd\u8e2a</li> <li> <p>\u96f6\u62f7\u8d1d\u6570\u636e\u8bbf\u95ee</p> </li> <li> <p>\u2705 Topic \u603b\u7ebf\uff08Topic Bus\uff09\u6a21\u5757</p> </li> <li>\u53d1\u5e03\u8ba2\u9605\u673a\u5236</li> <li>\u591a\u8ba2\u9605\u8005\u652f\u6301</li> <li>ISR \u5b89\u5168\u53d1\u5e03\u8def\u5f84</li> <li> <p>\u4e8b\u4ef6\u9a71\u52a8\u901a\u4fe1</p> </li> <li> <p>\u2705 \u89c4\u5219\u5f15\u64ce\uff08Rules Engine\uff09\u6a21\u5757</p> </li> <li>OR \u89c4\u5219\uff1a\u4efb\u4e00\u4e8b\u4ef6\u89e6\u53d1</li> <li>AND \u89c4\u5219\uff1a\u5168\u90e8\u4e8b\u4ef6\u89e6\u53d1</li> <li>MANUAL \u89c4\u5219\uff1a\u624b\u52a8\u89e6\u53d1</li> <li> <p>\u4e8b\u4ef6\u65f6\u6548\u6027\u68c0\u67e5</p> </li> <li> <p>\u2705 Topic \u8def\u7531\uff08Topic Router\uff09\u6a21\u5757</p> </li> <li>VFB \u8def\u7531\u652f\u6301</li> <li>\u81ea\u5b9a\u4e49\u8def\u7531\u56de\u8c03</li> <li> <p>\u591a\u8def\u7531\u652f\u6301</p> </li> <li> <p>\u2705 \u6027\u80fd\u6d4b\u8bd5</p> </li> <li>\u57fa\u7840\u529f\u80fd\u6d4b\u8bd5</li> <li>\u4e8b\u4ef6\u53d1\u5e03\u5ef6\u8fdf\u6d4b\u8bd5</li> <li>\u89c4\u5219\u5339\u914d\u6027\u80fd\u6d4b\u8bd5</li> <li>\u5e76\u53d1\u6d4b\u8bd5</li> </ul>"},{"location":"CHANGELOG/#_5","title":"\u6587\u6863","text":"<ul> <li>\u2705 \u9879\u76ee README</li> <li>\u2705 \u67b6\u6784\u8bbe\u8ba1\u6587\u6863</li> <li>\u2705 API \u53c2\u8003\u6587\u6863</li> <li>\u2705 \u4f7f\u7528\u793a\u4f8b</li> </ul>"},{"location":"CHANGELOG/#_6","title":"\u7248\u672c\u8bf4\u660e","text":""},{"location":"CHANGELOG/#_7","title":"\u7248\u672c\u683c\u5f0f\uff1a\u4e3b\u7248\u672c\u53f7.\u6b21\u7248\u672c\u53f7.\u4fee\u8ba2\u53f7","text":"<ul> <li>\u4e3b\u7248\u672c\u53f7\uff1a\u4e0d\u517c\u5bb9\u7684 API \u4fee\u6539</li> <li>\u6b21\u7248\u672c\u53f7\uff1a\u5411\u4e0b\u517c\u5bb9\u7684\u529f\u80fd\u6027\u65b0\u589e</li> <li>\u4fee\u8ba2\u53f7\uff1a\u5411\u4e0b\u517c\u5bb9\u7684\u95ee\u9898\u4fee\u6b63</li> </ul>"},{"location":"CHANGELOG/#_8","title":"\u53d8\u66f4\u7c7b\u578b","text":"<ul> <li><code>Added</code>\uff1a\u65b0\u529f\u80fd</li> <li><code>Changed</code>\uff1a\u5bf9\u73b0\u6709\u529f\u80fd\u7684\u53d8\u66f4</li> <li><code>Deprecated</code>\uff1a\u5373\u5c06\u79fb\u9664\u7684\u529f\u80fd</li> <li><code>Removed</code>\uff1a\u5df2\u79fb\u9664\u7684\u529f\u80fd</li> <li><code>Fixed</code>\uff1aBug \u4fee\u590d</li> <li><code>Security</code>\uff1a\u5b89\u5168\u76f8\u5173\u7684\u4fee\u590d</li> </ul>"},{"location":"CONTRIBUTING/","title":"\u8d21\u732e\u6307\u5357","text":"<p>\u611f\u8c22\u60a8\u5bf9 ZeroTopic \u9879\u76ee\u7684\u5173\u6ce8\uff01\u6211\u4eec\u6b22\u8fce\u6240\u6709\u5f62\u5f0f\u7684\u8d21\u732e\u3002</p>"},{"location":"CONTRIBUTING/#_2","title":"\ud83d\udccb \u76ee\u5f55","text":"<ul> <li>\u884c\u4e3a\u51c6\u5219</li> <li>\u5982\u4f55\u8d21\u732e</li> <li>\u62a5\u544a\u95ee\u9898</li> <li>\u63d0\u4ea4\u529f\u80fd\u8bf7\u6c42</li> <li>\u63d0\u4ea4\u4ee3\u7801</li> <li>\u5f00\u53d1\u73af\u5883\u8bbe\u7f6e</li> <li>\u4ee3\u7801\u89c4\u8303</li> <li>\u63d0\u4ea4\u89c4\u8303</li> </ul>"},{"location":"CONTRIBUTING/#_3","title":"\u884c\u4e3a\u51c6\u5219","text":"<p>\u672c\u9879\u76ee\u9075\u5faa\u8d21\u732e\u8005\u884c\u4e3a\u51c6\u5219\u3002\u53c2\u4e0e\u9879\u76ee\u65f6\uff0c\u8bf7\u4fdd\u6301\u5c0a\u91cd\u548c\u5305\u5bb9\u3002</p>"},{"location":"CONTRIBUTING/#_4","title":"\u5982\u4f55\u8d21\u732e","text":""},{"location":"CONTRIBUTING/#_5","title":"\u62a5\u544a\u95ee\u9898","text":"<p>\u5982\u679c\u60a8\u53d1\u73b0\u4e86\u4e00\u4e2a bug\uff0c\u8bf7\uff1a</p> <ol> <li>\u68c0\u67e5\u73b0\u6709\u95ee\u9898\uff1a\u5728\u63d0\u4ea4\u65b0\u95ee\u9898\u524d\uff0c\u8bf7\u5148\u67e5\u770b Issues \u786e\u8ba4\u95ee\u9898\u672a\u88ab\u62a5\u544a</li> <li>\u521b\u5efa\u65b0 Issue\uff1a\u4f7f\u7528 Bug Report \u6a21\u677f</li> <li>\u63d0\u4f9b\u8be6\u7ec6\u4fe1\u606f\uff1a</li> <li>\u95ee\u9898\u63cf\u8ff0</li> <li>\u590d\u73b0\u6b65\u9aa4</li> <li>\u9884\u671f\u884c\u4e3a</li> <li>\u5b9e\u9645\u884c\u4e3a</li> <li>\u73af\u5883\u4fe1\u606f\uff08OS\u3001\u7f16\u8bd1\u5668\u7248\u672c\u7b49\uff09</li> <li>\u76f8\u5173\u4ee3\u7801\u7247\u6bb5</li> </ol>"},{"location":"CONTRIBUTING/#_6","title":"\u63d0\u4ea4\u529f\u80fd\u8bf7\u6c42","text":"<p>\u5982\u679c\u60a8\u6709\u65b0\u7684\u529f\u80fd\u60f3\u6cd5\uff1a</p> <ol> <li>\u68c0\u67e5\u73b0\u6709\u529f\u80fd\u8bf7\u6c42\uff1a\u786e\u8ba4\u529f\u80fd\u672a\u88ab\u63d0\u51fa</li> <li>\u521b\u5efa\u65b0 Issue\uff1a\u4f7f\u7528 Feature Request \u6a21\u677f</li> <li>\u8be6\u7ec6\u63cf\u8ff0\uff1a</li> <li>\u529f\u80fd\u63cf\u8ff0</li> <li>\u4f7f\u7528\u573a\u666f</li> <li>\u9884\u671f\u6548\u679c</li> <li>\u53ef\u80fd\u7684\u5b9e\u73b0\u65b9\u6848</li> </ol>"},{"location":"CONTRIBUTING/#_7","title":"\u63d0\u4ea4\u4ee3\u7801","text":""},{"location":"CONTRIBUTING/#1-fork","title":"1. Fork \u9879\u76ee","text":"<p>\u70b9\u51fb GitHub \u9875\u9762\u4e0a\u7684 \"Fork\" \u6309\u94ae\uff0c\u521b\u5efa\u60a8\u81ea\u5df1\u7684\u9879\u76ee\u526f\u672c\u3002</p>"},{"location":"CONTRIBUTING/#2","title":"2. \u514b\u9686\u4ed3\u5e93","text":"<pre><code>git clone https://github.com/yourusername/ZeroTopic.git\ncd ZeroTopic\n</code></pre>"},{"location":"CONTRIBUTING/#3","title":"3. \u521b\u5efa\u5206\u652f","text":"<pre><code>git checkout -b feature/your-feature-name\n# \u6216\ngit checkout -b fix/your-bug-fix\n</code></pre>"},{"location":"CONTRIBUTING/#4","title":"4. \u8fdb\u884c\u4fee\u6539","text":"<ul> <li>\u9075\u5faa\u4ee3\u7801\u89c4\u8303</li> <li>\u6dfb\u52a0\u5fc5\u8981\u7684\u6ce8\u91ca</li> <li>\u66f4\u65b0\u76f8\u5173\u6587\u6863</li> <li>\u6dfb\u52a0\u6d4b\u8bd5\u7528\u4f8b\uff08\u5982\u9002\u7528\uff09</li> </ul>"},{"location":"CONTRIBUTING/#5","title":"5. \u63d0\u4ea4\u66f4\u6539","text":"<pre><code>git add .\ngit commit -m \"feat: add your feature description\"\n</code></pre> <p>\u9075\u5faa \u63d0\u4ea4\u89c4\u8303\u3002</p>"},{"location":"CONTRIBUTING/#6-fork","title":"6. \u63a8\u9001\u5230 Fork","text":"<pre><code>git push origin feature/your-feature-name\n</code></pre>"},{"location":"CONTRIBUTING/#7-pull-request","title":"7. \u521b\u5efa Pull Request","text":"<ol> <li>\u5728 GitHub \u4e0a\u6253\u5f00\u60a8\u7684 Fork</li> <li>\u70b9\u51fb \"New Pull Request\"</li> <li>\u9009\u62e9\u60a8\u7684\u5206\u652f</li> <li>\u586b\u5199 PR \u63cf\u8ff0\uff0c\u4f7f\u7528 PR \u6a21\u677f</li> <li>\u7b49\u5f85\u4ee3\u7801\u5ba1\u67e5</li> </ol>"},{"location":"CONTRIBUTING/#_8","title":"\u5f00\u53d1\u73af\u5883\u8bbe\u7f6e","text":""},{"location":"CONTRIBUTING/#_9","title":"\u73af\u5883\u8981\u6c42","text":"<ul> <li>\u7f16\u8bd1\u5668\uff1aGCC 11.3.1 \u6216\u66f4\u9ad8\u7248\u672c\uff08ARM Cortex-M\uff09</li> <li>\u6784\u5efa\u7cfb\u7edf\uff1aCMake 3.20 \u6216\u66f4\u9ad8\u7248\u672c</li> <li>\u8c03\u8bd5\u5de5\u5177\uff1aOpenOCD\uff08\u53ef\u9009\uff09</li> </ul>"},{"location":"CONTRIBUTING/#_10","title":"\u6784\u5efa\u6b65\u9aa4","text":"<pre><code>mkdir build\ncd build\ncmake ..\nmake\n</code></pre>"},{"location":"CONTRIBUTING/#_11","title":"\u8fd0\u884c\u6d4b\u8bd5","text":"<pre><code>make test\n</code></pre>"},{"location":"CONTRIBUTING/#_12","title":"\u4ee3\u7801\u89c4\u8303","text":""},{"location":"CONTRIBUTING/#c","title":"C \u4ee3\u7801\u98ce\u683c","text":"<ul> <li>\u7f29\u8fdb\uff1a\u4f7f\u7528 4 \u4e2a\u7a7a\u683c</li> <li>\u547d\u540d\uff1a\u4f7f\u7528\u4e0b\u5212\u7ebf\u547d\u540d\uff08snake_case\uff09</li> <li>\u51fd\u6570\u547d\u540d\uff1a<code>\u6a21\u5757\u540d_\u529f\u80fd\u540d</code>\uff0c\u5982 <code>topic_bus_init</code></li> <li>\u7c7b\u578b\u547d\u540d\uff1a<code>\u7c7b\u578b\u540d_t</code>\uff0c\u5982 <code>topic_bus_t</code></li> <li>\u5e38\u91cf\u547d\u540d\uff1a\u5168\u5927\u5199\uff0c\u5982 <code>MAX_TOPICS</code></li> </ul>"},{"location":"CONTRIBUTING/#_13","title":"\u793a\u4f8b\u4ee3\u7801","text":"<pre><code>/*\n * @brief \u521d\u59cb\u5316 Topic \u603b\u7ebf\n * @param bus Topic \u603b\u7ebf\u6307\u9488\n * @param topics Topic \u6761\u76ee\u6570\u7ec4\n * @param max_topics \u6700\u5927 Topic \u6570\u91cf\n * @param dict \u5173\u8054\u7684\u5bf9\u8c61\u5b57\u5178\n * @return 0 \u6210\u529f\uff0c-1 \u5931\u8d25\n */\nint topic_bus_init(topic_bus_t* bus, topic_entry_t* topics, \n                   size_t max_topics, obj_dict_t* dict) {\n    if (!bus || !topics || max_topics == 0 || !dict) {\n        return -1;\n    }\n    // \u5b9e\u73b0...\n    return 0;\n}\n</code></pre>"},{"location":"CONTRIBUTING/#_14","title":"\u6587\u6863\u6ce8\u91ca","text":"<ul> <li>\u4f7f\u7528 Doxygen \u98ce\u683c\u6ce8\u91ca</li> <li>\u4e3a\u6240\u6709\u516c\u5171 API \u6dfb\u52a0\u6587\u6863</li> <li>\u8bf4\u660e\u53c2\u6570\u3001\u8fd4\u56de\u503c\u3001\u9519\u8bef\u60c5\u51b5</li> </ul>"},{"location":"CONTRIBUTING/#_15","title":"\u63d0\u4ea4\u89c4\u8303","text":"<p>\u6211\u4eec\u4f7f\u7528 Conventional Commits \u89c4\u8303\uff1a</p>"},{"location":"CONTRIBUTING/#_16","title":"\u63d0\u4ea4\u7c7b\u578b","text":"<ul> <li><code>feat</code>: \u65b0\u529f\u80fd</li> <li><code>fix</code>: Bug \u4fee\u590d</li> <li><code>docs</code>: \u6587\u6863\u66f4\u65b0</li> <li><code>style</code>: \u4ee3\u7801\u683c\u5f0f\u8c03\u6574\uff08\u4e0d\u5f71\u54cd\u529f\u80fd\uff09</li> <li><code>refactor</code>: \u4ee3\u7801\u91cd\u6784</li> <li><code>test</code>: \u6d4b\u8bd5\u76f8\u5173</li> <li><code>chore</code>: \u6784\u5efa\u8fc7\u7a0b\u6216\u8f85\u52a9\u5de5\u5177\u7684\u53d8\u52a8</li> </ul>"},{"location":"CONTRIBUTING/#_17","title":"\u63d0\u4ea4\u683c\u5f0f","text":"<pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;\n\n&lt;body&gt;\n\n&lt;footer&gt;\n</code></pre>"},{"location":"CONTRIBUTING/#_18","title":"\u793a\u4f8b","text":"<pre><code>feat(topic_bus): add timeout support for AND rules\n\nAdd event timeout checking mechanism for AND rules to ensure\ndata freshness. Each event can have its own timeout configuration.\n\nCloses #123\n</code></pre>"},{"location":"CONTRIBUTING/#_19","title":"\u4ee3\u7801\u5ba1\u67e5\u6d41\u7a0b","text":"<ol> <li>\u81ea\u52a8\u5316\u68c0\u67e5\uff1aPR \u63d0\u4ea4\u540e\u4f1a\u81ea\u52a8\u8fd0\u884c CI \u68c0\u67e5</li> <li>\u4ee3\u7801\u5ba1\u67e5\uff1a\u7ef4\u62a4\u8005\u4f1a\u5ba1\u67e5\u4ee3\u7801</li> <li>\u53cd\u9988\u548c\u4fee\u6539\uff1a\u6839\u636e\u53cd\u9988\u8fdb\u884c\u4fee\u6539</li> <li>\u5408\u5e76\uff1a\u5ba1\u67e5\u901a\u8fc7\u540e\u5408\u5e76\u5230\u4e3b\u5206\u652f</li> </ol>"},{"location":"CONTRIBUTING/#_20","title":"\u95ee\u9898\u53cd\u9988","text":"<p>\u5982\u679c\u60a8\u5728\u8d21\u732e\u8fc7\u7a0b\u4e2d\u9047\u5230\u95ee\u9898\uff0c\u53ef\u4ee5\uff1a</p> <ul> <li>\u5728 Issues \u4e2d\u63d0\u95ee</li> <li>\u67e5\u770b\u73b0\u6709\u6587\u6863</li> <li>\u8054\u7cfb\u7ef4\u62a4\u8005</li> </ul> <p>\u611f\u8c22\u60a8\u7684\u8d21\u732e\uff01\ud83c\udf89</p>"},{"location":"DOCS_README/","title":"Wiki \u6587\u6863\u4f7f\u7528\u6307\u5357","text":"<p>\u672c\u6587\u6863\u8bf4\u660e\u5982\u4f55\u5728\u4ee3\u7801\u4ed3\u5e93\u4e2d\u4f7f\u7528\u548c\u7ef4\u62a4 Wiki \u6587\u6863\u7cfb\u7edf\u3002</p>"},{"location":"DOCS_README/#_1","title":"\ud83d\udcd6 \u6982\u8ff0","text":"<p>\u672c\u9879\u76ee\u4f7f\u7528 MkDocs + Material Theme \u6784\u5efa\u6587\u6863\u7ad9\u70b9\uff0c\u652f\u6301\uff1a</p> <ul> <li>\u2705 \u57fa\u4e8e Markdown \u7f16\u5199\u6587\u6863</li> <li>\u2705 \u81ea\u52a8\u751f\u6210\u7f8e\u89c2\u7684\u7f51\u7ad9</li> <li>\u2705 \u652f\u6301\u641c\u7d22\u529f\u80fd</li> <li>\u2705 \u54cd\u5e94\u5f0f\u8bbe\u8ba1\uff0c\u652f\u6301\u79fb\u52a8\u7aef</li> <li>\u2705 \u81ea\u52a8\u90e8\u7f72\u5230 GitHub Pages</li> </ul>"},{"location":"DOCS_README/#_2","title":"\ud83d\ude80 \u5feb\u901f\u5f00\u59cb","text":""},{"location":"DOCS_README/#_3","title":"\u672c\u5730\u9884\u89c8\u6587\u6863","text":"<ol> <li>\u5b89\u88c5\u4f9d\u8d56</li> </ol> <pre><code>pip install -r requirements-docs.txt\n</code></pre> <ol> <li>\u542f\u52a8\u5f00\u53d1\u670d\u52a1\u5668</li> </ol> <pre><code>mkdocs serve\n</code></pre> <ol> <li>\u8bbf\u95ee\u6587\u6863</li> </ol> <p>\u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95ee http://127.0.0.1:8000</p>"},{"location":"DOCS_README/#_4","title":"\u6784\u5efa\u9759\u6001\u7ad9\u70b9","text":"<pre><code>mkdocs build\n</code></pre> <p>\u751f\u6210\u7684\u9759\u6001\u6587\u4ef6\u5728 <code>site/</code> \u76ee\u5f55\u4e2d\u3002</p>"},{"location":"DOCS_README/#_5","title":"\ud83d\udcdd \u7f16\u5199\u6587\u6863","text":""},{"location":"DOCS_README/#_6","title":"\u6587\u6863\u76ee\u5f55\u7ed3\u6784","text":"<pre><code>docs/\n\u251c\u2500\u2500 index.md              # \u9996\u9875\n\u251c\u2500\u2500 getting-started.md    # \u5feb\u901f\u5f00\u59cb\n\u251c\u2500\u2500 installation.md       # \u5b89\u88c5\u6307\u5357\n\u2514\u2500\u2500 ...                   # \u5176\u4ed6\u6587\u6863\n</code></pre>"},{"location":"DOCS_README/#_7","title":"\u6dfb\u52a0\u65b0\u6587\u6863","text":"<ol> <li>\u521b\u5efa Markdown \u6587\u4ef6</li> </ol> <p>\u5728 <code>docs/</code> \u76ee\u5f55\u4e0b\u521b\u5efa\u65b0\u7684 <code>.md</code> \u6587\u4ef6\uff0c\u4f8b\u5982\uff1a</p> <pre><code>docs/new-feature.md\n</code></pre> <ol> <li>\u66f4\u65b0\u5bfc\u822a</li> </ol> <p>\u7f16\u8f91 <code>mkdocs.yml</code> \u6587\u4ef6\uff0c\u5728 <code>nav</code> \u90e8\u5206\u6dfb\u52a0\u65b0\u6587\u6863\uff1a</p> <pre><code>nav:\n  - \u9996\u9875: index.md\n  - \u65b0\u529f\u80fd: new-feature.md  # \u6dfb\u52a0\u8fd9\u4e00\u884c\n</code></pre> <ol> <li>\u7f16\u5199\u5185\u5bb9</li> </ol> <p>\u4f7f\u7528 Markdown \u8bed\u6cd5\u7f16\u5199\u6587\u6863\u5185\u5bb9\u3002</p>"},{"location":"DOCS_README/#_8","title":"\u5f15\u7528\u73b0\u6709\u6587\u6863","text":"<p>\u5982\u679c\u6587\u6863\u5728\u5176\u4ed6\u76ee\u5f55\uff08\u5982 <code>zero_topic_core/topic_bus/topic_bus.md</code>\uff09\uff0c\u76f4\u63a5\u5728\u5bfc\u822a\u4e2d\u5f15\u7528\uff1a</p> <pre><code>nav:\n  - \u6838\u5fc3\u6982\u5ff5:\n    - Topic \u603b\u7ebf: zero_topic_core/topic_bus/topic_bus.md\n</code></pre>"},{"location":"DOCS_README/#markdown","title":"Markdown \u6269\u5c55\u529f\u80fd","text":"<p>MkDocs Material \u652f\u6301\u4e30\u5bcc\u7684 Markdown \u6269\u5c55\uff1a</p>"},{"location":"DOCS_README/#_9","title":"\u4ee3\u7801\u5757","text":"<pre><code>```c\n#include &lt;stdio.h&gt;\nint main() {\n    return 0;\n}\n```\n</code></pre>"},{"location":"DOCS_README/#_10","title":"\u63d0\u793a\u6846","text":"<pre><code>!!! note \"\u63d0\u793a\"\n    \u8fd9\u662f\u4e00\u4e2a\u63d0\u793a\u4fe1\u606f\u3002\n\n!!! warning \"\u8b66\u544a\"\n    \u8fd9\u662f\u4e00\u4e2a\u8b66\u544a\u4fe1\u606f\u3002\n\n!!! danger \"\u5371\u9669\"\n    \u8fd9\u662f\u4e00\u4e2a\u5371\u9669\u63d0\u793a\u3002\n</code></pre>"},{"location":"DOCS_README/#_11","title":"\u6807\u7b7e\u9875","text":"<pre><code>=== \"C\"\n\n    ```c\n    printf(\"Hello\");\n    ```\n\n=== \"Python\"\n\n    ```python\n    print(\"Hello\")\n    ```\n</code></pre>"},{"location":"DOCS_README/#_12","title":"\u6298\u53e0\u5185\u5bb9","text":"<pre><code>??? note \"\u70b9\u51fb\u5c55\u5f00\"\n    \u8fd9\u662f\u6298\u53e0\u7684\u5185\u5bb9\u3002\n</code></pre>"},{"location":"DOCS_README/#_13","title":"\ud83d\udd27 \u914d\u7f6e\u8bf4\u660e","text":"<p>\u4e3b\u8981\u914d\u7f6e\u6587\u4ef6\u662f <code>mkdocs.yml</code>\uff0c\u5305\u542b\uff1a</p> <ul> <li>\u7ad9\u70b9\u4fe1\u606f: \u540d\u79f0\u3001\u63cf\u8ff0\u3001\u4f5c\u8005\u7b49</li> <li>\u4e3b\u9898\u914d\u7f6e: Material \u4e3b\u9898\u8bbe\u7f6e</li> <li>\u5bfc\u822a\u7ed3\u6784: \u6587\u6863\u5bfc\u822a\u83dc\u5355</li> <li>\u63d2\u4ef6\u914d\u7f6e: \u641c\u7d22\u3001Git \u65e5\u671f\u7b49\u63d2\u4ef6</li> </ul> <p>\u8be6\u7ec6\u914d\u7f6e\u8bf4\u660e\u8bf7\u53c2\u8003 MkDocs \u6587\u6863\u3002</p>"},{"location":"DOCS_README/#_14","title":"\ud83c\udf10 \u90e8\u7f72\u6587\u6863","text":""},{"location":"DOCS_README/#_15","title":"\u81ea\u52a8\u90e8\u7f72\uff08\u63a8\u8350\uff09","text":"<p>\u6587\u6863\u4f1a\u81ea\u52a8\u90e8\u7f72\u5230 GitHub Pages\uff1a</p> <ol> <li>\u63a8\u9001\u4ee3\u7801\u5230 <code>main</code> \u6216 <code>master</code> \u5206\u652f</li> <li>GitHub Actions \u4f1a\u81ea\u52a8\u6784\u5efa\u548c\u90e8\u7f72</li> <li>\u8bbf\u95ee <code>https://yourusername.github.io/OpenIBBOs</code> \u67e5\u770b\u6587\u6863</li> </ol>"},{"location":"DOCS_README/#_16","title":"\u624b\u52a8\u90e8\u7f72","text":"<pre><code>mkdocs gh-deploy\n</code></pre>"},{"location":"DOCS_README/#_17","title":"\u81ea\u5b9a\u4e49\u57df\u540d","text":"<ol> <li>\u5728\u4ed3\u5e93\u8bbe\u7f6e\u4e2d\u914d\u7f6e GitHub Pages \u81ea\u5b9a\u4e49\u57df\u540d</li> <li>\u66f4\u65b0 <code>mkdocs.yml</code> \u4e2d\u7684 <code>site_url</code>\uff1a</li> </ol> <pre><code>site_url: https://docs.yourdomain.com\n</code></pre>"},{"location":"DOCS_README/#_18","title":"\ud83d\udccb \u6587\u6863\u89c4\u8303","text":""},{"location":"DOCS_README/#_19","title":"\u6587\u4ef6\u547d\u540d","text":"<ul> <li>\u4f7f\u7528\u5c0f\u5199\u5b57\u6bcd\u548c\u8fde\u5b57\u7b26\uff1a<code>getting-started.md</code></li> <li>\u907f\u514d\u4f7f\u7528\u7a7a\u683c\u548c\u7279\u6b8a\u5b57\u7b26</li> </ul>"},{"location":"DOCS_README/#_20","title":"\u6587\u6863\u7ed3\u6784","text":"<p>\u6bcf\u4e2a\u6587\u6863\u5e94\u5305\u542b\uff1a</p> <pre><code># \u6807\u9898\n\n\u7b80\u8981\u4ecb\u7ecd\n\n## \u7ae0\u82821\n\n\u5185\u5bb9...\n\n## \u7ae0\u82822\n\n\u5185\u5bb9...\n\n## \u76f8\u5173\u94fe\u63a5\n\n- [\u94fe\u63a51](url1)\n- [\u94fe\u63a52](url2)\n</code></pre>"},{"location":"DOCS_README/#_21","title":"\u4ee3\u7801\u793a\u4f8b","text":"<ul> <li>\u4f7f\u7528\u8bed\u6cd5\u9ad8\u4eae</li> <li>\u63d0\u4f9b\u5b8c\u6574\u7684\u53ef\u8fd0\u884c\u793a\u4f8b</li> <li>\u6dfb\u52a0\u5fc5\u8981\u7684\u6ce8\u91ca</li> </ul>"},{"location":"DOCS_README/#_22","title":"\u56fe\u7247\u548c\u8d44\u6e90","text":"<p>\u5c06\u56fe\u7247\u653e\u5728 <code>docs/images/</code> \u76ee\u5f55\uff0c\u4f7f\u7528\u76f8\u5bf9\u8def\u5f84\u5f15\u7528\uff1a</p> <pre><code>![\u56fe\u7247\u63cf\u8ff0](images/example.png)\n</code></pre>"},{"location":"DOCS_README/#_23","title":"\ud83d\udd0d \u641c\u7d22\u529f\u80fd","text":"<p>\u6587\u6863\u7ad9\u70b9\u5185\u7f6e\u5168\u6587\u641c\u7d22\u529f\u80fd\uff1a</p> <ul> <li>\u652f\u6301\u4e2d\u6587\u641c\u7d22</li> <li>\u641c\u7d22\u6807\u9898\u548c\u5185\u5bb9</li> <li>\u81ea\u52a8\u9ad8\u4eae\u5339\u914d\u7ed3\u679c</li> </ul>"},{"location":"DOCS_README/#_24","title":"\ud83d\udc1b \u6545\u969c\u6392\u9664","text":""},{"location":"DOCS_README/#_25","title":"\u672c\u5730\u9884\u89c8\u65e0\u6cd5\u8bbf\u95ee","text":"<ul> <li>\u68c0\u67e5\u7aef\u53e3\u662f\u5426\u88ab\u5360\u7528</li> <li>\u5c1d\u8bd5\u4f7f\u7528 <code>mkdocs serve -a 0.0.0.0:8000</code></li> </ul>"},{"location":"DOCS_README/#_26","title":"\u6784\u5efa\u9519\u8bef","text":"<ul> <li>\u68c0\u67e5 <code>mkdocs.yml</code> \u8bed\u6cd5</li> <li>\u786e\u8ba4\u6240\u6709\u5f15\u7528\u7684\u6587\u4ef6\u5b58\u5728</li> <li>\u67e5\u770b\u9519\u8bef\u65e5\u5fd7\u5b9a\u4f4d\u95ee\u9898</li> </ul>"},{"location":"DOCS_README/#_27","title":"\u90e8\u7f72\u5931\u8d25","text":"<ul> <li>\u68c0\u67e5 GitHub Actions \u65e5\u5fd7</li> <li>\u786e\u8ba4 GitHub Pages \u5df2\u542f\u7528</li> <li>\u9a8c\u8bc1\u4ed3\u5e93\u6743\u9650\u8bbe\u7f6e</li> </ul>"},{"location":"DOCS_README/#_28","title":"\ud83d\udcda \u66f4\u591a\u8d44\u6e90","text":"<ul> <li>MkDocs \u5b98\u65b9\u6587\u6863</li> <li>Material for MkDocs</li> <li>Markdown \u8bed\u6cd5\u6307\u5357</li> </ul>"},{"location":"DOCS_README/#_29","title":"\ud83d\udca1 \u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>\u5b9a\u671f\u66f4\u65b0: \u4fdd\u6301\u6587\u6863\u4e0e\u4ee3\u7801\u540c\u6b65</li> <li>\u6e05\u6670\u7ed3\u6784: \u4f7f\u7528\u5408\u7406\u7684\u7ae0\u8282\u5c42\u6b21</li> <li>\u793a\u4f8b\u4ee3\u7801: \u63d0\u4f9b\u53ef\u8fd0\u884c\u7684\u4ee3\u7801\u793a\u4f8b</li> <li>\u94fe\u63a5\u68c0\u67e5: \u5b9a\u671f\u68c0\u67e5\u5185\u90e8\u548c\u5916\u90e8\u94fe\u63a5</li> <li>\u53cd\u9988\u6536\u96c6: \u6536\u96c6\u7528\u6237\u53cd\u9988\u6301\u7eed\u6539\u8fdb</li> </ol> <p>\u9700\u8981\u5e2e\u52a9\uff1f \u8bf7\u67e5\u770b \u95ee\u9898\u53cd\u9988 \u6216\u63d0\u4ea4 PR\u3002</p>"},{"location":"getting-started/","title":"\u5feb\u901f\u5f00\u59cb","text":"<p>\u672c\u6307\u5357\u5c06\u5e2e\u52a9\u60a8\u5728 5 \u5206\u949f\u5185\u5f00\u59cb\u4f7f\u7528 OpenIBBOs\u3002</p>"},{"location":"getting-started/#_2","title":"\u524d\u7f6e\u8981\u6c42","text":"<ul> <li>C \u7f16\u8bd1\u5668\uff08GCC/Clang\uff09</li> <li>CMake 3.10+</li> <li>\u652f\u6301\u7684\u5d4c\u5165\u5f0f\u5e73\u53f0\uff08FreeRTOS\u3001RT-Thread \u7b49\uff09</li> </ul>"},{"location":"getting-started/#_3","title":"\u5b89\u88c5","text":""},{"location":"getting-started/#1","title":"1. \u514b\u9686\u4ed3\u5e93","text":"<pre><code>git clone https://github.com/yourusername/OpenIBBOs.git\ncd OpenIBBOs\n</code></pre>"},{"location":"getting-started/#2","title":"2. \u96c6\u6210\u5230\u9879\u76ee","text":"<p>\u5c06 <code>zero_topic_core</code> \u76ee\u5f55\u590d\u5236\u5230\u60a8\u7684\u9879\u76ee\u4e2d\uff0c\u6216\u4f7f\u7528 Git \u5b50\u6a21\u5757\uff1a</p> <pre><code>git submodule add https://github.com/yourusername/OpenIBBOs.git\n</code></pre>"},{"location":"getting-started/#3-cmake","title":"3. \u914d\u7f6e CMake","text":"<p>\u5728\u60a8\u7684 <code>CMakeLists.txt</code> \u4e2d\u6dfb\u52a0\uff1a</p> <pre><code>add_subdirectory(OpenIBBOs/zero_topic_core)\ntarget_link_libraries(your_target PRIVATE zero_topic_core)\n</code></pre>"},{"location":"getting-started/#_4","title":"\u7b2c\u4e00\u4e2a\u793a\u4f8b","text":""},{"location":"getting-started/#1_1","title":"1. \u521d\u59cb\u5316\u5bf9\u8c61\u5b57\u5178","text":"<pre><code>#include \"obj_dict.h\"\n#include \"topic_bus.h\"\n\n// \u5b9a\u4e49\u6570\u636e\u5bf9\u8c61\ntypedef struct {\n    float temperature;\n    uint32_t timestamp;\n} sensor_data_t;\n\nsensor_data_t sensor_data = {0};\n\n// \u6ce8\u518c\u5230\u5bf9\u8c61\u5b57\u5178\nobj_dict_entry_t entry;\nentry.index = 0x1000;\nentry.type = OBJ_DICT_TYPE_FLOAT;\nentry.data_ptr = &amp;sensor_data.temperature;\nobj_dict_register(&amp;entry);\n</code></pre>"},{"location":"getting-started/#2-topic","title":"2. \u521b\u5efa Topic","text":"<pre><code>// \u5b9a\u4e49 Topic\ntopic_id_t sensor_topic = TOPIC_ID_SENSOR_DATA;\n\n// \u521b\u5efa Topic\ntopic_bus_create_topic(sensor_topic, 0x1000, sizeof(sensor_data_t));\n</code></pre>"},{"location":"getting-started/#3-topic","title":"3. \u8ba2\u9605 Topic","text":"<pre><code>void sensor_callback(topic_id_t topic, void* data) {\n    sensor_data_t* sensor = (sensor_data_t*)data;\n    printf(\"Temperature: %.2f\\n\", sensor-&gt;temperature);\n}\n\n// \u8ba2\u9605 Topic\ntopic_bus_subscribe(sensor_topic, sensor_callback);\n</code></pre>"},{"location":"getting-started/#4","title":"4. \u53d1\u5e03\u4e8b\u4ef6","text":"<pre><code>// \u66f4\u65b0\u6570\u636e\nsensor_data.temperature = 25.5f;\nsensor_data.timestamp = get_timestamp();\n\n// \u53d1\u5e03\u4e8b\u4ef6\uff08\u96f6\u62f7\u8d1d\uff09\ntopic_bus_publish_event(sensor_topic, 0x1000);\n</code></pre>"},{"location":"getting-started/#_5","title":"\u4e0b\u4e00\u6b65","text":"<ul> <li>\u9605\u8bfb Topic \u603b\u7ebf\u6587\u6863 \u4e86\u89e3\u8be6\u7ec6\u673a\u5236</li> <li>\u67e5\u770b \u5bf9\u8c61\u5b57\u5178\u6587\u6863 \u5b66\u4e60\u6570\u636e\u7ba1\u7406</li> <li>\u53c2\u8003\u793a\u4f8b\u4ee3\u7801\u4e86\u89e3\u66f4\u9ad8\u7ea7\u7528\u6cd5</li> </ul>"},{"location":"getting-started/#_6","title":"\u83b7\u53d6\u5e2e\u52a9","text":"<ul> <li>\u67e5\u770b \u95ee\u9898\u53cd\u9988</li> <li>\u9605\u8bfb \u9879\u76ee README</li> </ul>"},{"location":"installation/","title":"\u5b89\u88c5\u6307\u5357","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u4ecb\u7ecd OpenIBBOs \u7684\u5b89\u88c5\u548c\u914d\u7f6e\u6b65\u9aa4\u3002</p>"},{"location":"installation/#_2","title":"\u7cfb\u7edf\u8981\u6c42","text":""},{"location":"installation/#_3","title":"\u786c\u4ef6\u5e73\u53f0","text":"<ul> <li>ARM Cortex-M \u7cfb\u5217\u5fae\u63a7\u5236\u5668</li> <li>RISC-V \u67b6\u6784\uff08\u90e8\u5206\u652f\u6301\uff09</li> <li>\u5176\u4ed6\u652f\u6301 C99 \u6807\u51c6\u7684\u5d4c\u5165\u5f0f\u5e73\u53f0</li> </ul>"},{"location":"installation/#_4","title":"\u8f6f\u4ef6\u73af\u5883","text":"<ul> <li>\u7f16\u8bd1\u5668: GCC 7.0+ / Clang 6.0+ / ARM Compiler 6.0+</li> <li>\u6784\u5efa\u7cfb\u7edf: CMake 3.10+ / Makefile</li> <li>\u64cd\u4f5c\u7cfb\u7edf: FreeRTOS / RT-Thread / \u88f8\u673a / Linux</li> </ul>"},{"location":"installation/#_5","title":"\u5b89\u88c5\u65b9\u5f0f","text":""},{"location":"installation/#git","title":"\u65b9\u5f0f\u4e00\uff1aGit \u5b50\u6a21\u5757\uff08\u63a8\u8350\uff09","text":"<p>\u9002\u5408\u5df2\u4f7f\u7528 Git \u7ba1\u7406\u7684\u9879\u76ee\uff1a</p> <pre><code># \u5728\u9879\u76ee\u6839\u76ee\u5f55\u6267\u884c\ngit submodule add https://github.com/yourusername/OpenIBBOs.git\ngit submodule update --init --recursive\n</code></pre>"},{"location":"installation/#_6","title":"\u65b9\u5f0f\u4e8c\uff1a\u76f4\u63a5\u514b\u9686","text":"<pre><code>git clone https://github.com/yourusername/OpenIBBOs.git\n</code></pre>"},{"location":"installation/#_7","title":"\u65b9\u5f0f\u4e09\uff1a\u624b\u52a8\u96c6\u6210","text":"<p>\u4e0b\u8f7d\u6e90\u4ee3\u7801\u5e76\u89e3\u538b\u5230\u9879\u76ee\u76ee\u5f55\u3002</p>"},{"location":"installation/#cmake","title":"CMake \u914d\u7f6e","text":""},{"location":"installation/#_8","title":"\u57fa\u672c\u914d\u7f6e","text":"<pre><code>cmake_minimum_required(VERSION 3.10)\nproject(your_project C CXX)\n\n# \u6dfb\u52a0 OpenIBBOs\nadd_subdirectory(OpenIBBOs/zero_topic_core)\n\n# \u94fe\u63a5\u5e93\ntarget_link_libraries(your_target PRIVATE zero_topic_core)\n\n# \u5305\u542b\u5934\u6587\u4ef6\ntarget_include_directories(your_target PRIVATE \n    OpenIBBOs/zero_topic_core/topic_bus\n    OpenIBBOs/zero_topic_core/obj_dict\n    OpenIBBOs/zero_topic_core/ring_buffer\n)\n</code></pre>"},{"location":"installation/#_9","title":"\u914d\u7f6e\u9009\u9879","text":"<p>\u5728 <code>CMakeLists.txt</code> \u4e2d\u8bbe\u7f6e\u914d\u7f6e\u9009\u9879\uff1a</p> <pre><code># \u542f\u7528\u8c03\u8bd5\u4fe1\u606f\nset(ZERO_TOPIC_DEBUG ON)\n\n# \u8bbe\u7f6e\u6700\u5927 Topic \u6570\u91cf\nset(TOPIC_BUS_MAX_TOPICS 32)\n\n# \u8bbe\u7f6e\u5bf9\u8c61\u5b57\u5178\u6700\u5927\u6761\u76ee\u6570\nset(OBJ_DICT_MAX_ENTRIES 128)\n</code></pre>"},{"location":"installation/#_10","title":"\u914d\u7f6e\u6587\u4ef6","text":""},{"location":"installation/#topic","title":"Topic \u603b\u7ebf\u914d\u7f6e","text":"<p>\u7f16\u8f91 <code>topic_bus_config.h</code>:</p> <pre><code>#define TOPIC_BUS_MAX_TOPICS      32\n#define TOPIC_BUS_MAX_SUBSCRIBERS 16\n#define TOPIC_EVENT_TIMEOUT_MS    1000\n</code></pre>"},{"location":"installation/#_11","title":"\u5bf9\u8c61\u5b57\u5178\u914d\u7f6e","text":"<p>\u7f16\u8f91 <code>obj_dict_config.h</code>:</p> <pre><code>#define OBJ_DICT_MAX_ENTRIES  128\n#define OBJ_DICT_USE_MEMPOOL  1\n#define OBJ_DICT_MEMPOOL_SIZE 4096\n</code></pre>"},{"location":"installation/#_12","title":"\u7f16\u8bd1","text":""},{"location":"installation/#cmake_1","title":"\u4f7f\u7528 CMake","text":"<pre><code>mkdir build &amp;&amp; cd build\ncmake ..\nmake\n</code></pre>"},{"location":"installation/#makefile","title":"\u4f7f\u7528 Makefile","text":"<pre><code>cd OpenIBBOs/zero_topic_core\nmake\n</code></pre>"},{"location":"installation/#_13","title":"\u9a8c\u8bc1\u5b89\u88c5","text":"<p>\u521b\u5efa\u6d4b\u8bd5\u7a0b\u5e8f\u9a8c\u8bc1\u5b89\u88c5\uff1a</p> <pre><code>#include \"topic_bus.h\"\n#include \"obj_dict.h\"\n\nint main() {\n    // \u521d\u59cb\u5316\n    topic_bus_init();\n    obj_dict_init();\n\n    // \u521b\u5efa\u6d4b\u8bd5 Topic\n    topic_id_t test_topic = 0x0001;\n    topic_bus_create_topic(test_topic, 0, 4);\n\n    printf(\"OpenIBBOs installed successfully!\\n\");\n    return 0;\n}\n</code></pre> <p>\u7f16\u8bd1\u5e76\u8fd0\u884c\uff0c\u5982\u679c\u770b\u5230\u6210\u529f\u6d88\u606f\uff0c\u8bf4\u660e\u5b89\u88c5\u6b63\u786e\u3002</p>"},{"location":"installation/#_14","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"installation/#_15","title":"\u7f16\u8bd1\u9519\u8bef","text":"<p>\u95ee\u9898: \u627e\u4e0d\u5230\u5934\u6587\u4ef6 - \u89e3\u51b3: \u68c0\u67e5 <code>target_include_directories</code> \u914d\u7f6e</p> <p>\u95ee\u9898: \u94fe\u63a5\u9519\u8bef - \u89e3\u51b3: \u786e\u4fdd\u5df2\u94fe\u63a5 <code>zero_topic_core</code> \u5e93</p>"},{"location":"installation/#_16","title":"\u8fd0\u884c\u65f6\u9519\u8bef","text":"<p>\u95ee\u9898: \u5185\u5b58\u4e0d\u8db3 - \u89e3\u51b3: \u8c03\u6574\u914d\u7f6e\u4e2d\u7684\u6700\u5927\u503c\u53c2\u6570</p> <p>\u95ee\u9898: \u521d\u59cb\u5316\u5931\u8d25 - \u89e3\u51b3: \u68c0\u67e5\u5806\u6808\u5927\u5c0f\u548c\u5185\u5b58\u5206\u914d</p>"},{"location":"installation/#_17","title":"\u4e0b\u4e00\u6b65","text":"<ul> <li>\u9605\u8bfb \u5feb\u901f\u5f00\u59cb\u6307\u5357</li> <li>\u67e5\u770b API \u53c2\u8003\u6587\u6863</li> <li>\u53c2\u8003\u793a\u4f8b\u4ee3\u7801</li> </ul>"},{"location":"installation/#_18","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>WSL/CMake/GCC \u914d\u7f6e\u6307\u5357</li> <li>\u8d21\u732e\u6307\u5357</li> </ul>"},{"location":"Doc/todo_list/","title":"OpenIBBOs \u5f00\u53d1\u4efb\u52a1\u6e05\u5355","text":""},{"location":"Doc/todo_list/#_1","title":"\u5f53\u524d\u4efb\u52a1\u4f18\u5148\u7ea7","text":""},{"location":"Doc/todo_list/#_2","title":"\ud83d\udd25 \u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1","text":""},{"location":"Doc/todo_list/#1-rte-runtime-environment","title":"1. RTE (Runtime Environment) \u5168\u7cfb\u7edf\u9002\u914d","text":"<ul> <li>[ ] \u5206\u6790\u73b0\u6709RTE\u67b6\u6784</li> <li>[ ] \u68c0\u67e5\u5f53\u524dRTE\u5b9e\u73b0\u72b6\u6001</li> <li>[ ] \u8bc6\u522b\u9700\u8981\u9002\u914d\u7684\u7cfb\u7edf\u7ec4\u4ef6</li> <li> <p>[ ] \u8bc4\u4f30\u4e0e\u76ee\u6807\u5e73\u53f0\u7684\u517c\u5bb9\u6027</p> </li> <li> <p>[ ] RTE\u6838\u5fc3\u529f\u80fd\u5b9e\u73b0</p> </li> <li>[ ] \u4efb\u52a1\u8c03\u5ea6\u5668\u9002\u914d</li> <li>[ ] \u5185\u5b58\u7ba1\u7406\u6a21\u5757</li> <li>[ ] \u4e2d\u65ad\u5904\u7406\u673a\u5236</li> <li>[ ] \u65f6\u95f4\u7ba1\u7406\u670d\u52a1</li> <li> <p>[ ] \u901a\u4fe1\u673a\u5236\u5b9e\u73b0</p> </li> <li> <p>[ ] \u7cfb\u7edf\u96c6\u6210\u6d4b\u8bd5</p> </li> <li>[ ] \u5355\u5143\u6d4b\u8bd5\u8986\u76d6</li> <li>[ ] \u96c6\u6210\u6d4b\u8bd5\u9a8c\u8bc1</li> <li>[ ] \u6027\u80fd\u57fa\u51c6\u6d4b\u8bd5</li> <li>[ ] \u7a33\u5b9a\u6027\u6d4b\u8bd5</li> </ul>"},{"location":"Doc/todo_list/#2-vfb-virtual-function-bus","title":"2. VFB (Virtual Function Bus) \u4f18\u5316","text":"<ul> <li>[ ] VFB\u67b6\u6784\u5206\u6790</li> <li>[ ] \u5f53\u524dVFB\u5b9e\u73b0\u8bc4\u4f30</li> <li>[ ] \u6027\u80fd\u74f6\u9888\u8bc6\u522b</li> <li> <p>[ ] \u4f18\u5316\u673a\u4f1a\u5206\u6790</p> </li> <li> <p>[ ] VFB\u6027\u80fd\u4f18\u5316</p> </li> <li>[ ] \u901a\u4fe1\u6548\u7387\u63d0\u5347</li> <li>[ ] \u5185\u5b58\u4f7f\u7528\u4f18\u5316</li> <li>[ ] \u5ef6\u8fdf\u964d\u4f4e</li> <li> <p>[ ] \u541e\u5410\u91cf\u63d0\u5347</p> </li> <li> <p>[ ] VFB\u529f\u80fd\u589e\u5f3a</p> </li> <li>[ ] \u9519\u8bef\u5904\u7406\u673a\u5236\u5b8c\u5584</li> <li>[ ] \u52a8\u6001\u914d\u7f6e\u652f\u6301</li> <li>[ ] \u76d1\u63a7\u548c\u8bca\u65ad\u529f\u80fd</li> <li>[ ] \u6269\u5c55\u6027\u6539\u8fdb</li> </ul>"},{"location":"Doc/todo_list/#_3","title":"\ud83d\udccb \u540e\u7eed\u4efb\u52a1","text":""},{"location":"Doc/todo_list/#3","title":"3. \u7cfb\u7edf\u6574\u4f53\u4f18\u5316","text":"<ul> <li>[ ] \u4ee3\u7801\u8d28\u91cf\u63d0\u5347</li> <li>[ ] \u6587\u6863\u5b8c\u5584</li> <li>[ ] \u6d4b\u8bd5\u8986\u76d6\u7387\u63d0\u5347</li> <li>[ ] \u6027\u80fd\u8c03\u4f18</li> </ul>"},{"location":"Doc/todo_list/#4","title":"4. \u5e73\u53f0\u9002\u914d","text":"<ul> <li>[ ] Linux\u5e73\u53f0\u4f18\u5316</li> <li>[ ] \u5d4c\u5165\u5f0f\u5e73\u53f0\u652f\u6301</li> <li>[ ] \u8de8\u5e73\u53f0\u517c\u5bb9\u6027</li> </ul>"},{"location":"Doc/todo_list/#_4","title":"\u4efb\u52a1\u72b6\u6001\u8bf4\u660e","text":"<ul> <li>\u2705 \u5df2\u5b8c\u6210 - \u4efb\u52a1\u5df2\u5b8c\u6210\u5e76\u901a\u8fc7\u9a8c\u8bc1</li> <li>\ud83d\udd04 \u8fdb\u884c\u4e2d - \u4efb\u52a1\u6b63\u5728\u5f00\u53d1\u4e2d</li> <li>\u23f3 \u5f85\u5f00\u59cb - \u4efb\u52a1\u5df2\u89c4\u5212\u4f46\u672a\u5f00\u59cb</li> <li>\u274c \u5df2\u53d6\u6d88 - \u4efb\u52a1\u88ab\u53d6\u6d88\u6216\u4e0d\u518d\u9700\u8981</li> </ul>"},{"location":"Doc/todo_list/#_5","title":"\u5907\u6ce8","text":"<ul> <li>\u6240\u6709\u4efb\u52a1\u5b8c\u6210\u540e\u9700\u8981\u66f4\u65b0\u76f8\u5e94\u7684\u6587\u6863</li> <li>\u91cd\u8981\u529f\u80fd\u53d8\u66f4\u9700\u8981\u66f4\u65b0API\u6587\u6863</li> <li>\u6027\u80fd\u4f18\u5316\u9700\u8981\u63d0\u4f9b\u57fa\u51c6\u6d4b\u8bd5\u6570\u636e</li> </ul> <p>\u6700\u540e\u66f4\u65b0\u65f6\u95f4: $(date) \u8d1f\u8d23\u4eba: \u5f00\u53d1\u56e2\u961f</p>"},{"location":"Doc/wsl_cmake_gcc/","title":"WSL/CMake/GCC","text":""},{"location":"Doc/wsl_cmake_gcc/#wsl-cmake-gccarm-none-eabi-openibbos","title":"\u5728 WSL \u4e0b\u4f7f\u7528 CMake + GCC\uff08arm-none-eabi\uff09\u7f16\u8bd1 OpenIBBOs","text":"<p>\u672c\u6307\u5357\u8bf4\u660e\u5982\u4f55\u5728 WSL(Ubuntu) \u73af\u5883\u4f7f\u7528 CMake + Ninja + <code>arm-none-eabi-gcc</code> \u6784\u5efa\u672c\u9879\u76ee\uff08\u4ee5 <code>dp2501project</code> \u4e3a\u4f8b\uff09\u3002</p>"},{"location":"Doc/wsl_cmake_gcc/#0","title":"0. \u76ee\u5f55\u7ea6\u5b9a","text":"<p>\u5728 WSL \u4e2d\u63a8\u8350\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff08<code>borui</code> \u4e3a\u9879\u76ee\u6839\uff0c\u4ee5\u4e0b\u547d\u4ee4\u5747\u5728\u8be5\u76ee\u5f55\u6267\u884c\uff09\uff1a <pre><code>borui/\n\u251c\u2500\u2500 OpenIBBOs/             # SDK \u4e0e\u516c\u5171\u4e2d\u95f4\u4ef6\n\u2502  \u2514\u2500\u2500 tool/               # \u7edf\u4e00\u5b58\u653e\u4ea4\u53c9\u5de5\u5177\u94fe\u4e0e\u76f8\u5173\u5de5\u5177\n\u2514\u2500\u2500 dp2501project/         # \u5b9e\u9645\u5de5\u7a0b\uff08\u542b CMakePresets\u3001cmake/\u3001Application/ \u7b49\uff09\n</code></pre> \u5de5\u5177\u94fe\u7edf\u4e00\u653e\u5728 <code>OpenIBBOs/tool/</code>\uff0c\u901a\u8fc7\u73af\u5883\u53d8\u91cf <code>SDK_TOOL_PATH</code> \u6307\u5411\u8be5\u76ee\u5f55\u3002</p>"},{"location":"Doc/wsl_cmake_gcc/#1","title":"1. \u5b89\u88c5\u5fc5\u9700\u5de5\u5177","text":"<pre><code>sudo apt update\nsudo apt install -y cmake ninja-build build-essential wget xz-utils\n</code></pre>"},{"location":"Doc/wsl_cmake_gcc/#2-arm","title":"2. \u83b7\u53d6 ARM \u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe","text":"<pre><code>sudo apt install -y gcc-arm-none-eabi gdb-multiarch\n\ncd OpenIBBOs/tool\nmkdir -p arm-none-eabi-gcc/Linux\nln -s /usr/bin ./arm-none-eabi-gcc/Linux/bin\n</code></pre>"},{"location":"Doc/wsl_cmake_gcc/#3","title":"3. \u914d\u7f6e\u73af\u5883\u53d8\u91cf","text":"<p><code>dp2501project/cmake/arm-none-eabi-gcc.cmake</code> \u901a\u8fc7\u4ee5\u4e0b\u53d8\u91cf\u5b9a\u4f4d\uff1a - <code>SDK_TOOL_PATH</code>\uff1a\u6307\u5411 <code>OpenIBBOs/tool</code> - <code>SDK_OS_PATH</code>\uff1a\u6307\u5411 <code>OpenIBBOs</code></p> <p>\u5728\u9879\u76ee\u6839 <code>borui/</code> \u4e0b\u6267\u884c\uff1a <pre><code>export SDK_TOOL_PATH=$(pwd)/OpenIBBOs/tool\nexport SDK_OS_PATH=$(pwd)/OpenIBBOs\n\n# \u53ef\u9009\uff1a\u5199\u5165 ~/.bashrc \u6301\u4e45\u5316\ngrep -q 'SDK_TOOL_PATH' ~/.bashrc || echo 'export SDK_TOOL_PATH=$HOME/borui/OpenIBBOs/tool' &gt;&gt; ~/.bashrc\ngrep -q 'SDK_OS_PATH' ~/.bashrc || echo 'export SDK_OS_PATH=$HOME/borui/OpenIBBOs' &gt;&gt; ~/.bashrc\n</code></pre></p>"},{"location":"Doc/wsl_cmake_gcc/#4-cmake-presets","title":"4. \u4f7f\u7528 CMake Presets \u914d\u7f6e\u4e0e\u7f16\u8bd1","text":"<p>\u8fdb\u5165\u5de5\u7a0b\u76ee\u5f55\u5e76\u9009\u62e9\u9884\u8bbe\uff08Debug/Release\uff09\uff1a <pre><code>cd dp2501project\n\ncmake --preset Debug\ncmake --build --preset Debug -j\n# \u6216\ncmake --preset Release\ncmake --build --preset Release -j\n</code></pre></p> <p>\u5982\u9700\u5207\u6362\u5de5\u5177\u94fe\u6216\u6e05\u7406\u91cd\u914d\uff1a <pre><code>rm -rf dp2501project/Build\ncmake --preset Debug\ncmake --build --preset Debug -j\n</code></pre></p>"},{"location":"Doc/wsl_cmake_gcc/#5","title":"5. \u6784\u5efa\u4ea7\u7269\u4e0e\u9a8c\u8bc1","text":"<ul> <li>\u4ea7\u7269\u8def\u5f84\uff1a<code>dp2501project/Build/&lt;PresetName&gt;/Application/*.elf|*.bin|*.hex</code></li> <li>\u914d\u7f6e\u65e5\u5fd7\u5e94\u51fa\u73b0\uff1a</li> <li><code>Open IBBOs Basic Tools Directory: ...</code></li> <li><code>TOOLCHAIN_DIRECTORY : .../arm-none-eabi-gcc/Linux/bin</code></li> <li><code>arm-none-eabi-gcc cmake done.</code></li> </ul> <p>\u5de5\u5177\u94fe\u7248\u672c\u81ea\u68c0\uff1a <pre><code>OpenIBBOs/tool/arm-none-eabi-gcc/Linux/bin/arm-none-eabi-gcc --version\n</code></pre></p>"},{"location":"Doc/wsl_cmake_gcc/#6","title":"6. \u5e38\u89c1\u95ee\u9898","text":"<ul> <li>\u627e\u4e0d\u5230 <code>arm-none-eabi-gcc</code>\uff1a\u786e\u8ba4 <code>SDK_TOOL_PATH</code> \u6b63\u786e\u4e14 <code>Tools/arm-none-eabi-gcc/Linux/bin</code> \u5b58\u5728\u5e76\u53ef\u6267\u884c\uff08\u6216\u7b26\u53f7\u94fe\u63a5\u6709\u6548\uff09\u3002</li> <li>\u7f3a\u5c11 Ninja\uff1a<code>sudo apt install -y ninja-build</code></li> <li>\u8def\u5f84\u8fc7\u957f/\u542b\u7a7a\u683c\uff1a\u5efa\u8bae\u4f7f\u7528 WSL \u672c\u5730\u77ed\u8def\u5f84\uff08\u5982 <code>/home/&lt;user&gt;/borui</code>\uff09\u3002</li> <li>\u4e0b\u8f7d 404\uff1a\u5e38\u56e0\u4ee3\u7406\u6216\u7248\u672c\u53f7\u53d8\u66f4\uff0c\u5148 <code>unset https_proxy http_proxy all_proxy</code>\uff0c\u518d\u5c1d\u8bd5\u65b0\u7248 xPack \u53d1\u884c\u5305\u3002</li> </ul>"},{"location":"Middlewares/shell/","title":"letter shell 3.x","text":"<p>\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u7684\u5d4c\u5165\u5f0fshell</p> <p></p> <ul> <li>letter shell 3.x</li> <li>\u7b80\u4ecb</li> <li>\u529f\u80fd</li> <li>\u79fb\u690d\u8bf4\u660e</li> <li>\u4f7f\u7528\u65b9\u5f0f<ul> <li>\u51fd\u6570\u5b9a\u4e49</li> <li>main\u51fd\u6570\u5f62\u5f0f</li> <li>\u666e\u901aC\u51fd\u6570\u5f62\u5f0f</li> <li>\u53d8\u91cf\u4f7f\u7528</li> <li>\u5728\u51fd\u6570\u4e2d\u83b7\u53d6\u5f53\u524dshell\u5bf9\u8c61</li> <li>\u6267\u884c\u672a\u5bfc\u51fa\u51fd\u6570</li> </ul> </li> <li>\u547d\u4ee4\u5b9a\u4e49<ul> <li>\u5b9a\u4e49\u65b9\u5f0f</li> <li>\u5b9a\u4e49\u5b8f\u8bf4\u660e</li> <li>\u547d\u4ee4\u5c5e\u6027\u5b57\u6bb5\u8bf4\u660e</li> </ul> </li> <li>\u4ee3\u7406\u51fd\u6570\u548c\u4ee3\u7406\u53c2\u6570\u89e3\u6790</li> <li>\u51fd\u6570\u7b7e\u540d<ul> <li>\u81ea\u5b9a\u4e49\u7c7b\u578b\u89e3\u6790</li> <li>\u6570\u7ec4\u53c2\u6570</li> </ul> </li> <li>\u6743\u9650\u7cfb\u7edf\u8bf4\u660e</li> <li>\u9501\u8bf4\u660e</li> <li>\u4f34\u751f\u5bf9\u8c61</li> <li>\u5c3e\u884c\u6a21\u5f0f</li> <li>\u5efa\u8bae\u7ec8\u7aef\u8f6f\u4ef6</li> <li>\u547d\u4ee4\u904d\u5386\u5de5\u5177</li> <li>x86 demo</li> </ul>"},{"location":"Middlewares/shell/#_1","title":"\u7b80\u4ecb","text":"<p>letter shell\u662f\u4e00\u4e2aC\u8bed\u8a00\u7f16\u5199\u7684\uff0c\u53ef\u4ee5\u5d4c\u5165\u5728\u7a0b\u5e8f\u4e2d\u7684\u5d4c\u5165\u5f0fshell\uff0c\u4e3b\u8981\u9762\u5411\u5d4c\u5165\u5f0f\u8bbe\u5907\uff0c\u4ee5C\u8bed\u8a00\u51fd\u6570\u4e3a\u8fd0\u884c\u5355\u4f4d\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u8c03\u7528\uff0c\u8fd0\u884c\u7a0b\u5e8f\u4e2d\u7684\u51fd\u6570</p> <p>\u76f8\u5bf92.x\u7248\u672c\uff0cletter shell 3.x\u589e\u52a0\u4e86\u7528\u6237\u7ba1\u7406\uff0c\u6743\u9650\u7ba1\u7406\uff0c\u4ee5\u53ca\u5bf9\u6587\u4ef6\u7cfb\u7edf\u7684\u521d\u6b65\u652f\u6301</p> <p>\u6b64\u59163.x\u7248\u672c\u4fee\u6539\u4e86\u547d\u4ee4\u683c\u5f0f\u548c\u5b9a\u4e49\uff0c2.x\u7248\u672c\u7684\u5de5\u7a0b\u9700\u8981\u7ecf\u8fc7\u7b80\u5355\u7684\u4fee\u6539\u624d\u80fd\u5b8c\u6210\u8fc1\u79fb</p> <p>\u82e5\u53ea\u9700\u8981\u4f7f\u7528\u57fa\u7840\u529f\u80fd\uff0c\u53ef\u4ee5\u4f7f\u7528letter shell 2.x\u7248\u672c</p> <p>\u4f7f\u7528\u8bf4\u660e\u53ef\u53c2\u8003Letter shell 3.0 \u5168\u65b0\u51fa\u53d1</p> <p>\u5982\u679c\u4ece3.0\u7248\u672c\u8fc1\u79fb\u52303.1\u4ee5\u4e0a\u7248\u672c\uff0c\u8bf7\u6ce8\u610f3.1\u7248\u672c\u5bf9\u8bfb\u5199\u51fd\u6570\u539f\u578b\u7684\u4fee\u6539</p>"},{"location":"Middlewares/shell/#_2","title":"\u529f\u80fd","text":"<ul> <li>\u547d\u4ee4\u81ea\u52a8\u8865\u5168</li> <li>\u5feb\u6377\u952e\u529f\u80fd\u5b9a\u4e49</li> <li>\u547d\u4ee4\u6743\u9650\u7ba1\u7406</li> <li>\u7528\u6237\u7ba1\u7406</li> <li>\u53d8\u91cf\u652f\u6301</li> <li>\u4ee3\u7406\u51fd\u6570\u548c\u53c2\u6570\u4ee3\u7406\u89e3\u6790</li> </ul>"},{"location":"Middlewares/shell/#_3","title":"\u79fb\u690d\u8bf4\u660e","text":"<ol> <li> <p>\u5b9a\u4e49shell\u5bf9\u8c61</p> <pre><code>Shell shell;\n</code></pre> </li> <li> <p>\u5b9a\u4e49shell\u8bfb\uff0c\u5199\u51fd\u6570</p> <p>\u5bf9\u4e8e\u4f7f\u7528letter shell 3.0\u7248\u672c\uff0c\u8bfb\u5199\u51fd\u6570\u539f\u578b\u5982\u4e0b\uff1a</p> <pre><code>/**\n * @brief shell\u8bfb\u53d6\u6570\u636e\u51fd\u6570\u539f\u578b\n *\n * @param char shell\u8bfb\u53d6\u7684\u5b57\u7b26\n *\n * @return char 0 \u8bfb\u53d6\u6570\u636e\u6210\u529f\n * @return char -1 \u8bfb\u53d6\u6570\u636e\u5931\u8d25\n */\ntypedef signed char (*shellRead)(char *);\n\n/**\n * @brief shell\u5199\u6570\u636e\u51fd\u6570\u539f\u578b\n *\n * @param const char \u9700\u5199\u7684\u5b57\u7b26\n */\ntypedef void (*shellWrite)(const char);\n</code></pre> <p>\u5bf9\u4e8e\u4f7f\u7528letter shell 3.1\u7248\u672c\uff0c\u4e3a\u4e86\u4f18\u5316\u6548\u7387\uff0c\u4fee\u6539\u4e86\u8bfb\u5199\u51fd\u6570\u539f\u578b\uff0c\u5982\u4e0b\uff1a</p> <pre><code>/**\n * @brief shell\u8bfb\u53d6\u6570\u636e\u51fd\u6570\u539f\u578b\n *\n * @param data shell\u8bfb\u53d6\u7684\u5b57\u7b26\n * @param len \u8bf7\u6c42\u8bfb\u53d6\u7684\u5b57\u7b26\u6570\u91cf\n *\n * @return unsigned short \u5b9e\u9645\u8bfb\u53d6\u5230\u7684\u5b57\u7b26\u6570\u91cf\n */\ntypedef unsigned short (*shellRead)(char *data, unsigned short len);\n\n/**\n * @brief shell\u5199\u6570\u636e\u51fd\u6570\u539f\u578b\n *\n * @param data \u9700\u5199\u7684\u5b57\u7b26\u6570\u636e\n * @param len \u9700\u8981\u5199\u5165\u7684\u5b57\u7b26\u6570\n *\n * @return unsigned short \u5b9e\u9645\u5199\u5165\u7684\u5b57\u7b26\u6570\u91cf\n */\ntypedef unsigned short (*shellWrite)(char *data, unsigned short len);\n</code></pre> </li> <li> <p>\u7533\u8bf7\u4e00\u7247\u7f13\u51b2\u533a</p> <pre><code>char shellBuffer[512];\n</code></pre> </li> <li> <p>\u8c03\u7528shellInit\u8fdb\u884c\u521d\u59cb\u5316</p> <pre><code>shell.read = shellRead;\nshell.write = shellWrite;\nshellInit(&amp;shell, shellBuffer, 512);\n</code></pre> </li> <li> <p>\u8c03\u7528(\u5efa\u7acb)shell\u4efb\u52a1</p> <p>\u5bf9\u4e8e\u8fd0\u884c\u5728\u64cd\u4f5c\u7cfb\u7edf\u7684\u60c5\u51b5\uff0c\u5efa\u7acb<code>shellTask</code>\u4efb\u52a1(\u786e\u4fddsell_cfg.h\u4e2d\u7684\u914d\u7f6e\u65e0\u8bef)\uff0c\u4efb\u52a1\u53c2\u6570\u4e3ashell\u5bf9\u8c61</p> <pre><code>OsTaskCreate(shellTask, &amp;shell, ...);\n</code></pre> <p>\u5bf9\u4e8e\u88f8\u673a\u73af\u5883\uff0c\u5728\u4e3b\u5faa\u73af\u4e2d\u8c03\u7528<code>shellTask</code>\uff0c\u6216\u8005\u5728\u63a5\u6536\u5230\u6570\u636e\u65f6\uff0c\u8c03\u7528<code>shellHandler</code></p> </li> <li> <p>\u8bf4\u660e</p> </li> <li> <p>\u5bf9\u4e8e\u4e2d\u65ad\u65b9\u5f0f\u4f7f\u7528shell\uff0c\u4e0d\u7528\u5b9a\u4e49<code>shell-&gt;read</code>\uff0c\u4f46\u9700\u8981\u5728\u4e2d\u65ad\u4e2d\u8c03\u7528<code>shellHandler</code></p> </li> <li> <p>\u5bf9\u4e8e\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u60c5\u51b5\uff0c\u4f7f\u80fd<code>SHEHLL_TASK_WHILE</code>\u5b8f\uff0c\u7136\u540e\u521b\u5efashellTask\u4efb\u52a1</p> </li> <li> <p>\u5176\u4ed6\u914d\u7f6e</p> </li> <li> <p>\u5b9a\u4e49\u5b8f<code>SHELL_GET_TICK()</code>\u4e3a\u83b7\u53d6\u7cfb\u7edftick\u51fd\u6570\uff0c\u4f7f\u80fdtab\u53cc\u51fb\u64cd\u4f5c\uff0c\u7528\u6237\u957f\u5e2e\u52a9\u8865\u5168</p> </li> <li> <p>\u914d\u7f6e\u5b8f</p> <p>shell_cfg.h\u6587\u4ef6\u4e2d\u5305\u542b\u4e86\u6240\u6709\u7528\u4e8e\u914d\u7f6eshell\u7684\u5b8f\uff0c\u5728\u4f7f\u7528\u524d\uff0c\u9700\u8981\u6839\u636e\u9700\u8981\u8fdb\u884c\u914d\u7f6e</p> <p>\u5efa\u8bae\u91c7\u7528 overlay \u7684\u65b9\u5f0f\uff0c\u65b0\u5efa\u4e00\u4e2a\u5934\u6587\u4ef6\uff0c\u4f8b\u5982 <code>shell_cfg_user.h</code>\uff0c\u7136\u540e\u5b9a\u4e49\u7f16\u8bd1\u5b8f <code>SHELL_CFG_USER=\"shell_cfg_user.h\"</code>\uff0c\u5728\u8fd9\u4e2a\u5934\u6587\u4ef6\u4e2d\u6dfb\u52a0\u9700\u8981\u4fee\u6539\u7684\u914d\u7f6e\u5373\u53ef</p> \u5b8f \u610f\u4e49 SHELL_TASK_WHILE \u662f\u5426\u4f7f\u7528\u9ed8\u8ba4shell\u4efb\u52a1while\u5faa\u73af SHELL_USING_CMD_EXPORT \u662f\u5426\u4f7f\u7528\u547d\u4ee4\u5bfc\u51fa\u65b9\u5f0f SHELL_USING_COMPANION \u662f\u5426\u4f7f\u7528shell\u4f34\u751f\u5bf9\u8c61\u529f\u80fd SHELL_SUPPORT_END_LINE \u662f\u5426\u652f\u6301shell\u5c3e\u884c\u6a21\u5f0f SHELL_HELP_LIST_USER \u662f\u5426\u5728\u8f93\u5165\u547d\u4ee4\u5217\u8868\u4e2d\u5217\u51fa\u7528\u6237 SHELL_HELP_LIST_VAR \u662f\u5426\u5728\u8f93\u5165\u547d\u4ee4\u5217\u8868\u4e2d\u5217\u51fa\u53d8\u91cf SHELL_HELP_LIST_KEY \u662f\u5426\u5728\u8f93\u5165\u547d\u4ee4\u5217\u8868\u4e2d\u5217\u51fa\u6309\u952e SHELL_ENTER_LF \u4f7f\u7528LF\u4f5c\u4e3a\u547d\u4ee4\u884c\u56de\u8f66\u89e6\u53d1 SHELL_ENTER_CR \u4f7f\u7528CR\u4f5c\u4e3a\u547d\u4ee4\u884c\u56de\u8f66\u89e6\u53d1 SHELL_ENTER_CRLF \u4f7f\u7528CRLF\u4f5c\u4e3a\u547d\u4ee4\u884c\u56de\u8f66\u89e6\u53d1 SHELL_EXEC_UNDEF_FUNC \u4f7f\u7528\u6267\u884c\u672a\u5bfc\u51fa\u51fd\u6570\u7684\u529f\u80fd SHELL_COMMAND_MAX_LENGTH shell\u547d\u4ee4\u6700\u5927\u957f\u5ea6 SHELL_PARAMETER_MAX_NUMBER shell\u547d\u4ee4\u53c2\u6570\u6700\u5927\u6570\u91cf SHELL_HISTORY_MAX_NUMBER \u5386\u53f2\u547d\u4ee4\u8bb0\u5f55\u6570\u91cf SHELL_DOUBLE_CLICK_TIME \u53cc\u51fb\u95f4\u9694(ms) SHELL_QUICK_HELP \u5feb\u901f\u5e2e\u52a9 SHELL_MAX_NUMBER \u7ba1\u7406\u7684\u6700\u5927shell\u6570\u91cf SHELL_GET_TICK() \u83b7\u53d6\u7cfb\u7edf\u65f6\u95f4(ms) SHELL_USING_LOCK \u662f\u5426\u4f7f\u7528\u9501 SHELL_MALLOC(size) \u5185\u5b58\u5206\u914d\u51fd\u6570(shell\u672c\u8eab\u4e0d\u9700\u8981) SHELL_FREE(obj) \u5185\u5b58\u91ca\u653e\u51fd\u6570(shell\u672c\u8eab\u4e0d\u9700\u8981) SHELL_SHOW_INFO \u662f\u5426\u663e\u793ashell\u4fe1\u606f SHELL_CLS_WHEN_LOGIN \u662f\u5426\u5728\u767b\u5f55\u540e\u6e05\u9664\u547d\u4ee4\u884c SHELL_DEFAULT_USER shell\u9ed8\u8ba4\u7528\u6237 SHELL_DEFAULT_USER_PASSWORD \u9ed8\u8ba4\u7528\u6237\u5bc6\u7801 SHELL_LOCK_TIMEOUT shell\u81ea\u52a8\u9501\u5b9a\u8d85\u65f6 SHELL_USING_FUNC_SIGNATURE \u4f7f\u7528\u51fd\u6570\u7b7e\u540d SHELL_SUPPORT_ARRAY_PARAM \u652f\u6301\u6570\u7ec4\u53c2\u6570 </li> </ol>"},{"location":"Middlewares/shell/#_4","title":"\u4f7f\u7528\u65b9\u5f0f","text":""},{"location":"Middlewares/shell/#_5","title":"\u51fd\u6570\u5b9a\u4e49","text":"<p>letter shell 3.x\u540c\u65f6\u652f\u6301\u4e24\u79cd\u5f62\u5f0f\u7684\u51fd\u6570\u5b9a\u4e49\u65b9\u5f0f\uff0c\u5f62\u5982main\u51fd\u6570\u5b9a\u4e49\u7684<code>func(int argc, char *agrv[])</code>\u4ee5\u53ca\u5f62\u5982\u666e\u901aC\u51fd\u6570\u7684\u5b9a\u4e49<code>func(int i, char *str, ...)</code>\uff0c\u4e24\u79cd\u51fd\u6570\u5b9a\u4e49\u65b9\u5f0f\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u573a\u666f</p>"},{"location":"Middlewares/shell/#main","title":"main\u51fd\u6570\u5f62\u5f0f","text":"<p>\u4f7f\u7528\u6b64\u65b9\u5f0f\uff0c\u4e00\u4e2a\u51fd\u6570\u5b9a\u4e49\u7684\u4f8b\u5b50\u5982\u4e0b\uff1a</p> <pre><code>int func(int argc, char *argv[])\n{\n    printf(\"%dparameter(s)\\r\\n\", argc);\n    for (char i = 1; i &lt; argc; i++)\n    {\n        printf(\"%s\\r\\n\", argv[i]);\n    }\n}\nSHELL_EXPORT_CMD(SHELL_CMD_PERMISSION(0)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_MAIN), func, func, test);\n</code></pre> <p>\u7ec8\u7aef\u8c03\u7528</p> <pre><code>letter:/$ func \"hello world\"\n2 parameter(s)\nhello world\n</code></pre>"},{"location":"Middlewares/shell/#c","title":"\u666e\u901aC\u51fd\u6570\u5f62\u5f0f","text":"<p>\u4f7f\u7528\u6b64\u65b9\u5f0f\uff0cshell\u4f1a\u81ea\u52a8\u5bf9\u53c2\u6570\u8fdb\u884c\u8f6c\u5316\u5904\u7406\uff0c\u76ee\u524d\u652f\u6301\u4e8c\u8fdb\u5236\uff0c\u516b\u8fdb\u5236\uff0c\u5341\u8fdb\u5236\uff0c\u5341\u516d\u8fdb\u5236\u6574\u5f62\uff0c\u5b57\u7b26\uff0c\u5b57\u7b26\u4e32\u7684\u81ea\u52a8\u5904\u7406\uff0c\u5982\u679c\u9700\u8981\u5176\u4ed6\u7c7b\u578b\u7684\u53c2\u6570\uff0c\u8bf7\u4f7f\u7528\u4ee3\u7406\u53c2\u6570\u89e3\u6790\u7684\u65b9\u5f0f(\u53c2\u8003\u4ee3\u7406\u51fd\u6570\u548c\u4ee3\u7406\u53c2\u6570\u89e3\u6790)\uff0c\u6216\u8005\u4f7f\u7528\u5b57\u7b26\u4e32\u7684\u65b9\u5f0f\u4f5c\u4e3a\u53c2\u6570\uff0c\u81ea\u884c\u8fdb\u884c\u5904\u7406\uff0c\u4f8b\u5b50\u5982\u4e0b\uff1a</p> <pre><code>int func(int i, char ch, char *str)\n{\n    printf(\"input int: %d, char: %c, string: %s\\r\\n\", i, ch, str);\n}\nSHELL_EXPORT_CMD(SHELL_CMD_PERMISSION(0)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_FUNC), func, func, test);\n</code></pre> <p>\u7ec8\u7aef\u8c03\u7528</p> <pre><code>letter:/$ func 666 'A' \"hello world\"\ninput int: 666, char: A, string: hello world\n</code></pre>"},{"location":"Middlewares/shell/#_6","title":"\u53d8\u91cf\u4f7f\u7528","text":"<p>letter shell 3.x\u652f\u6301\u5bfc\u51fa\u53d8\u91cf\uff0c\u901a\u8fc7\u547d\u4ee4\u884c\u67e5\u770b\uff0c\u8bbe\u7f6e\u4ee5\u53ca\u4f7f\u7528\u53d8\u91cf\u7684\u503c</p> <ul> <li> <p>\u5bfc\u51fa\u53d8\u91cf</p> <p>\u53d8\u91cf\u5bfc\u51fa\u4f7f\u7528<code>SHELL_EXPORT_VAR</code>\u5b8f\uff0c\u652f\u6301\u6574\u5f62(char, short, int)\uff0c\u5b57\u7b26\u4e32\uff0c\u6307\u9488\u4ee5\u53ca\u8282\u70b9\u53d8\u91cf\uff0c\u53d8\u91cf\u5bfc\u51fa\u9700\u8981\u4f7f\u7528\u5f15\u7528\u7684\u65b9\u5f0f\uff0c\u5982\u679c\u4e0d\u5141\u8bb8\u5bf9\u53d8\u91cf\u8fdb\u884c\u4fee\u6539\uff0c\u5728\u5c5e\u6027\u4e2d\u6dfb\u52a0<code>SHELL_CMD_READ_ONLY</code></p> <pre><code>int varInt = 0;\nSHELL_EXPORT_VAR(SHELL_CMD_PERMISSION(0)|SHELL_CMD_TYPE(SHELL_TYPE_VAR_INT), varInt, &amp;varInt, test);\n\nchar str[] = \"test string\";\nSHELL_EXPORT_VAR(SHELL_CMD_PERMISSION(0)|SHELL_CMD_TYPE(SHELL_TYPE_VAR_STRING), varStr, str, test);\n\nLog log;\nSHELL_EXPORT_VAR(SHELL_CMD_PERMISSION(0)|SHELL_CMD_TYPE(SHELL_TYPE_VAR_POINT), log, &amp;log, test);\n</code></pre> </li> <li> <p>\u67e5\u770b\u53d8\u91cf</p> <p>\u5728\u547d\u4ee4\u884c\u76f4\u63a5\u8f93\u5165\u5bfc\u51fa\u7684\u53d8\u91cf\u540d\u5373\u53ef\u67e5\u770b\u53d8\u91cf\u5f53\u524d\u7684\u503c</p> <pre><code>letter:/$ varInt\nvarInt = 0, 0x00000000\n\nletter:/$ varStr\nvarStr = \"test string\"\n</code></pre> </li> <li> <p>\u4fee\u6539\u53d8\u91cf</p> <p>\u4f7f\u7528<code>setVar</code>\u547d\u4ee4\u4fee\u6539\u53d8\u91cf\u7684\u503c\uff0c\u5bf9\u4e8e\u5b57\u7b26\u4e32\u578b\u53d8\u91cf\uff0c\u8bf7\u786e\u8ba4\u5b57\u7b26\u4e32\u6709\u5206\u914d\u8db3\u591f\u7684\u7a7a\u95f4\uff0c\u6307\u9488\u7c7b\u578b\u7684\u53d8\u91cf\u4e0d\u53ef\u4fee\u6539</p> <pre><code>letter:/$ setVar varInt 45678\nvarInt = 45678, 0x0000b26e\n\nletter:/$ setVar varStr \"hello\"\nvarStr = \"hello\"\n</code></pre> </li> <li> <p>\u4f7f\u7528\u53d8\u91cf</p> <p>letter shell 3.x\u7684\u53d8\u91cf\u53ef\u4ee5\u5728\u547d\u4ee4\u4e2d\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\uff0c\u5bf9\u4e8e\u9700\u8981\u4f20\u9012\u7ed3\u6784\u4f53\u5f15\u7528\u5230\u547d\u4ee4\u4e2d\u7684\u573a\u666f\u7279\u522b\u9002\u7528\uff0c\u4f7f\u7528<code>$</code>+\u53d8\u91cf\u540d\u7684\u65b9\u5f0f\u4f20\u9012</p> <pre><code>letter:/$ shellPrint $shell \"hello world\\r\\n\"\nhello world\n</code></pre> </li> </ul>"},{"location":"Middlewares/shell/#shell","title":"\u5728\u51fd\u6570\u4e2d\u83b7\u53d6\u5f53\u524dshell\u5bf9\u8c61","text":"<p>letter shell\u91c7\u53d6\u4e00\u4e2a\u9759\u6001\u6570\u7ec4\u5bf9\u5b9a\u4e49\u7684\u591a\u4e2ashell\u8fdb\u884c\u7ba1\u7406\uff0cshell\u6570\u91cf\u53ef\u4ee5\u4fee\u6539\u5b8f<code>SHELL_MAX_NUMBER</code>\u5b9a\u4e49(\u4e3a\u4e86\u4e0d\u4f7f\u7528\u52a8\u6001\u5185\u5b58\u5206\u914d\uff0c\u6b64\u5904\u901a\u8fc7\u6570\u636e\u8fdb\u884c\u7ba1\u7406)\uff0c\u4ece\u800c\uff0c\u5728shell\u6267\u884c\u7684\u51fd\u6570\u4e2d\uff0c\u53ef\u4ee5\u8c03\u7528<code>shellGetCurrent()</code>\u83b7\u5f97\u5f53\u524d\u6d3b\u52a8\u7684shell\u5bf9\u8c61\uff0c\u4ece\u800c\u53ef\u4ee5\u5b9e\u73b0\u67d0\u4e00\u4e2a\u51fd\u6570\u5728\u4e0d\u540c\u7684shell\u5bf9\u8c61\u4e2d\u53d1\u751f\u4e0d\u540c\u7684\u884c\u4e3a\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u83b7\u5f97shell\u5bf9\u8c61\u540e\uff0c\u8c03\u7528<code>shellWriteString(shell, string)</code>\u8fdb\u884cshell\u7684\u8f93\u51fa</p>"},{"location":"Middlewares/shell/#_7","title":"\u6267\u884c\u672a\u5bfc\u51fa\u51fd\u6570","text":"<p>letter shell\u652f\u6301\u901a\u8fc7\u51fd\u6570\u5730\u5740\u76f4\u63a5\u6267\u884c\u51fd\u6570\uff0c\u53ef\u4ee5\u65b9\u4fbf\u6267\u884c\u90a3\u4e9b\u6ca1\u6709\u5bfc\u51fa\uff0c\u4f46\u662f\u53c8\u4e34\u65f6\u9700\u8981\u4f7f\u7528\u7684\u51fd\u6570\uff0c\u4f7f\u7528\u547d\u4ee4<code>exec [addr] [args]</code>\u6267\u884c\uff0c\u4f7f\u7528\u6b64\u529f\u80fd\u9700\u8981\u5f00\u542f<code>SHELL_EXEC_UNDEF_FUNC</code>\u5b8f\uff0c\u6ce8\u610f\uff0c\u7531\u4e8e\u76f4\u63a5\u64cd\u4f5c\u51fd\u6570\u5730\u5740\u6267\u884c\uff0c\u5982\u679c\u7ed9\u8fdb\u7684\u5730\u5740\u6709\u8bef\uff0c\u53ef\u80fd\u5f15\u8d77\u7a0b\u5e8f\u5d29\u6e83</p> <p>\u51fd\u6570\u7684\u5730\u5740\u53ef\u4ee5\u901a\u8fc7\u7f16\u8bd1\u751f\u6210\u7684\u6587\u4ef6\u67e5\u627e\uff0c\u6bd4\u5982\u8bf4\u5bf9\u4e8ekeil\uff0c\u53ef\u4ee5\u5728<code>.map</code>\u6587\u4ef6\u4e2d\u67e5\u627e\u5230\u6bcf\u4e2a\u51fd\u6570\u7684\u5730\u5740\uff0c\u4f46\u662f\u8981\u6ce8\u610f\u6709\u4e9b\u5e73\u53f0\u53ef\u80fd\u9700\u8981\u8981\u5bf9\u5730\u5740\u505a\u8fdb\u4e00\u6b65\u5904\u7406\uff0c\u6bd4\u5982\u8bf4\u5bf9\u4e8e arm \u5e73\u53f0\uff0c\u5982\u679c\u4f7f\u7528\u7684\u662f Thumb \u6307\u4ee4\u96c6\uff0c\u90a3\u4e48\u9700\u8981\u5c06\u5730\u5740\u7684\u6700\u4f4e\u4f4d\u7f6e 1\uff0c\u6bd4\u5982\u8bf4<code>shellClear</code>\u51fd\u6570\u5730\u5740\u4e3a<code>0x08028620</code>\uff0c\u5219\u901a\u8fc7<code>exec</code>\u6267\u884c\u5e94\u4e3a<code>exec 0x08028621</code></p> <p>\u5176\u4ed6\u7f16\u8bd1\u5668\u67e5\u627e\u51fd\u6570\u5730\u5740\u7684\u65b9\u5f0f\u548c\u5730\u5740\u504f\u79fb\u7684\u5904\u7406\uff0c\u8bf7\u53c2\u8003\u5404\u7f16\u8bd1\u5668\u624b\u518c</p>"},{"location":"Middlewares/shell/#_8","title":"\u547d\u4ee4\u5b9a\u4e49","text":"<p>letter shell 3.x\u5c06\u53ef\u6267\u884c\u7684\u51fd\u6570\u547d\u4ee4\u5b9a\u4e49\uff0c\u7528\u6237\u5b9a\u4e49\uff0c\u6309\u952e\u5b9a\u4e49\u4ee5\u53ca\u53d8\u91cf\u5b9a\u4e49\u7edf\u4e00\u5f52\u4e3a\u547d\u4ee4\u5b9a\u4e49\uff0c\u4f7f\u7528\u76f8\u540c\u7684\u7ed3\u6784\u50a8\u5b58\uff0c\u67e5\u627e\u548c\u6267\u884c</p>"},{"location":"Middlewares/shell/#_9","title":"\u5b9a\u4e49\u65b9\u5f0f","text":"<p>letter shell \u652f\u6301\u4f7f\u7528\u547d\u4ee4\u5bfc\u51fa\u65b9\u5f0f\u548c\u547d\u4ee4\u8868\u65b9\u5f0f\u8fdb\u884c\u547d\u4ee4\u7684\u6dfb\u52a0\uff0c\u5b9a\u4e49\uff0c\u901a\u8fc7\u5b8f<code>SHELL_USING_CMD_EXPORT</code>\u63a7\u5236</p> <p>\u547d\u4ee4\u5bfc\u51fa\u65b9\u5f0f\u652f\u6301keil\uff0cIAR\u4ee5\u53caGCC</p> <ol> <li> <p>\u547d\u4ee4\u5bfc\u51fa\u65b9\u5f0f</p> <p>letter shell \u652f\u6301\u5728\u51fd\u6570\u4f53\u5916\u90e8\uff0c\u91c7\u7528\u5b9a\u4e49\u5e38\u91cf\u7684\u65b9\u5f0f\u5b9a\u4e49\u547d\u4ee4\uff0c\u4f8b\u5982<code>SHELL_EXPORT_CMD(SHELL_CMD_PERMISSION(0)|SHELL_CMD_TYPE (SHELL_TYPE_CMD_MAIN)|SHELL_CMD_DISABLE_RETURN,help, shellHelp, show command info\\r\\nhelp [cmd]);</code></p> <p>\u5bf9\u4e8e\u4f7f\u7528keil\u8fdb\u884c\u7f16\u8bd1\uff0c\u9700\u8981\u5728keil\u7684target option\u4e2d\u589e\u52a0--keep shellCommand*\uff0c\u9632\u6b62\u5b9a\u4e49\u7684\u547d\u4ee4\u88ab\u4f18\u5316\u6389</p> <p>\u4f7f\u7528GCC\u7f16\u8bd1\u65f6\uff0c\u9700\u8981\u5728ld\u6587\u4ef6\u4e2d\u7684\u53ea\u8bfb\u6570\u636e\u533a(\u5efa\u8bae)\u6dfb\u52a0\uff1a</p> <pre><code>_shell_command_start = .;\nKEEP (*(shellCommand))\n_shell_command_end = .;\n</code></pre> </li> <li> <p>\u547d\u4ee4\u8868\u65b9\u5f0f</p> <ul> <li> <p>\u5f53\u4f7f\u7528\u5176\u4ed6\u6682\u65f6\u4e0d\u652f\u6301\u4f7f\u7528\u547d\u4ee4\u5bfc\u51fa\u65b9\u5f0f\u7684\u7f16\u8bd1\u5668\u65f6\uff0c\u9700\u8981\u5728<code>shell_cmd_list.c</code>\u6587\u4ef6\u7684\u547d\u4ee4\u8868\u4e2d\u6dfb\u52a0</p> <pre><code>const SHELL_CommandTypeDef shellDefaultCommandList[] =\n{\n    SHELL_CMD_ITEM(\n               SHELL_CMD_PERMISSION(0)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_MAIN)|SHELL_CMD_DISABLE_RETURN,\n               help, shellHelp, show command info\\r\\nhelp [cmd]),\n};\n</code></pre> </li> </ul> </li> </ol>"},{"location":"Middlewares/shell/#_10","title":"\u5b9a\u4e49\u5b8f\u8bf4\u660e","text":"<p>letter shell 3.x\u5bf9\u53ef\u6267\u884c\u547d\u4ee4\uff0c\u6309\u952e\uff0c\u7528\u6237\u4ee5\u53ca\u53d8\u91cf\u5206\u522b\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b8f\uff0c\u7528\u4e8e\u8fdb\u884c\u547d\u4ee4\u5b9a\u4e49</p> <ol> <li> <p>\u53ef\u6267\u884c\u547d\u4ee4\u5b9a\u4e49</p> <p>\u4f7f\u7528\u5b8f<code>SHELL_EXPORT_CMD</code>\u5b9a\u4e49\u53ef\u6267\u884c\u547d\u4ee4\uff0c\u5b9a\u4e49\u5982\u4e0b</p> <pre><code>/**\n * @brief shell \u547d\u4ee4\u5b9a\u4e49\n *\n * @param _attr \u547d\u4ee4\u5c5e\u6027\n * @param _name \u547d\u4ee4\u540d\n * @param _func \u547d\u4ee4\u51fd\u6570\n * @param _desc \u547d\u4ee4\u63cf\u8ff0\n */\n#define SHELL_EXPORT_CMD(_attr, _name, _func, _desc) \\\n        const char shellCmd##_name[] = #_name; \\\n        const char shellDesc##_name[] = #_desc; \\\n        SHELL_USED const ShellCommand \\\n        shellCommand##_name SHELL_SECTION(\"shellCommand\") =  \\\n        { \\\n            .attr.value = _attr, \\\n            .data.cmd.name = shellCmd##_name, \\\n            .data.cmd.function = (int (*)())_func, \\\n            .data.cmd.desc = shellDesc##_name \\\n        }\n</code></pre> </li> <li> <p>\u53d8\u91cf\u5b9a\u4e49</p> <p>\u4f7f\u7528\u5b8f<code>SHELL_EXPORT_VAR</code>\u5b9a\u4e49\u53d8\u91cf\uff0c\u5b9a\u4e49\u5982\u4e0b</p> <pre><code>/**\n * @brief shell \u53d8\u91cf\u5b9a\u4e49\n *\n * @param _attr \u53d8\u91cf\u5c5e\u6027\n * @param _name \u53d8\u91cf\u540d\n * @param _value \u53d8\u91cf\u503c\n * @param _desc \u53d8\u91cf\u63cf\u8ff0\n */\n#define SHELL_EXPORT_VAR(_attr, _name, _value, _desc) \\\n        const char shellCmd##_name[] = #_name; \\\n        const char shellDesc##_name[] = #_desc; \\\n        SHELL_USED const ShellCommand \\\n        shellVar##_name SHELL_SECTION(\"shellCommand\") =  \\\n        { \\\n            .attr.value = _attr, \\\n            .data.var.name = shellCmd##_name, \\\n            .data.var.value = (void *)_value, \\\n            .data.var.desc = shellDesc##_name \\\n        }\n</code></pre> <p>\u53d8\u91cf\u5b9a\u4e49\u65f6\uff0c<code>_value</code>\u5e94\u8be5\u662f\u53d8\u91cf\u7684\u5f15\u7528\uff0c\u5982\u679c\u53d8\u91cf\u4e0d\u5141\u8bb8\u4fee\u6539\uff0c\u5219\u9700\u8981\u5728\u589e\u52a0<code>SHELL_CMD_READ_ONLY</code>\u5c5e\u6027</p> </li> <li> <p>\u7528\u6237\u5b9a\u4e49</p> <p>\u4f7f\u7528\u5b8f<code>SHELL_EXPORT_USER</code>\u5b9a\u4e49\u7528\u6237\uff0c\u5b9a\u4e49\u5982\u4e0b</p> <pre><code>/**\n * @brief shell \u7528\u6237\u5b9a\u4e49\n *\n * @param _attr \u7528\u6237\u5c5e\u6027\n * @param _name \u7528\u6237\u540d\n * @param _password \u7528\u6237\u5bc6\u7801\n * @param _desc \u7528\u6237\u63cf\u8ff0\n */\n#define SHELL_EXPORT_USER(_attr, _name, _password, _desc) \\\n        const char shellCmd##_name[] = #_name; \\\n        const char shellPassword##_name[] = #_password; \\\n        const char shellDesc##_name[] = #_desc; \\\n        SHELL_USED const ShellCommand \\\n        shellUser##_name SHELL_SECTION(\"shellCommand\") =  \\\n        { \\\n            .attr.value = _attr|SHELL_CMD_TYPE(SHELL_TYPE_USER), \\\n            .data.user.name = shellCmd##_name, \\\n            .data.user.password = shellPassword##_name, \\\n            .data.user.desc = shellDesc##_name \\\n        }\n</code></pre> </li> <li> <p>\u6309\u952e\u5b9a\u4e49</p> <p>\u4f7f\u7528\u5b8f<code>SHELL_EXPORT_KEY</code>\u5b9a\u4e49\u6309\u952e\uff0c\u5b9a\u4e49\u5982\u4e0b</p> <pre><code>/**\n * @brief shell \u6309\u952e\u5b9a\u4e49\n *\n * @param _attr \u6309\u952e\u5c5e\u6027\n * @param _value \u6309\u952e\u952e\u503c\n * @param _func \u6309\u952e\u51fd\u6570\n * @param _desc \u6309\u952e\u63cf\u8ff0\n */\n#define SHELL_EXPORT_KEY(_attr, _value, _func, _desc) \\\n        const char shellDesc##_value[] = #_desc; \\\n        SHELL_USED const ShellCommand \\\n        shellKey##_value SHELL_SECTION(\"shellCommand\") =  \\\n        { \\\n            .attr.value = _attr|SHELL_CMD_TYPE(SHELL_TYPE_KEY), \\\n            .data.key.value = _value, \\\n            .data.key.function = (void (*)(Shell *))_func, \\\n            .data.key.desc = shellDesc##_value \\\n        }\n</code></pre> <p>\u6309\u952e\u952e\u503c\u4e3a\u5728\u7ec8\u7aef\u8f93\u5165\u6309\u952e\u4f1a\u53d1\u9001\u7684\u5b57\u7b26\u4e32\u5e8f\u5217\uff0c\u4ee5\u5927\u7aef\u6a21\u5f0f\u8868\u793a\uff0c\u6bd4\u5982\u5728SecureCRT\u4e2d\u65ad\uff0c\u6309\u4e0bTab\u952e\uff0c\u4f1a\u53d1\u90010x0B\uff0c\u5219\u8fd9\u4e2a\u6309\u952e\u7684\u952e\u503c\u4e3a0x0B000000\uff0c\u5982\u679c\u6309\u4e0b\u65b9\u5411\u4e0a\uff0c\u4f1a\u4f9d\u6b21\u53d1\u90010x1B, 0x5B, 0x41, \u5219\u8fd9\u4e2a\u952e\u7684\u952e\u503c\u4e3a0x1B5B4100</p> </li> </ol>"},{"location":"Middlewares/shell/#_11","title":"\u547d\u4ee4\u5c5e\u6027\u5b57\u6bb5\u8bf4\u660e","text":"<p>\u5728\u547d\u4ee4\u5b9a\u4e49\u4e2d\uff0c\u6709\u4e00\u4e2a<code>attr</code>\u5b57\u6bb5\uff0c\u8868\u793a\u8be5\u547d\u4ee4\u7684\u5c5e\u6027\uff0c\u5177\u4f53\u5b9a\u4e49\u4e3a</p> <pre><code>union\n{\n    struct\n    {\n        unsigned char permission : 8;                       /**&lt; command\u6743\u9650 */\n        ShellCommandType type : 4;                          /**&lt; command\u7c7b\u578b */\n        unsigned char enableUnchecked : 1;                  /**&lt; \u5728\u672a\u6821\u9a8c\u5bc6\u7801\u7684\u60c5\u51b5\u4e0b\u53ef\u7528 */\n        unsigned char  readOnly : 1;                        /**&lt; \u53ea\u8bfb */\n        unsigned char reserve : 1;                          /**&lt; \u4fdd\u7559 */\n        unsigned char paramNum : 4;                         /**&lt; \u53c2\u6570\u6570\u91cf */\n    } attrs;\n    int value;\n} attr;\n</code></pre> <p>\u5728\u5b9a\u4e49\u547d\u4ee4\u65f6\uff0c\u9700\u8981\u7ed9\u5b9a\u8fd9\u4e9b\u503c\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b8f<code>SHELL_CMD_PERMISSION(permission)</code>, <code>SHELL_CMD_TYPE(type)</code>, <code>SHELL_CMD_ENABLE_UNCHECKED</code>, <code>SHELL_CMD_DISABLE_RETURN</code>, <code>SHELL_CMD_READ_ONLY</code>, <code>SHELL_CMD_PARAM_NUM(num)</code>\u5feb\u901f\u58f0\u660e</p>"},{"location":"Middlewares/shell/#_12","title":"\u4ee3\u7406\u51fd\u6570\u548c\u4ee3\u7406\u53c2\u6570\u89e3\u6790","text":"<p>letter shell 3.x\u539f\u751f\u652f\u6301\u5c06\u6574\u6570\uff0c\u5b57\u7b26\uff0c\u5b57\u7b26\u4e32\u53c2\u6570\uff0c\u4ee5\u53ca\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u7684\u6d6e\u70b9\u53c2\u6570\u76f4\u63a5\u4f20\u9012\u7ed9\u6267\u884c\u547d\u4ee4\u7684\u51fd\u6570\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u51e0\u79cd\u53c2\u6570\u7c7b\u578b\u5b8c\u5168\u53ef\u4ee5\u6ee1\u8db3\u8c03\u8bd5\u9700\u8981\uff0c\u7136\u800c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u786e\u5b9e\u9700\u8981\u4f20\u9012\u5176\u4ed6\u7c7b\u578b\u7684\u53c2\u6570\uff0c\u6b64\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9\u5c06\u547d\u4ee4\u5b9a\u4e49\u6210main\u51fd\u6570\u5f62\u5f0f\uff0c\u4f7f\u7528\u5b57\u7b26\u4e32\u4f20\u9012\u53c2\u6570\uff0c\u7136\u540e\u81ea\u884c\u5bf9\u53c2\u6570\u8fdb\u884c\u89e3\u6790\uff0c\u9664\u6b64\u4e4b\u5916\uff0cletter shell\u8fd8\u63d0\u4f9b\u4e86\u4ee3\u7406\u51fd\u6570\u7684\u673a\u5236\uff0c\u53ef\u4ee5\u5bf9\u4efb\u610f\u7c7b\u578b\u7684\u53c2\u6570\u8fdb\u884c\u81ea\u5b9a\u4e49\u89e3\u6790</p> <p>\u5173\u4e8e\u4ee3\u7406\u51fd\u6570\u7684\u5b9e\u73b0\u539f\u7406\u548c\u5177\u4f53\u4f7f\u7528\u793a\u4f8b\uff0c\u53ef\u4ee5\u53c2\u8003letter-shell\u4ee3\u7406\u51fd\u6570\u89e3\u6790</p> <p>\u4f7f\u7528\u4ee3\u7406\u51fd\u6570\uff0c\u7528\u6237\u9700\u8981\u81ea\u5b9a\u4e49\u4ee3\u7406\u53c2\u6570\u89e3\u6790\u5668\uff0c\u5373\u4e00\u4e2a\u5c06\u57fa\u672c\u53c2\u6570(\u6574\u6570\uff0c\u5b57\u7b26\uff0c\u5b57\u7b26\u4e32\u53c2\u6570)\u8f6c\u6362\u6210\u76ee\u6807\u7c7b\u578b\u53c2\u6570\u7684\u51fd\u6570\u6216\u8005\u5b8f\uff0cletter shell\u9ed8\u8ba4\u5b9e\u73b0\u4e86\u6d6e\u70b9\u7c7b\u578b\u7684\u53c2\u6570\u89e3\u6790\u5668<code>SHELL_PARAM_FLOAT(x)</code></p> <p>\u7136\u540e\uff0c\u4f7f\u7528\u4ee3\u7406\u51fd\u6570\u547d\u4ee4\u5bfc\u51fa\u5b8f\u5b9a\u4e49\u547d\u4ee4\uff0c\u6bd4\u5982\u9700\u8981\u9700\u8981\u4f20\u9012\u591a\u4e2a\u6d6e\u70b9\u53c2\u6570\u7684\u51fd\u6570\uff0c\u5982\u4e0b</p> <pre><code>void test(int a, float b, int c, float d)\n{\n    printf(\"%d, %f, %d, %f \\r\\n\", a, b, c, d);\n}\nSHELL_EXPORT_CMD_AGENCY(SHELL_CMD_TYPE(SHELL_TYPE_CMD_FUNC),\ntest, test, test,\np1, SHELL_PARAM_FLOAT(p2), p3, SHELL_PARAM_FLOAT(p4));\n</code></pre> <p>\u76f8\u6bd4\u5e38\u89c4\u7684\u547d\u4ee4\u5bfc\u51fa\uff0c\u4ee3\u7406\u51fd\u6570\u547d\u4ee4\u5bfc\u51fa\u524d4\u4e2a\u53c2\u6570\u548c\u5e38\u89c4\u5f62\u5f0f\u7684\u547d\u4ee4\u5bfc\u51fa\u4e00\u81f4\uff0c\u4e4b\u540e\u7684\u53c2\u6570\u5373\u4f20\u9012\u81f3\u76ee\u6807\u51fd\u6570\u7684\u53c2\u6570\uff0cletter shell\u9ed8\u8ba4\u5b9e\u73b0\u7684\u4ee3\u7406\u51fd\u6570\u5b9a\u4e49\u652f\u6301\u6700\u591a7\u4e2a\u53c2\u6570\uff0cp1~p7\uff0c\u5bf9\u4e8e\u4e0d\u9700\u8981\u4ee3\u7406\u53c2\u6570\u89e3\u6790\u7684\u53c2\u6570\uff0c\u53ea\u9700\u8981\u5bf9\u5e94\u5199\u5165<code>px(x\u4e3a1~7)</code>\u5373\u53ef\uff0c\u6bd4\u5982\u4e0a\u65b9\u793a\u4f8b\u7684<code>p1</code>\u548c<code>p3</code>\uff0c\u800c\u9700\u8981\u4ee3\u7406\u53c2\u6570\u89e3\u6790\u7684\u53c2\u6570\uff0c\u5219\u9700\u8981\u4f7f\u7528\u5bf9\u5e94\u7684\u53c2\u6570\u89e3\u6790\u5668\uff0c\u6bd4\u5982\u4e0a\u65b9\u793a\u4f8b\u7684<code>p2</code>\u548c<code>p4</code></p>"},{"location":"Middlewares/shell/#_13","title":"\u51fd\u6570\u7b7e\u540d","text":"<p>letter shell 3.2.x \u4e4b\u540e\uff0c\u5f15\u5165\u4e86\u51fd\u6570\u7b7e\u540d\u7684\u6982\u5ff5\uff0c\u4ee5\u4fbf\u4e8e\u53c2\u6570\u81ea\u52a8\u89e3\u6790</p> <p>\u4e4b\u524d\u7684\u7248\u672c\u91cc\uff0c\u5982\u679c\u58f0\u660e\u7684\u547d\u4ee4\u662f <code>SHELL_TYPE_CMD_FUNC</code>\uff0cshell \u4f1a\u81ea\u52a8\u8fdb\u884c\u53c2\u6570\u7684\u8f6c\u6362\uff0c\u4f46\u662f\u53c2\u6570\u8f6c\u6362\u540e\u7684\u7c7b\u578b\u662f\u731c\u51fa\u6765\u7684\uff0c\u65e0\u6cd5\u4fdd\u8bc1\u8f6c\u6362\u540e\u7684\u6570\u636e\u7c7b\u578b\u662f\u6b63\u786e\u7684\uff0c\u4e00\u65e6\u731c\u9519\u4e86\uff0c\u5c31\u5bb9\u6613\u5bfc\u81f4\u7a0b\u5e8f\u6302\u6389</p> <p>\u7531\u6b64\uff0c\u501f\u9274 Java \u7b49\u8bed\u8a00\u7684\u51fd\u6570\u7b7e\u540d\uff0c\u65b0\u7248\u4e5f\u5f15\u5165\u4e86\u51fd\u6570\u7b7e\u540d\u7684\u6982\u5ff5\uff0c\u5728\u58f0\u660e\u547d\u4ee4\u65f6\uff0c\u53ef\u4ee5\u7ed9\u5b9a\u6700\u7ec8\u6267\u884c\u547d\u4ee4\u7684\u51fd\u6570\u7684\u7b7e\u540d\uff0cshell \u6839\u636e\u8fd9\u4e2a\u7b7e\u540d\u8fdb\u884c\u53c2\u6570\u8f6c\u6362\uff0c\u4f7f\u7528\u6b64\u529f\u80fd\u65f6\uff0c\u9700\u8981\u6253\u5f00\u5b8f <code>SHELL_USING_FUNC_SIGNATURE</code></p> <p>\u51fd\u6570\u7b7e\u540d\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u901a\u8fc7\u8fd9\u4e2a\u5b57\u7b26\u4e32\u58f0\u660e\u8868\u8fbe\u51fd\u6570\u7684\u53c2\u6570\u7c7b\u578b\uff0c\u8fd4\u56de\u503c\u4e0d\u58f0\u660e\uff0c\u6bd4\u5982\u4e00\u4e2a\u51fd\u6570<code>int func(int a, char *b, char c)</code>\uff0c\u5b83\u7684\u51fd\u6570\u7b7e\u540d\u5c31\u662f <code>isc</code></p> <p>\u57fa\u672c\u7c7b\u578b\u7684\u53c2\u6570\u7b7e\u540d\u5b9a\u4e49\u5982\u4e0b:</p> \u7c7b\u578b \u7b7e\u540d char(\u5b57\u7b26) c char(\u6570\u5b57) q short(\u6570\u5b57) h int(\u6570\u5b57) i char * (\u5b57\u7b26\u4e32) s pointer p <p>\u58f0\u660e\u547d\u4ee4\u65f6\uff0c\u5728\u6700\u540e\u6dfb\u52a0\u4e00\u4e2a\u53c2\u6570 <code>.data.cmd.signature = \"isc\"</code> \u5373\u53ef\uff0c\u6bd4\u5982\uff1a</p> <pre><code>void shellFuncSignatureTest(int a, char *b, char c)\n{\n    printf(\"a = %d, b = %s, c = %c\\r\\n\", a, b, c);\n}\nSHELL_EXPORT_CMD(SHELL_CMD_PERMISSION(0)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_FUNC),\nfuncSignatureTest, shellFuncSignatureTest, test function signature, .data.cmd.signature = \"isc\");\n</code></pre>"},{"location":"Middlewares/shell/#_14","title":"\u81ea\u5b9a\u4e49\u7c7b\u578b\u89e3\u6790","text":"<p>\u7531\u4e8e\u51fd\u6570\u7b7e\u540d\u7684\u5f15\u7528\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u51fd\u6570\u7b7e\u540d\u63cf\u8ff0\u4efb\u4f55\u53c2\u6570\uff0c\u5bf9\u5e94\u7684\uff0c\u5728\u53c2\u6570\u7c7b\u578b\u5df2\u77e5\u7684\u60c5\u51b5\u4e0b\uff0c\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u5bf9\u5e94\u7684\u53c2\u6570\u89e3\u6790\u5668\u8fdb\u884c\u53c2\u6570\u89e3\u6790\uff0c\u81ea\u5b9a\u4e49\u7684\u53c2\u6570\u7c7b\u578b\u7b7e\u540d\u9700\u8981\u4ee5 <code>L</code> \u5f00\u5934\uff0c\u4ee5 <code>;</code> \u7ed3\u5c3e\uff0c\u6bd4\u5982\u8bf4\u5b9a\u4e49\u4e00\u4e2a <code>TestStruct</code> \u7ed3\u6784\u4f53\u7c7b\u578b\u4e3a <code>LTestStruct;</code>\uff0c\u90a3\u4e48\u63a5\u6536\u8fd9\u4e2a\u7ed3\u6784\u4f53\u4e3a\u53c2\u6570\u7684\u51fd\u6570\u5c31\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u7c7b\u578b\u7b7e\u540d\u5b9a\u4e49\u51fd\u6570\u7b7e\u540d\uff0c\u5e76\u5bfc\u51fa\u547d\u4ee4</p> <pre><code>typedef struct {\n    int a;\n    char *b;\n} TestStruct;\n\nvoid shellParamParserTest(int a, TestStruct *data, char *c)\n{\n    printf(\"a = %d, data-&gt;a = %d, data-&gt;b = %s, c = %s\\r\\n\", a, data-&gt;a, data-&gt;b, c);\n}\nSHELL_EXPORT_CMD_SIGN(SHELL_CMD_PERMISSION(0)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_FUNC),\nparamParserTest, shellParamParserTest, test function signature and param parser, iLTestStruct;s);\n</code></pre> <p>\u540c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u81ea\u5b9a\u4e49\u7684\u7c7b\u578b\u5b9a\u4e49\u89e3\u6790\u5668\uff0c\u4f7f\u7528 <code>SHELL_EXPORT_PARAM_PARSER</code> \u5b8f</p> <pre><code>int testStructParser(char *string, void **param)\n{\n    TestStruct *data = malloc(sizeof(TestStruct));\n    data-&gt;b = malloc(16);\n    if (sscanf(string, \"%d %s\", &amp;(data-&gt;a), data-&gt;b) == 2)\n    {\n        *param = (void *)data;\n        return 0;\n    }\n    return -1;\n}\n\nint testStructClener(void *param)\n{\n    TestStruct *data = (TestStruct *)param;\n    free(data-&gt;b);\n    free(data);\n    return 0;\n}\nSHELL_EXPORT_PARAM_PARSER(0, LTestStruct;, testStructParser, testStructClener);\n</code></pre> <p><code>SHELL_EXPORT_PARAM_PARSER</code> \u63a5\u6536\u56db\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u8868\u793a\u5c5e\u6027\uff0c\u8fd9\u91cc\u4e00\u822c\u586b 0 \u7686\u53ef\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f\u89e3\u6790\u5668\u5bf9\u5e94\u7684\u7c7b\u578b\u7b7e\u540d\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u89e3\u6790\u5668\u51fd\u6570\uff0c\u7b2c\u56db\u4e2a\u53c2\u6570\u662f\u6e05\u7406\u51fd\u6570\uff0c\u6e05\u7406\u51fd\u6570\u5728\u53c2\u6570\u89e3\u6790\u5931\u8d25\u6216\u8005\u547d\u4ee4\u6267\u884c\u5b8c\u6bd5\u540e\u4f1a\u88ab\u8c03\u7528\uff0c\u4e00\u822c\u7528\u4e8e\u6e05\u7406\u89e3\u6790\u5668\u5206\u914d\u7684\u5185\u5b58\uff0c\u5982\u679c\u4e0d\u9700\u8981\u6e05\u7406\u51fd\u6570\uff0c\u586b <code>NULL</code> \u5373\u53ef</p> <p>\u89e3\u6790\u5668\u51fd\u6570\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8f93\u5165\u7684\u5b57\u7b26\u4e32\uff0c\u4e5f\u5c31\u662f\u547d\u4ee4\u884c\u8f93\u5165\u7684\u53c2\u6570\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u89e3\u6790\u540e\u7684\u53c2\u6570\uff0c\u89e3\u6790\u6210\u529f\u540e\uff0c\u9700\u8981\u5c06\u89e3\u6790\u540e\u7684\u53c2\u6570\u8d4b\u503c\u7ed9\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff0c\u89e3\u6790\u6210\u529f\u8fd4\u56de 0\uff0c\u89e3\u6790\u5931\u8d25\u8fd4\u56de -1</p> <p>\u6e05\u7406\u51fd\u6570\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\uff0c\u5c31\u662f\u89e3\u6790\u5668\u51fd\u6570\u89e3\u6790\u5f97\u5230\u7684\u7ed3\u679c</p>"},{"location":"Middlewares/shell/#_15","title":"\u6570\u7ec4\u53c2\u6570","text":"<p>letter shell 3.2.2 \u4e4b\u540e\uff0c\u57fa\u4e8e\u51fd\u6570\u7b7e\u540d\uff0c\u6211\u4eec\u652f\u6301\u4e86\u5bf9\u6570\u7ec4\u53c2\u6570\u7684\u76f4\u63a5\u89e3\u6790\uff0c\u4f7f\u7528\u65f6\uff0c\u9700\u8981\u6253\u5f00\u5b8f <code>SHELL_SUPPORT_ARRAY_PARAM</code>, \u5e76\u4e14\u914d\u7f6e\u597d <code>SHELL_MALLOC</code> \u548c <code>SHELL_FREE</code></p> <p>\u6570\u7ec4\u7684\u53c2\u6570\u7b7e\u540d\uff0c\u53ea\u9700\u8981\u5728\u5e38\u89c4\u53c2\u6570\u7b7e\u540d\u524d\u52a0\u4e0a <code>[</code>, \u6bd4\u5982\uff0c\u5bf9\u4e8e <code>int</code> \u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u4ed6\u7684\u7b7e\u540d\u4e3a <code>[i</code></p> <p>\u547d\u4ee4\u884c\u8c03\u7528\u65f6\uff0c\u6570\u7ec4\u53c2\u6570\u4f7f\u7528 <code>[]</code> \u5305\u88f9\uff0c\u6bcf\u4e2a\u5143\u7d20\u4e4b\u95f4\u7528 <code>,</code> \u5206\u9694\uff0c\u6bd4\u5982 <code>func [1,2,3,4]</code></p> <pre><code>int shellArrayTest(int a, int *b, TestStruct **datas)\n{\n    int i;\n    printf(\"a = %d, b = %p, datas = %p\\r\\n\", a, b, datas);\n    for (i = 0; i &lt; shellGetArrayParamSize(b); i++)\n    {\n        printf(\"b[%d] = %d\\r\\n\", i, b[i]);\n    }\n    for (i = 0; i &lt; shellGetArrayParamSize(datas); i++)\n    {\n        printf(\"datas[%d]-&gt;a = %d, datas[%d]-&gt;b = %s\\r\\n\", i, datas[i]-&gt;a, i, datas[i]-&gt;b);\n    }\n    return 0;\n}\nSHELL_EXPORT_CMD_SIGN(SHELL_CMD_PERMISSION(0)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_FUNC),\narrayTest, shellArrayTest, test array param parser, i[i[LTestStruct;);\n</code></pre> <p>\u547d\u4ee4\u6267\u884c\u5982\u4e0b</p> <pre><code>letter:/workspaces/letter-shell/demo/x86-gcc$ arrayTest 12 [65, 89, 45] [\"100 hello\", \"56 world\"]\na = 12, b = 0x1d2db24, datas = 0x1d2db44\nb[0] = 65\nb[1] = 89\nb[2] = 45\ndatas[0]-&gt;a = 100, datas[0]-&gt;b = hello\ndatas[1]-&gt;a = 56, datas[1]-&gt;b = world\nReturn: 0, 0x00000000\n</code></pre> <p>\u6ce8\u610f\uff0c\u4f7f\u7528\u6570\u7ec4\u53c2\u6570\u65f6\uff0c<code>char</code>\uff0c<code>short</code>\uff0c<code>int</code> \u4e0d\u53ef\u4ee5\u5171\u7528 <code>i</code> \u7684\u7b7e\u540d\uff0c\u9700\u8981\u5206\u522b\u4f7f\u7528 <code>q</code> (quarter), <code>h</code> (half)</p>"},{"location":"Middlewares/shell/#_16","title":"\u6743\u9650\u7cfb\u7edf\u8bf4\u660e","text":"<p>letter shell 3.x\u7684\u6743\u9650\u7ba1\u7406\u540c\u7528\u6237\u5b9a\u4e49\u7d27\u5bc6\u76f8\u5173\uff0cletter shell 3.x\u4f7f\u75288\u4e2abit\u4f4d\u8868\u793a\u547d\u4ee4\u6743\u9650\uff0c\u5f53\u7528\u6237\u548c\u547d\u4ee4\u7684\u6743\u9650\u6309\u4f4d\u4e0e\u4e3a\u771f\uff0c\u6216\u8005\u547d\u4ee4\u6743\u9650\u4e3a0\u65f6\uff0c\u8868\u793a\u8be5\u7528\u6237\u62e5\u6709\u6b64\u547d\u4ee4\u7684\u6743\u9650\uff0c\u53ef\u4ee5\u8c03\u7528\u8be5\u547d\u4ee4</p>"},{"location":"Middlewares/shell/#_17","title":"\u9501\u8bf4\u660e","text":"<p>letter shell 3.1\u589e\u52a0\u4e86shell\u9501\uff0c\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u9632\u6b62shell\u8f93\u51fa\u548c\u5176\u4ed6\u8f93\u5165(\u6bd4\u5982\u8bf4\u65e5\u5fd7)\u5bf9\u7ec8\u7aef\u7684\u7ade\u4e89\uff0c\u5bfc\u81f4\u8f93\u51fa\u6df7\u4e71\u7684\u73b0\u8c61\uff0c\u5982\u679c\u4f7f\u7528\u573a\u666f\u4e2d\u6ca1\u6709\u51fa\u73b0\u7ec8\u7aef\u8f93\u51fa\u6df7\u4e71\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u4e0d\u4f7f\u7528shell\u9501</p> <p>\u6ce8\u610f: \u8bf7\u4f7f\u7528\u652f\u6301\u5d4c\u5957\u7684\u9501</p> <ol> <li> <p>\u4f7f\u80fd\u5b8f\u5e76\u5b9e\u73b0\u9501</p> <p>\u4f7f\u80fd<code>SHELL_USING_LOCK</code>\u5b8f\uff0c\u5b9e\u73b0shell\u4e0a\u9501\u548c\u89e3\u9501\u51fd\u6570\uff0c\u51fd\u6570\u539f\u578b\u5982\u4e0b\uff1a</p> <pre><code>/**\n * @brief shell\u4e0a\u9501\n *\n * @param struct shell_def shell\u5bf9\u8c61\n *\n * @return 0\n */\ntypedef int (*shellLock)(struct shell_def *);\n\n/**\n * @brief shell\u89e3\u9501\n *\n * @param struct shell_def shell\u5bf9\u8c61\n *\n * @return 0\n */\ntypedef int (*shellLock)(struct shell_def *);\n</code></pre> </li> <li> <p>\u4f7f\u7528\u9501</p> <p>\u5728\u53ef\u80fd\u4ea7\u751f\u7ec8\u7aef\u7ade\u4e89\u7684\u5730\u65b9\uff0c\u52a0\u4e0ashell\u9501\uff0c\u6bd4\u5982\u5982\u679c\u8c03\u7528<code>shellPrint</code>\u8fdb\u884c\u683c\u5f0f\u5316\u8f93\u51fa</p> <pre><code>SHELL_LOCK(shell);\nshellPrint(shell, ...);\nSHELL_UNLOCK(shell);\n</code></pre> </li> <li> <p>\u6ce8\u610f</p> <ul> <li>\u4e0d\u8981\u5728shell\u547d\u4ee4\u4e2d\u8c03\u7528shell\u9501\uff0c\u9664\u975e\u5b9e\u73b0\u7684shell\u9501\u4e3a\u53ef\u5d4c\u5957\u7684\u9501</li> </ul> </li> </ol>"},{"location":"Middlewares/shell/#_18","title":"\u4f34\u751f\u5bf9\u8c61","text":"<p>letter shell 3.0.3\u7248\u672c\u5f15\u5165\u4e86\u4f34\u751f\u5bf9\u8c61\u7684\u6982\u5ff5\uff0c\u901a\u8fc7\u5b8f<code>SHELL_USING_COMPANION</code>\u5f00\u542f\u6216\u8005\u5173\u95ed\uff0c\u82e5\u4f7f\u7528\u4f34\u751f\u5bf9\u8c61\u7684\u529f\u80fd\uff0c\u9700\u8981\u540c\u65f6\u5c06shell_companion.c\u6587\u4ef6\u52a0\u5165\u5230\u5de5\u7a0b\u4e2d\uff0c\u4f34\u751f\u5bf9\u8c61\u53ef\u4ee5\u7528\u4e8e\u9700\u8981\u5c06\u67d0\u4e2a\u5bf9\u8c61\u540cshell\u5173\u8054\u7684\u573a\u666f\uff0c\u6bd4\u5982\u8bf4\uff0c\u901a\u8fc7\u5feb\u6377\u952e\u63a7\u5236shell\u7ec8\u7aef\u5bf9\u5e94\u7684\u65e5\u5fd7\u6253\u5370\u5bf9\u8c61</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528<code>shellCompanionAdd</code>\u5c06\u4f34\u751f\u5bf9\u8c61\u540cshell\u5bf9\u8c61\u8fdb\u884c\u5173\u8054\uff0c\u4e4b\u540e\uff0c\u53ef\u4ee5\u5728shell\u64cd\u4f5c\u4e2d\uff0c\u901a\u8fc7<code>shellCompanionGet</code>\u83b7\u53d6\u76f8\u5e94\u7684\u4f34\u751f\u5bf9\u8c61\uff0c\u4ee5\u8fbe\u5230\u5728\u4e0d\u540c\u7684shell\u4e2d\uff0c\u64cd\u4f5c\u4e0d\u540c\u5bf9\u8c61\u7684\u76ee\u7684</p>"},{"location":"Middlewares/shell/#_19","title":"\u5c3e\u884c\u6a21\u5f0f","text":"<p>letter shell 3.0.4\u7248\u672c\u65b0\u589e\u4e86\u5c3e\u884c\u6a21\u5f0f\uff0c\u9002\u7528\u4e8e\u9700\u8981\u5728shell\u6240\u4f7f\u7528\u7684\u4ea4\u4e92\u7ec8\u7aef\u540c\u65f6\u8f93\u5165\u5176\u4ed6\u4fe1\u606f(\u6bd4\u5982\u8bf4\u65e5\u5fd7)\u65f6\uff0c\u9632\u6b62\u5176\u4ed6\u4fe1\u606f\u7684\u8f93\u51fa\uff0c\u5bfc\u81f4shell\u4ea4\u4e92\u4f53\u9a8c\u6781\u5dee\u7684\u60c5\u51b5\uff0c\u4f7f\u7528\u65f6\uff0c\u4f7f\u80fd\u5b8f<code>SHELL_SUPPORT_END_LINE</code>\uff0c\u7136\u540e\u5bf9\u4e8e\u5176\u4ed6\u9700\u8981\u4f7f\u7528\u7ec8\u7aef\u8f93\u5165\u4fe1\u606f\u7684\u5730\u65b9\uff0c\u8c03\u7528<code>shellWriteEndLine</code>\u63a5\u53e3\u5c06\u4fe1\u606f\u8f93\u5165\uff0c\u6b64\u65f6\uff0c\u8c03\u7528<code>shellWriteEndLine</code>\u8fdb\u884c\u8f93\u5165\u7684\u5185\u5bb9\u5c06\u4f1a\u63d2\u5165\u5230\u547d\u4ee4\u884c\u4e0a\u65b9\uff0c\u7ec8\u7aef\u4f1a\u4e00\u76f4\u4fdd\u6301shell\u547d\u4ee4\u884c\u4f4d\u4e8e\u6700\u540e\u4e00\u884c</p> <p>\u4f7f\u7528letter shell\u5c3e\u884c\u6a21\u5f0f\u7ed3\u5408log\u65e5\u5fd7\u8f93\u51fa\u7684\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"Middlewares/shell/#_20","title":"\u5efa\u8bae\u7ec8\u7aef\u8f6f\u4ef6","text":"<ul> <li>\u5bf9\u4e8e\u57fa\u4e8e\u4e32\u53e3\u79fb\u690d\uff0cletter shell\u5efa\u8bae\u4f7f\u7528secureCRT\u8f6f\u4ef6\uff0cletter shell\u4e2d\u7684\u76f8\u5173\u6309\u952e\u6620\u5c04\u90fd\u662f\u6309\u7167secureCRT\u8fdb\u884c\u8bbe\u8ba1\u7684\uff0c\u4f7f\u7528\u5176\u4ed6\u4e32\u53e3\u8f6f\u4ef6\u65f6\uff0c\u53ef\u80fd\u9700\u8981\u4fee\u6539\u952e\u503c</li> </ul>"},{"location":"Middlewares/shell/#_21","title":"\u547d\u4ee4\u904d\u5386\u5de5\u5177","text":"<p>letter shell 3.x\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7528\u4e8e\u904d\u5386\u5de5\u7a0b\u4e2d\u547d\u4ee4\u5bfc\u51fa\u7684\u5de5\u5177\uff0c\u4f4d\u4e8etools/shellTools.py\uff0c\u9700\u8981python3\u73af\u5883\u8fd0\u884c\uff0c\u53ef\u4ee5\u5217\u51fa\u5de5\u7a0b\u4e2d\uff0c\u6240\u6709\u4f7f\u7528<code>SHELL_EXPORT_XXX</code>\u5bfc\u51fa\u7684\u547d\u4ee4\u540d\uff0c\u4ee5\u53ca\u4f4d\u7f6e\uff0c\u7ed3\u5408VS Code\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u8df3\u8f6c</p> <pre><code>python shellTools.py project\n</code></pre> <p>\u6ce8\u610f\uff1ashellTools\u4f1a\u904d\u5386\u6307\u5b9a\u76ee\u5f55\u4e2d\u6240\u6709\u6587\u4ef6\uff0c\u6240\u4ee5\u5f53\u5de5\u7a0b\u4e2d\u6587\u4ef6\u8f83\u591a\u65f6\uff0c\u901f\u5ea6\u4f1a\u6bd4\u8f83\u6162\uff0c\u5efa\u8bae\u53ea\u7528\u4e8e\u904d\u5386\u7528\u6237\u6a21\u5757\u7684\u76ee\u5f55</p>"},{"location":"Middlewares/shell/#x86-demo","title":"x86 demo","text":"<p>letter shell 3.x\u63d0\u4f9b\u4e86\u4e00\u4e2ax86\u7684demo\uff0c\u53ef\u4ee5\u76f4\u63a5\u7f16\u8bd1\u8fd0\u884c\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u4e00\u6761\u6309\u952e\u952e\u503c\u6d4b\u8bd5\u547d\u4ee4\uff0c\u53ef\u4ee5\u6d4b\u8bd5\u6309\u952e\u952e\u503c\uff0c\u7528\u4e8e\u5feb\u6377\u952e\u7684\u5b9a\u4e49\uff0c\u7f16\u8bd1\u8fd0\u884c\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>cd demo/x86-gcc/\ncmake .\nmake\n./LetterShell\n</code></pre>"},{"location":"zero_topic_core/obj_dict/obj_dict/","title":"obj_dict \u6a21\u5757\u8bf4\u660e","text":""},{"location":"zero_topic_core/obj_dict/obj_dict/#_1","title":"\u6982\u8ff0","text":"<ul> <li>\u5bf9\u8c61/\u4e8b\u4ef6\u5b57\u5178\uff1a\u4ee5 <code>key (uint16_t)</code> \u7edf\u4e00\u6807\u8bc6\uff0c\u4fdd\u5b58\u503c\u7f13\u51b2\u3001\u957f\u5ea6\u3001\u65f6\u95f4\u6233\u3001\u7248\u672c\u4e0e\u6807\u5fd7\u3002</li> <li>\u8bbe\u8ba1\u7528\u4e8e\u4e0e\u4e8b\u4ef6\u603b\u7ebf/Topic \u7d27\u8026\u5408\uff0c\u652f\u6301\u6309 KEY \u5feb\u901f\u8bfb\u5199\u4e0e\u65f6\u95f4\u6233\u8ffd\u8e2a\u3002</li> </ul>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_2","title":"\u6570\u636e\u6a21\u578b","text":"<pre><code>typedef uint16_t obj_dict_key_t; // \u4e0e vfb_event_t \u4e00\u81f4\n\ntypedef struct {\n    obj_dict_key_t key;\n    void*          value;\n    size_t         value_len;\n    uint64_t       timestamp_us;\n    atomic_uint_fast32_t version;  /* \u7248\u672c\u53f7\uff08C11\u539f\u5b50\u64cd\u4f5c\uff09 */\n    atomic_uint_fast32_t ref_count; /* \u5f15\u7528\u8ba1\u6570\uff08C11\u539f\u5b50\u64cd\u4f5c\uff0c\u7528\u4e8e\u751f\u547d\u5468\u671f\u7ba1\u7406\uff09 */\n    uint8_t        flags;\n} obj_dict_entry_t;\n</code></pre>"},{"location":"zero_topic_core/obj_dict/obj_dict/#api","title":"\u6838\u5fc3 API","text":"<pre><code>int obj_dict_init(obj_dict_t* dict, obj_dict_entry_t* entry_array, size_t max_keys);\nint obj_dict_init_with_mempool(obj_dict_t* dict, obj_dict_entry_t* entry_array, size_t max_keys,\n                                size_t mempool_block_size, size_t mempool_block_count);\nint obj_dict_set(obj_dict_t* dict, obj_dict_key_t key, const void* data, size_t len, uint8_t flags);\nssize_t obj_dict_get(obj_dict_t* dict, obj_dict_key_t key, void* out, size_t out_cap,\n                     uint64_t* ts_us, uint32_t* version, uint8_t* flags);\nint obj_dict_iterate(obj_dict_t* dict, int next_from); // -1 \u5f00\u59cb\n\n/* \u5f15\u7528\u8ba1\u6570\u7ba1\u7406\uff08\u751f\u547d\u5468\u671f\u4fdd\u62a4\uff09 */\nint obj_dict_retain(obj_dict_t* dict, obj_dict_key_t key);  // \u589e\u52a0\u5f15\u7528\u8ba1\u6570\nint obj_dict_release(obj_dict_t* dict, obj_dict_key_t key);  // \u51cf\u5c11\u5f15\u7528\u8ba1\u6570\nint32_t obj_dict_get_ref_count(obj_dict_t* dict, obj_dict_key_t key);  // \u83b7\u53d6\u5f15\u7528\u8ba1\u6570\uff08\u8c03\u8bd5\u7528\uff09\n\n/* \u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b\u4e0e\u6e05\u7406 */\nint obj_dict_cleanup_unused(obj_dict_t* dict, uint64_t timeout_us);  // \u6e05\u7406\u672a\u4f7f\u7528\u7684\u6570\u636e\nint obj_dict_get_all_ref_counts(obj_dict_t* dict, int32_t* ref_counts, size_t max_count);  // \u83b7\u53d6\u6240\u6709\u5f15\u7528\u8ba1\u6570\u7edf\u8ba1\n</code></pre>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_3","title":"\u4f7f\u7528\u793a\u4f8b","text":""},{"location":"zero_topic_core/obj_dict/obj_dict/#_4","title":"\u57fa\u7840\u4f7f\u7528\uff08\u7cfb\u7edf\u5806\u5206\u914d\uff09","text":"<pre><code>#define MAX_KEYS 128\nstatic obj_dict_entry_t g_entries[MAX_KEYS];\nstatic obj_dict_t g_dict;\n\nobj_dict_init(&amp;g_dict, g_entries, MAX_KEYS);\nconst char msg[] = \"hello\";\nobj_dict_set(&amp;g_dict, 1, msg, sizeof(msg), 0);\nchar buf[16]; uint64_t ts; uint32_t ver; uint8_t fl;\nssize_t n = obj_dict_get(&amp;g_dict, 1, buf, sizeof(buf), &amp;ts, &amp;ver, &amp;fl);\n</code></pre>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_5","title":"\u4f7f\u7528\u5185\u5b58\u6c60\u4f18\u5316\uff08\u51cf\u5c11\u52a8\u6001\u5206\u914d\uff09","text":"<pre><code>#define MAX_KEYS 128\nstatic obj_dict_entry_t g_entries[MAX_KEYS];\nstatic obj_dict_t g_dict;\n\n// \u4f7f\u7528\u5185\u5b58\u6c60\uff1a\u5757\u5927\u5c0f256\u5b57\u8282\uff0c32\u4e2a\u5757\nobj_dict_init_with_mempool(&amp;g_dict, g_entries, MAX_KEYS, 256, 32);\nconst char msg[] = \"hello\";\nobj_dict_set(&amp;g_dict, 1, msg, sizeof(msg), 0);  // \u4f18\u5148\u4ece\u5185\u5b58\u6c60\u5206\u914d\n</code></pre>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_6","title":"\u7248\u672c\u53f7\u7684\u4f5c\u7528","text":"<p>\u7248\u672c\u53f7\uff08version\uff09\u662f\u4e00\u4e2a\u5355\u8c03\u9012\u589e\u7684\u539f\u5b50\u8ba1\u6570\u5668\uff0c\u6bcf\u6b21\u5199\u5165\u6570\u636e\u65f6\u81ea\u52a8\u52a01\u3002\u5b83\u7684\u4e3b\u8981\u7528\u9014\u5305\u62ec\uff1a</p>"},{"location":"zero_topic_core/obj_dict/obj_dict/#1","title":"1. \u68c0\u6d4b\u6570\u636e\u66f4\u65b0","text":"<p>\u591a\u7ebf\u7a0b/\u591a\u4efb\u52a1\u573a\u666f\u4e0b\uff0c\u7528\u7248\u672c\u53f7\u5224\u65ad\u6570\u636e\u662f\u5426\u88ab\u66f4\u65b0\uff1a <pre><code>uint32_t last_version = 0;\nwhile (running) {\n    uint32_t current_version;\n    obj_dict_get(&amp;dict, KEY_SENSOR_DATA, &amp;data, sizeof(data), NULL, &amp;current_version, NULL);\n\n    if (current_version != last_version) {\n        // \u6570\u636e\u5df2\u66f4\u65b0\uff0c\u5904\u7406\u65b0\u6570\u636e\n        process_data(&amp;data);\n        last_version = current_version;\n    } else {\n        // \u6570\u636e\u672a\u53d8\u5316\uff0c\u53ef\u8df3\u8fc7\u5904\u7406\n    }\n}\n</code></pre></p>"},{"location":"zero_topic_core/obj_dict/obj_dict/#2-optimistic-locking","title":"2. \u5b9e\u73b0\u4e50\u89c2\u9501\uff08Optimistic Locking\uff09","text":"<p>CAS \u7c7b\u5e76\u53d1\u63a7\u5236\uff1a <pre><code>uint32_t expected_version = 10;\nobj_dict_get(&amp;dict, KEY_CONFIG, &amp;config, sizeof(config), NULL, &amp;expected_version, NULL);\n\n// \u5728\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u6570\u636e...\nconfig.value += 1;\n\n// \u68c0\u67e5\u7248\u672c\u662f\u5426\u53d8\u5316\uff0c\u907f\u514d\u8986\u76d6\nuint32_t current_version;\nobj_dict_get(&amp;dict, KEY_CONFIG, &amp;check_data, sizeof(check_data), NULL, &amp;current_version, NULL);\nif (current_version == expected_version) {\n    obj_dict_set(&amp;dict, KEY_CONFIG, &amp;config, sizeof(config), 0);  // \u5b89\u5168\u5199\u5165\n} else {\n    // \u7248\u672c\u5df2\u88ab\u5176\u4ed6\u7ebf\u7a0b\u4fee\u6539\uff0c\u9700\u8981\u91cd\u65b0\u8bfb\u53d6\n}\n</code></pre></p>"},{"location":"zero_topic_core/obj_dict/obj_dict/#3","title":"3. \u72b6\u6001\u53d8\u5316\u8ffd\u8e2a","text":"<p>\u76d1\u63a7\u6307\u5b9a\u6570\u636e\u7684\u53d8\u5316\u9891\u7387\uff1a <pre><code>uint32_t old_version = 0;\nwhile (monitoring) {\n    uint32_t new_version;\n    obj_dict_get(&amp;dict, KEY_STATUS, &amp;status, sizeof(status), NULL, &amp;new_version, NULL);\n\n    if (new_version &gt; old_version) {\n        uint32_t change_count = new_version - old_version;\n        printf(\"\u72b6\u6001\u53d8\u5316\u4e86 %u \u6b21\\n\", change_count);\n        old_version = new_version;\n    }\n}\n</code></pre></p>"},{"location":"zero_topic_core/obj_dict/obj_dict/#4-last-value-cacheros2","title":"4. \u5b9e\u73b0 Last-Value Cache\uff08ROS2\u6982\u5ff5\uff09","text":"<p>\u4f5c\u4e3a ROS Topic \u7684\u6700\u65b0\u503c\u7f13\u5b58\uff1a <pre><code>// Publisher\u4fa7\uff1a\u6bcf\u53d1\u5e03\u4e00\u6b21topic\uff0c\u66f4\u65b0dict\nvoid on_topic_update(const ros_msg_t* msg) {\n    obj_dict_set(&amp;dict, KEY_MOTOR_SPEED, &amp;msg-&gt;speed, sizeof(msg-&gt;speed), 0);\n}\n\n// Subscriber\u4fa7\uff1a\u68c0\u67e5\u662f\u5426\u662f\u65b0\u6570\u636e\nvoid check_topic_update(void) {\n    static uint32_t last_version = 0;\n    uint32_t current_version;\n    float speed;\n\n    obj_dict_get(&amp;dict, KEY_MOTOR_SPEED, &amp;speed, sizeof(speed), NULL, &amp;current_version, NULL);\n\n    if (current_version &gt; last_version) {\n        on_new_motor_speed(speed);\n        last_version = current_version;\n    }\n}\n</code></pre></p>"},{"location":"zero_topic_core/obj_dict/obj_dict/#5","title":"5. \u8c03\u8bd5\u548c\u8bca\u65ad","text":"<p>\u5feb\u901f\u5b9a\u4f4d\u5f02\u5e38\u66f4\u65b0\uff1a <pre><code>uint32_t previous_version = 0;\nwhile (true) {\n    uint32_t current_version;\n    obj_dict_get(&amp;dict, KEY_TEMP, &amp;temp, sizeof(temp), NULL, &amp;current_version, NULL);\n\n    if (current_version - previous_version &gt; 1) {\n        // \u68c0\u6d4b\u5230\u7248\u672c\u8df3\u8dc3\uff0c\u53ef\u80fd\u6709\u591a\u7ebf\u7a0b\u7ade\u4e89\u6216\u6570\u636e\u4e22\u5931\n        os_printf(\"[WARN] \u7248\u672c\u8df3\u8dc3: %u -&gt; %u\\n\", previous_version, current_version);\n    }\n    previous_version = current_version;\n}\n</code></pre></p>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_7","title":"\u6027\u80fd\u7279\u70b9","text":"<ul> <li>\u539f\u5b50\u64cd\u4f5c\uff1a\u4f7f\u7528C11 <code>atomic_uint_fast32_t</code>\uff0c\u65e0\u9501\u8bfb\u5199</li> <li>\u4f4e\u5f00\u9500\uff1a\u539f\u5b50\u81ea\u589e\u7ea6 1-2 CPU \u5468\u671f</li> <li>\u5185\u5b58\u5e8f\uff1a<code>memory_order_release/acquire</code> \u4fdd\u8bc1\u8de8\u7ebf\u7a0b\u4e00\u81f4\u6027</li> <li>\u6c38\u4e0d\u6ea2\u51fa\uff1a32\u4f4d\u6700\u5927\u7ea6 42 \u4ebf\u6b21\uff0c\u6ee1\u8db3\u957f\u671f\u8fd0\u884c</li> </ul>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_8","title":"\u5f15\u7528\u8ba1\u6570\u7684\u4f5c\u7528\uff08\u751f\u547d\u5468\u671f\u7ba1\u7406\uff09","text":"<p>\u5f15\u7528\u8ba1\u6570\uff08ref_count\uff09\u662f\u4e00\u4e2a\u539f\u5b50\u8ba1\u6570\u5668\uff0c\u7528\u4e8e\u4fdd\u62a4\u6570\u636e\u5728\u56de\u8c03\u671f\u95f4\u7684\u6709\u6548\u6027\u3002\u4e3b\u8981\u7528\u9014\u5305\u62ec\uff1a</p>"},{"location":"zero_topic_core/obj_dict/obj_dict/#1_1","title":"1. \u4fdd\u62a4\u56de\u8c03\u671f\u95f4\u7684\u6570\u636e\u6709\u6548\u6027","text":"<p>\u5728 Topic Bus \u56de\u8c03\u4e2d\uff0c\u8ba2\u9605\u8005\u901a\u8fc7\u6307\u9488\u8bbf\u95ee obj_dict \u4e2d\u7684\u6570\u636e\u3002\u5982\u679c\u6570\u636e\u5728\u56de\u8c03\u671f\u95f4\u88ab\u5220\u9664\u6216\u66f4\u65b0\uff0c\u53ef\u80fd\u5bfc\u81f4\u60ac\u7a7a\u6307\u9488\u3002\u5f15\u7528\u8ba1\u6570\u673a\u5236\u786e\u4fdd\uff1a</p> <pre><code>// Topic Bus \u5185\u90e8\u81ea\u52a8\u7ba1\u7406\uff08\u7528\u6237\u65e0\u9700\u624b\u52a8\u8c03\u7528\uff09\nvoid callback(uint16_t topic_id, const void* data, size_t len, void* user) {\n    // \u6b64\u65f6 data \u6307\u9488\u6709\u6548\uff0c\u56e0\u4e3a obj_dict_retain \u5df2\u589e\u52a0\u5f15\u7528\u8ba1\u6570\n    process_data(data, len);\n    // \u56de\u8c03\u8fd4\u56de\u540e\uff0cobj_dict_release \u81ea\u52a8\u51cf\u5c11\u5f15\u7528\u8ba1\u6570\n}\n</code></pre>"},{"location":"zero_topic_core/obj_dict/obj_dict/#2","title":"2. \u624b\u52a8\u7ba1\u7406\u751f\u547d\u5468\u671f\uff08\u9ad8\u7ea7\u7528\u6cd5\uff09","text":"<p>\u5982\u679c\u9700\u8981\u624b\u52a8\u7ba1\u7406\u6570\u636e\u751f\u547d\u5468\u671f\uff1a</p> <pre><code>// \u83b7\u53d6\u6570\u636e\u524d\u589e\u52a0\u5f15\u7528\u8ba1\u6570\nobj_dict_retain(&amp;dict, KEY_SENSOR_DATA);\n\n// \u4f7f\u7528\u6570\u636e\uff08\u53ef\u80fd\u5728\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u51fd\u6570\u4e2d\uff09\nvoid* data = get_data_pointer(&amp;dict, KEY_SENSOR_DATA);\nprocess_long_running_task(data);\n\n// \u4f7f\u7528\u5b8c\u6210\u540e\u91ca\u653e\u5f15\u7528\nobj_dict_release(&amp;dict, KEY_SENSOR_DATA);\n</code></pre>"},{"location":"zero_topic_core/obj_dict/obj_dict/#3_1","title":"3. \u8c03\u8bd5\u548c\u76d1\u63a7","text":"<p>\u68c0\u67e5\u6570\u636e\u662f\u5426\u88ab\u5f15\u7528\uff1a</p> <pre><code>int32_t ref_count = obj_dict_get_ref_count(&amp;dict, KEY_SENSOR_DATA);\nif (ref_count &gt; 0) {\n    printf(\"\u6570\u636e\u6b63\u5728\u88ab %d \u4e2a\u5f15\u7528\u4f7f\u7528\\n\", ref_count);\n}\n</code></pre>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_9","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u81ea\u52a8\u7ba1\u7406\uff1aTopic Bus \u4f1a\u81ea\u52a8\u5728\u56de\u8c03\u524d\u540e\u8c03\u7528 retain/release\uff0c\u7528\u6237\u65e0\u9700\u624b\u52a8\u7ba1\u7406</li> <li>\u4e0d\u81ea\u52a8\u6e05\u7406\uff1a\u5f15\u7528\u8ba1\u6570\u4e3a 0 \u65f6\u4e0d\u4f1a\u81ea\u52a8\u5220\u9664\u6570\u636e\uff0c\u907f\u514d\u5728\u56de\u8c03\u671f\u95f4\u6570\u636e\u88ab\u610f\u5916\u5220\u9664</li> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a\u5f15\u7528\u8ba1\u6570\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\uff0c\u652f\u6301\u591a\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95ee</li> </ol>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_10","title":"\u5185\u5b58\u6c60\u4f18\u5316\uff08\u53ef\u9009\uff09","text":"<p>\u5185\u5b58\u6c60\uff08Memory Pool\uff09\u7528\u4e8e\u9884\u5206\u914d\u6570\u636e\u7f13\u51b2\u533a\uff0c\u51cf\u5c11\u52a8\u6001\u5185\u5b58\u5206\u914d\u7684\u5f00\u9500\uff0c\u63d0\u9ad8\u5b9e\u65f6\u6027\u80fd\u3002</p>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_11","title":"\u7279\u6027","text":"<ol> <li>\u9884\u5206\u914d\u5185\u5b58\uff1a\u521d\u59cb\u5316\u65f6\u9884\u5206\u914d\u56fa\u5b9a\u5927\u5c0f\u7684\u5185\u5b58\u5757\uff0c\u907f\u514d\u8fd0\u884c\u65f6\u5206\u914d</li> <li>\u5feb\u901f\u5206\u914d\uff1aO(1) \u65f6\u95f4\u590d\u6742\u5ea6\u7684\u5185\u5b58\u5206\u914d\u548c\u91ca\u653e</li> <li>\u81ea\u52a8\u56de\u9000\uff1a\u5982\u679c\u5185\u5b58\u6c60\u5df2\u6ee1\u6216\u6570\u636e\u5927\u5c0f\u8d85\u8fc7\u5757\u5927\u5c0f\uff0c\u81ea\u52a8\u56de\u9000\u5230\u7cfb\u7edf\u5806</li> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a\u4f7f\u7528\u4fe1\u53f7\u91cf\u4fdd\u62a4\uff0c\u652f\u6301\u591a\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95ee</li> </ol>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_12","title":"\u4f7f\u7528\u793a\u4f8b","text":"<pre><code>// \u521d\u59cb\u5316\u65f6\u542f\u7528\u5185\u5b58\u6c60\nobj_dict_init_with_mempool(&amp;dict, entries, MAX_KEYS, \n                           256,   // \u6bcf\u4e2a\u5757256\u5b57\u8282\n                           32);   // 32\u4e2a\u5757\n\n// \u540e\u7eed\u4f7f\u7528\u4e0e\u666e\u901a\u6a21\u5f0f\u76f8\u540c\nobj_dict_set(&amp;dict, KEY_DATA, data, sizeof(data), 0);\n</code></pre>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_13","title":"\u914d\u7f6e\u9009\u9879","text":"<p>\u5728 <code>obj_dict_config.h</code> \u4e2d\u53ef\u914d\u7f6e\uff1a</p> <ul> <li><code>OBJ_DICT_MEMPOOL_ENABLE</code>\uff1a\u662f\u5426\u542f\u7528\u5185\u5b58\u6c60\uff08\u9ed8\u8ba4\u542f\u7528\uff09</li> <li><code>OBJ_DICT_MEMPOOL_BLOCK_SIZE</code>\uff1a\u9ed8\u8ba4\u5757\u5927\u5c0f\uff08\u9ed8\u8ba4256\u5b57\u8282\uff09</li> <li><code>OBJ_DICT_MEMPOOL_BLOCK_COUNT</code>\uff1a\u9ed8\u8ba4\u5757\u6570\u91cf\uff08\u9ed8\u8ba432\u4e2a\uff09</li> </ul>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_14","title":"\u6027\u80fd\u4f18\u52bf","text":"<ul> <li>\u51cf\u5c11\u788e\u7247\uff1a\u9884\u5206\u914d\u8fde\u7eed\u5185\u5b58\uff0c\u51cf\u5c11\u5185\u5b58\u788e\u7247</li> <li>\u786e\u5b9a\u6027\u5ef6\u8fdf\uff1a\u5206\u914d\u65f6\u95f4\u53ef\u9884\u6d4b\uff0c\u9002\u5408\u5b9e\u65f6\u7cfb\u7edf</li> <li>\u964d\u4f4e\u5f00\u9500\uff1a\u907f\u514d\u9891\u7e41\u7684\u7cfb\u7edf\u5806\u5206\u914d/\u91ca\u653e</li> </ul>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_15","title":"\u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b\u4e0e\u6e05\u7406","text":"<p>\u5bf9\u8c61\u5b57\u5178\u63d0\u4f9b\u81ea\u52a8\u6e05\u7406\u673a\u5236\uff0c\u7528\u4e8e\u6e05\u7406\u957f\u65f6\u95f4\u672a\u4f7f\u7528\u4e14\u672a\u88ab\u5f15\u7528\u7684\u6570\u636e\u3002</p>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_16","title":"\u6e05\u7406\u673a\u5236","text":"<p><code>obj_dict_cleanup_unused()</code> \u51fd\u6570\u4f1a\u6e05\u7406\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u7684\u6570\u636e\uff1a</p> <ol> <li>\u5f15\u7528\u8ba1\u6570\u4e3a 0\uff1a\u6570\u636e\u672a\u88ab\u4efb\u4f55\u56de\u8c03\u6216\u624b\u52a8\u5f15\u7528\u6301\u6709</li> <li>\u8d85\u8fc7\u8d85\u65f6\u65f6\u95f4\uff1a\u6570\u636e\u8d85\u8fc7\u6307\u5b9a\u65f6\u95f4\uff08\u5fae\u79d2\uff09\u672a\u66f4\u65b0</li> </ol>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_17","title":"\u4f7f\u7528\u793a\u4f8b","text":"<pre><code>// \u5b9a\u671f\u6e05\u7406\uff1a\u6e05\u7406\u8d85\u8fc760\u79d2\u672a\u66f4\u65b0\u4e14\u672a\u88ab\u5f15\u7528\u7684\u6570\u636e\nint cleaned = obj_dict_cleanup_unused(&amp;dict, 60 * 1000 * 1000);  // 60\u79d2\nif (cleaned &gt; 0) {\n    printf(\"\u6e05\u7406\u4e86 %d \u4e2a\u672a\u4f7f\u7528\u7684\u6761\u76ee\\n\", cleaned);\n}\n</code></pre>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_18","title":"\u8c03\u8bd5\u4e0e\u76d1\u63a7","text":"<p>\u83b7\u53d6\u6240\u6709\u6761\u76ee\u7684\u5f15\u7528\u8ba1\u6570\u7edf\u8ba1\uff1a</p> <pre><code>int32_t ref_counts[MAX_KEYS];\nint count = obj_dict_get_all_ref_counts(&amp;dict, ref_counts, MAX_KEYS);\n\nfor (int i = 0; i &lt; count; ++i) {\n    if (ref_counts[i] &gt;= 0) {\n        printf(\"\u6761\u76ee %d: \u5f15\u7528\u8ba1\u6570 = %d\\n\", i, ref_counts[i]);\n    }\n}\n</code></pre>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_19","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u624b\u52a8\u8c03\u7528\uff1a\u6e05\u7406\u51fd\u6570\u4e0d\u4f1a\u81ea\u52a8\u6267\u884c\uff0c\u9700\u8981\u5b9a\u671f\u624b\u52a8\u8c03\u7528</li> <li>\u65f6\u95f4\u6233\u68c0\u67e5\uff1a\u57fa\u4e8e\u6570\u636e\u7684\u65f6\u95f4\u6233\u5224\u65ad\u662f\u5426\u8d85\u65f6\uff0c\u786e\u4fdd\u65f6\u95f4\u6233\u6b63\u786e\u66f4\u65b0</li> <li>\u5f15\u7528\u8ba1\u6570\u68c0\u67e5\uff1a\u53ea\u6e05\u7406\u5f15\u7528\u8ba1\u6570\u4e3a 0 \u7684\u6570\u636e\uff0c\u907f\u514d\u5220\u9664\u6b63\u5728\u4f7f\u7528\u7684\u6570\u636e</li> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a\u6e05\u7406\u8fc7\u7a0b\u4e2d\u6301\u6709\u5b57\u5178\u9501\uff0c\u786e\u4fdd\u7ebf\u7a0b\u5b89\u5168</li> </ol>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_20","title":"\u6301\u4e45\u5316\u4e0e\u591a\u5185\u5b58\u5757\uff08\u9884\u7559\uff09","text":"<ul> <li><code>obj_dict_storage_ops_t</code> \u4f5c\u4e3a\u540e\u7aef\u62bd\u8c61\uff08RAM/Flash/\u591a\u5757\uff09\uff0c\u540e\u7eed\u6587\u4ef6 <code>obj_dict_storage.*</code> \u5bf9\u63a5\u3002</li> </ul>"},{"location":"zero_topic_core/obj_dict/obj_dict/#microros","title":"\u4e0e microROS \u7684\u5173\u7cfb","text":"<ul> <li>\u53ef\u4f5c\u4e3a ROS2 Topic \u672c\u5730\"\u6700\u540e\u503c\u7f13\u5b58\"(last-value cache)\uff0c\u5e76\u7528\u4e8e\u6865\u63a5\u6d88\u606f/\u4e8b\u4ef6\u952e\u503c\u5316\u8bbf\u95ee\u3002</li> </ul>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_21","title":"\u6027\u80fd\u4e0e\u5e76\u53d1\u6d4b\u8bd5","text":""},{"location":"zero_topic_core/obj_dict/obj_dict/#_22","title":"\u6d4b\u8bd5\u529f\u80fd","text":"<p>\u8be6\u7ec6\u6d4b\u8bd5\u5b9e\u73b0\u4f4d\u4e8e <code>perf_test_obj_dict.c</code>\uff0c\u5305\u62ec\uff1a</p> <ol> <li>\u57fa\u7840\u529f\u80fd\u6d4b\u8bd5</li> <li>set/get \u6570\u636e\u5b8c\u6574\u6027\u6821\u9a8c</li> <li>\u7248\u672c\u53f7\u9012\u589e\u68c0\u67e5</li> <li> <p>\u904d\u5386\u529f\u80fd\u9a8c\u8bc1</p> </li> <li> <p>\u6027\u80fd\u6d4b\u8bd5</p> </li> <li>\u541e\u5410\u91cf\u6d4b\u8bd5\uff1a\u5355\u7ebf\u7a0b\u5199\u5165/\u8bfb\u53d6/\u6df7\u5408\u64cd\u4f5c</li> <li>\u6570\u636e\u5927\u5c0f\u6d4b\u8bd5\uff1a4B~256B\u4e0d\u540c\u5927\u5c0f\u7684\u6027\u80fd\u5bf9\u6bd4</li> <li> <p>\u5e73\u5747\u5ef6\u8fdf\uff1a\u6bcf\u4e2a\u64cd\u4f5c\u7684\u7eb3\u79d2\u7ea7\u5ef6\u8fdf</p> </li> <li> <p>\u5e76\u53d1\u6d4b\u8bd5</p> </li> <li>\u591a\u7ebf\u7a0b\u7eaf\u5199\u5165\u6d4b\u8bd5\uff1a4\u7ebf\u7a0b\u5e76\u53d1\u5199\u5165</li> <li>\u591a\u7ebf\u7a0b\u8bfb\u5199\u6df7\u5408\u6d4b\u8bd5\uff1a4\u7ebf\u7a0b\u5e76\u53d1\u8bfb\u5199</li> <li> <p>\u7ebf\u7a0b\u5b89\u5168\u6027\u9a8c\u8bc1\uff1a\u65e0\u6570\u636e\u7ade\u4e89</p> </li> <li> <p>\u7248\u672c\u4e00\u81f4\u6027\u6d4b\u8bd5</p> </li> <li>\u539f\u5b50\u7248\u672c\u53f7\u9012\u589e\u9a8c\u8bc1</li> <li>\u8fde\u7eed\u5199\u5165\u7248\u672c\u53f7\u68c0\u67e5</li> </ol>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_23","title":"\u6d4b\u8bd5\u8fd0\u884c","text":"<pre><code>cd OpenIBBOs/apps/linux_demo/build\nmake\n./bin/OpenIBBOs_Linux_Demo\n</code></pre>"},{"location":"zero_topic_core/obj_dict/obj_dict/#_24","title":"\u6027\u80fd\u6570\u636e\u793a\u4f8b","text":"<p>\u6d4b\u8bd5\u73af\u5883\uff1aLinux x86_64, GCC\u4f18\u5316</p> <ul> <li>\u5355\u7ebf\u7a0b\u541e\u5410\uff1a150-160 ns/op</li> <li>\u591a\u7ebf\u7a0b\u5e76\u53d1\uff1a480-560 ns/op (4\u7ebf\u7a0b)</li> <li>\u7248\u672c\u53f7\u7ba1\u7406\uff1a\u57fa\u4e8eC11\u539f\u5b50\u64cd\u4f5c\uff0c\u4e25\u683c\u9012\u589e</li> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a\u4f7f\u7528\u4fe1\u53f7\u91cf\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027</li> </ul>"},{"location":"zero_topic_core/ring_buffer/ring_buffer/","title":"ring_buffer \u6a21\u5757\u8bf4\u660e","text":""},{"location":"zero_topic_core/ring_buffer/ring_buffer/#_1","title":"\u6982\u8ff0","text":"<ul> <li>MCU \u53cb\u597d\u7684\u9ad8\u6548\u73af\u5f62\u961f\u5217\uff0c\u652f\u6301\u975e\u963b\u585e/\u963b\u585e/ISR \u5199\u8def\u5f84\uff1b\u53ef\u4f5c\u4e3a Topic/\u5bf9\u8c61\u5b57\u5178\u7f13\u51b2\u7684\u57fa\u7840\u8bbe\u65bd\u3002</li> <li>\u91c7\u7528\u56fa\u5b9a\u5143\u7d20\u5927\u5c0f\uff08\u521b\u5efa\u65f6\u6307\u5b9a\uff09\uff0c\u652f\u6301 2 \u7684\u5e42\u5bb9\u91cf\u4f18\u5316\uff08\u53ef\u914d\u7f6e\uff09\u3002</li> </ul>"},{"location":"zero_topic_core/ring_buffer/ring_buffer/#_2","title":"\u76ee\u5f55\u7ed3\u6784","text":"<ul> <li><code>ring_buffer.h/.c</code>\uff1a\u6838\u5fc3\u5b9e\u73b0</li> <li><code>ring_buffer_config.h</code>\uff1a\u7f16\u8bd1\u671f\u914d\u7f6e</li> <li><code>perf_test_ring_buffer.c</code>\uff1a\u529f\u80fd\u4e0e\u6027\u80fd\u6d4b\u8bd5</li> </ul>"},{"location":"zero_topic_core/ring_buffer/ring_buffer/#_3","title":"\u914d\u7f6e","text":"<ul> <li><code>RING_BUFFER_ENABLE_BLOCKING</code>\uff1a1 \u542f\u7528\u963b\u585e API</li> <li><code>RING_BUFFER_ENABLE_ISR</code>\uff1a1 \u542f\u7528 <code>ring_buffer_write_isr</code></li> <li><code>RING_BUFFER_REQUIRE_POWER_OF_TWO</code>\uff1a1 \u8981\u6c42\u5bb9\u91cf\u4e3a 2 \u7684\u5e42</li> <li><code>RING_BUFFER_ENABLE_ZEROCOPY</code>\uff1a\u9884\u7559\u96f6\u62f7\u8d1d\u80fd\u529b\u5f00\u5173</li> </ul>"},{"location":"zero_topic_core/ring_buffer/ring_buffer/#api","title":"\u6838\u5fc3 API","text":"<pre><code>ring_buffer_t* ring_buffer_create(size_t capacity, size_t item_size);\nvoid ring_buffer_destroy(ring_buffer_t* rb);\nssize_t ring_buffer_write(ring_buffer_t* rb, const void* item);\nssize_t ring_buffer_read(ring_buffer_t* rb, void* item_out);\nssize_t ring_buffer_write_blocking(ring_buffer_t* rb,const void* item,uint32_t timeout_ms);\nssize_t ring_buffer_read_blocking(ring_buffer_t* rb,void* item_out,uint32_t timeout_ms);\nssize_t ring_buffer_write_isr(ring_buffer_t* rb, const void* item);\nsize_t  ring_buffer_get_count(const ring_buffer_t* rb);\nsize_t  ring_buffer_get_space(const ring_buffer_t* rb);\nvoid    ring_buffer_reset(ring_buffer_t* rb);\n</code></pre>"},{"location":"zero_topic_core/ring_buffer/ring_buffer/#_4","title":"\u4f7f\u7528\u793a\u4f8b","text":"<pre><code>ring_buffer_t* rb = ring_buffer_create(1024, sizeof(uint32_t));\nuint32_t v = 123;\nring_buffer_write(rb, &amp;v);\nring_buffer_read(rb, &amp;v);\nring_buffer_destroy(rb);\n</code></pre>"},{"location":"zero_topic_core/ring_buffer/ring_buffer/#_5","title":"\u6d4b\u8bd5","text":"<ul> <li>\u5728 <code>apps/linux_demo/config.h</code> \u8bbe\u7f6e <code>#define ENABLE_RING_BUFFER_TEST 1</code></li> <li>\u8fd0\u884c linux_demo\uff0c\u8f93\u51fa\u5305\u542b\uff1a</li> <li>\u57fa\u7840\u529f\u80fd\u6d4b\u8bd5\uff08\u6ee1/\u7a7a\u3001\u987a\u5e8f\u3001\u963b\u585e\u8d85\u65f6\uff09</li> <li>\u6027\u80fd\u6d4b\u8bd5\uff08\u591a item \u5927\u5c0f\u4e0e\u53d8\u957f\u5934\u573a\u666f\uff09</li> </ul>"},{"location":"zero_topic_core/ring_buffer/ring_buffer/#microros","title":"\u4e0e microROS \u7684\u5173\u7cfb","text":"<ul> <li>\u53ef\u4f5c\u4e3a microROS \u4f20\u8f93\u9002\u914d\u6216\u8282\u70b9\u5185\u90e8\u7f13\u51b2\u961f\u5217\u7684\u5b9e\u73b0\u57fa\u7840\u3002</li> </ul>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/","title":"OpenIBBOs \u786c\u4ef6\u4f7f\u7528\u65b9\u5f0f\u5bf9\u6bd4\u5206\u6790","text":""},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_1","title":"\u6982\u8ff0","text":"<p>\u5728OpenIBBOs\u9879\u76ee\u4e2d\uff0c\u786c\u4ef6\u64cd\u4f5c\u6709\u4e24\u79cd\u4e3b\u8981\u65b9\u5f0f\uff1a 1. \u72ec\u7acb\u7ebf\u7a0b\u65b9\u5f0f\uff1a\u901a\u8fc7VFB\uff08Virtual Function Bus\uff09\u6d88\u606f\u603b\u7ebf\uff0c\u5728\u72ec\u7acb\u7684\u4efb\u52a1\u7ebf\u7a0b\u4e2d\u5904\u7406\u786c\u4ef6\u64cd\u4f5c 2. \u76f4\u63a5API\u8c03\u7528\u65b9\u5f0f\uff1a\u76f4\u63a5\u8c03\u7528\u786c\u4ef6\u9a71\u52a8API\u51fd\u6570\uff0c\u5728\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7acb\u5373\u6267\u884c\u786c\u4ef6\u64cd\u4f5c</p> <p>\u672c\u6587\u6863\u8be6\u7ec6\u5bf9\u6bd4\u5206\u6790\u8fd9\u4e24\u79cd\u65b9\u5f0f\u7684\u4f18\u7f3a\u70b9\u3001\u9002\u7528\u573a\u666f\u548c\u5b9e\u73b0\u7ec6\u8282\u3002</p>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#vfb","title":"\u65b9\u5f0f\u4e00\uff1a\u72ec\u7acb\u7ebf\u7a0b\u65b9\u5f0f\uff08\u901a\u8fc7VFB\uff09","text":""},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_2","title":"\u5de5\u4f5c\u539f\u7406","text":"<p>\u786c\u4ef6\u64cd\u4f5c\u901a\u8fc7VFB\u6d88\u606f\u603b\u7ebf\u8fdb\u884c\uff0c\u786c\u4ef6\u9a71\u52a8\u8fd0\u884c\u5728\u72ec\u7acb\u7684\u4efb\u52a1\u7ebf\u7a0b\u4e2d\uff0c\u901a\u8fc7\u8ba2\u9605VFB\u4e8b\u4ef6\u6765\u54cd\u5e94\u786c\u4ef6\u64cd\u4f5c\u8bf7\u6c42\u3002</p>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_3","title":"\u5178\u578b\u5b9e\u73b0\u793a\u4f8b","text":""},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#1","title":"1. \u53d1\u9001\u786c\u4ef6\u64cd\u4f5c\u8bf7\u6c42","text":"<p>```233:282:OpenIBBOs/Middlewares/device/Uart/Uart.c // \u63a5\u6536\u6d88\u606f\u7684\u56de\u8c03\u51fd\u6570 static void UartRcvHandle(void msg) {     TaskHandle_t curTaskHandle    = xTaskGetCurrentTaskHandle();     TypdefUartStatus uart_handle = &amp;UartStatus[0];     char *taskName                = pcTaskGetName(curTaskHandle);     vfb_message_t tmp_msg         = (vfb_message_t)msg;     switch (tmp_msg-&gt;frame-&gt;head.event) {         case UartStart: {             elog_i(TAG, \"UartStart %d\", tmp_msg-&gt;frame-&gt;head.data);             DevUartDMARecive(&amp;(UartBspCfg[0].uart_cfg), uart_handle-&gt;rx_buffer,                              UartBspCfg[0].buffer_size);             elog_i(TAG, \"Uart Rcv Init Done\");             DevUartStart(&amp;(UartBspCfg[0].uart_cfg));             // printf(\"Uart Rcv Init Done\\r\\n\");             elog_i(TAG, \"Uart DevUartStart Init Done\");</p> <pre><code>    } break;\n    case UartStop: {\n    } break;\n    case UartSet: {\n    } break;\n    case UartGet: {\n    } break;\n    case UartSend: {\n        if (tmp_msg-&gt;frame-&gt;head.length == 0 || tmp_msg-&gt;frame-&gt;head.payload_offset == NULL) {\n            elog_e(TAG, \"[ERROR]UartSend: payload is NULL or length is 0\\r\\n\");\n            return;\n        }\n        elog_d(TAG, \"UartSend: length: %d\", MSG_GET_LENGTH(tmp_msg));\n        // elog_hexdump(TAG, 16, MSG_GET_PAYLOAD(tmp_msg), MSG_GET_LENGTH(tmp_msg));\n        memcpy(uart_tx_buffer[0], MSG_GET_PAYLOAD(tmp_msg), MSG_GET_LENGTH(tmp_msg));\n        DevUartDMASend(&amp;UartBspCfg[0].uart_cfg,(const uint8_t *) uart_tx_buffer[0], MSG_GET_LENGTH(tmp_msg));\n        // wait for TX DMA complete lock_tx\n        if (uart_handle-&gt;lock_tx != NULL) {\n            if (xSemaphoreTake(uart_handle-&gt;lock_tx, pdMS_TO_TICKS(300)) == pdFALSE) {\n                elog_e(TAG, \"[ERROR]UartSend: lock_tx timeout\\r\\n\");\n            }\n        } else {\n            elog_e(TAG, \"[ERROR]UartSend: lock_tx is NULL\\r\\n\");\n        }\n    } break;\n    case UartRcv: {\n        elog_d(TAG, \"Uart Com Recive :%s\", (char *)MSG_GET_PAYLOAD(tmp_msg));\n        // elog_hexdump(TAG, 8, MSG_GET_PAYLOAD(tmp_msg), MSG_GET_LENGTH(tmp_msg));\n\n    } break;\n    default:\n        elog_e(TAG, \"TASK %s RCV: unknown event: %d\\r\\n\", taskName, tmp_msg-&gt;frame-&gt;head.event);\n        break;\n}\n</code></pre> <p>} ``` </p>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#2-vfb","title":"2. \u901a\u8fc7VFB\u53d1\u9001\u786c\u4ef6\u64cd\u4f5c\u4e8b\u4ef6","text":"<p><code>608:636:dp2501project/Application/Core/Src/app_hmi.c static void HMISendCmd(uint16_t reg, const char *buffer, uint8_t length) {     TypeHMIComm_t hmiComm;     hmiComm.head        = HMI_HEAD;     hmiComm.length      = length + 5;  // cmd + reg + length + tail     hmiComm.cmd         = HMI_WRITE_CMD;     hmiComm.reg         = HMI_SWAP(reg);  // Register address, swap bytes for little-endian     hmiComm.buffer      = (uint8_t *)buffer;     hmiComm.tail        = HMI_TAIL;     uint8_t *hmi_buffer = pvPortMalloc(HMI_CMD_SIZE + length);     if (hmi_buffer == NULL) {         elog_e(TAG, \"Failed to allocate memory for HMI command\");         return;     }     memcpy(hmi_buffer, &amp;hmiComm, HMI_CMD_BEFORE_BUFFER_SIZE);     memcpy(hmi_buffer + HMI_CMD_BEFORE_BUFFER_SIZE, buffer, length);     memcpy(hmi_buffer + HMI_CMD_BEFORE_BUFFER_SIZE + length, &amp;hmiComm.tail, sizeof(hmiComm.tail));      vfb_send(UartSend, 0, hmi_buffer, HMI_CMD_SIZE + length);     elog_d(TAG, \"HMISendCmd: reg=0x%04X, length=%d, cmd=0x%02X, buffer='%s'\", reg, length, hmiComm.cmd, buffer);     vPortFree(hmi_buffer);  // Free the allocated memory after sending } static void HMIProcess(uint16_t reg, uint16_t percent) {     TypeHMICommProcess_t hmiComm;     hmiComm.head    = HMI_HEAD;     hmiComm.length  = 5;  // cmd + reg + length + tail     hmiComm.cmd     = HMI_WRITE_CMD;     hmiComm.reg     = HMI_SWAP(reg);  // Register address, swap bytes for little-endian     hmiComm.percent = HMI_SWAP(percent);     vfb_send(UartSend, 0, &amp;hmiComm, sizeof(TypeHMICommProcess_t)); }</code></p>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_4","title":"\u4f18\u70b9","text":"<ol> <li>\u89e3\u8026\u6027\u9ad8\uff1a\u786c\u4ef6\u64cd\u4f5c\u4e0e\u4e1a\u52a1\u903b\u8f91\u89e3\u8026\uff0c\u8c03\u7528\u65b9\u65e0\u9700\u4e86\u89e3\u786c\u4ef6\u7ec6\u8282</li> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a\u786c\u4ef6\u64cd\u4f5c\u5728\u72ec\u7acb\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u907f\u514d\u591a\u7ebf\u7a0b\u7ade\u4e89</li> <li>\u7edf\u4e00\u7ba1\u7406\uff1a\u6240\u6709\u786c\u4ef6\u64cd\u4f5c\u901a\u8fc7VFB\u7edf\u4e00\u8def\u7531\u548c\u7ba1\u7406</li> <li>\u53ef\u6269\u5c55\u6027\u5f3a\uff1a\u6613\u4e8e\u6dfb\u52a0\u65b0\u7684\u786c\u4ef6\u64cd\u4f5c\u4e8b\u4ef6\uff0c\u65e0\u9700\u4fee\u6539\u8c03\u7528\u65b9\u4ee3\u7801</li> <li>\u8d44\u6e90\u9694\u79bb\uff1a\u786c\u4ef6\u8d44\u6e90\u7531\u4e13\u95e8\u7684\u4efb\u52a1\u7ebf\u7a0b\u7ba1\u7406\uff0c\u907f\u514d\u8d44\u6e90\u51b2\u7a81</li> <li>\u5f02\u6b65\u5904\u7406\uff1a\u786c\u4ef6\u64cd\u4f5c\u5f02\u6b65\u6267\u884c\uff0c\u4e0d\u963b\u585e\u8c03\u7528\u7ebf\u7a0b</li> </ol>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_5","title":"\u7f3a\u70b9","text":"<ol> <li>\u5ef6\u8fdf\u8f83\u9ad8\uff1a\u6d88\u606f\u4f20\u9012\u9700\u8981\u7ecf\u8fc7VFB\u961f\u5217\uff0c\u589e\u52a0\u5ef6\u8fdf\uff08\u901a\u5e38\u51e0\u6beb\u79d2\u5230\u51e0\u5341\u6beb\u79d2\uff09</li> <li>\u5185\u5b58\u5f00\u9500\uff1a\u6d88\u606f\u9700\u8981\u5206\u914d\u5185\u5b58\uff0c\u589e\u52a0\u5185\u5b58\u4f7f\u7528</li> <li>\u8c03\u8bd5\u590d\u6742\uff1a\u9700\u8981\u8ddf\u8e2aVFB\u6d88\u606f\u6d41\u8f6c\uff0c\u8c03\u8bd5\u76f8\u5bf9\u590d\u6742</li> <li>\u4ee3\u7801\u590d\u6742\u5ea6\uff1a\u9700\u8981\u5b9e\u73b0VFB\u4e8b\u4ef6\u5904\u7406\u56de\u8c03\u51fd\u6570\uff0c\u589e\u52a0\u4ee3\u7801\u91cf</li> <li>\u5b9e\u65f6\u6027\u5dee\uff1a\u4e0d\u9002\u5408\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u6781\u9ad8\u7684\u573a\u666f</li> </ol>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_6","title":"\u9002\u7528\u573a\u666f","text":"<ul> <li>\u975e\u5b9e\u65f6\u786c\u4ef6\u64cd\u4f5c\uff08\u5982UART\u901a\u4fe1\u3001HMI\u663e\u793a\uff09</li> <li>\u9700\u8981\u7ebf\u7a0b\u5b89\u5168\u7684\u786c\u4ef6\u64cd\u4f5c</li> <li>\u786c\u4ef6\u8d44\u6e90\u9700\u8981\u7edf\u4e00\u7ba1\u7406\u7684\u573a\u666f</li> <li>\u591a\u4e2a\u4efb\u52a1\u9700\u8981\u8bbf\u95ee\u540c\u4e00\u786c\u4ef6\u8d44\u6e90</li> <li>\u9700\u8981\u5f02\u6b65\u5904\u7406\u7684\u786c\u4ef6\u64cd\u4f5c</li> </ul>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#api","title":"\u65b9\u5f0f\u4e8c\uff1a\u76f4\u63a5API\u8c03\u7528\u65b9\u5f0f","text":""},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_7","title":"\u5de5\u4f5c\u539f\u7406","text":"<p>\u76f4\u63a5\u5728\u5f53\u524d\u7ebf\u7a0b\u4e2d\u8c03\u7528\u786c\u4ef6\u9a71\u52a8API\u51fd\u6570\uff0c\u7acb\u5373\u6267\u884c\u786c\u4ef6\u64cd\u4f5c\uff0c\u65e0\u9700\u6d88\u606f\u4f20\u9012\u3002</p>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_8","title":"\u5178\u578b\u5b9e\u73b0\u793a\u4f8b","text":""},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#1-api","title":"1. \u76f4\u63a5\u8c03\u7528\u786c\u4ef6\u9a71\u52a8API","text":"<p>```467:481:dp2501project/Application/Core/Src/app_io.c void CmdIOSet(uint32_t id, uint8_t value) {     if (id &gt;= IOChannelMax) {         elog_e(TAG, \"Invalid IO ID: %d\", id);         CmdIOList();         return;     }     TypdefIOStatus *IOStatusHandle = &amp;IOStatus[id];     if (value) {         DevPinWrite(&amp;IOBspCfg[IOStatusHandle-&gt;id].pin, 1);         elog_d(TAG, \"Set IO %s ON\", IOStatusHandle-&gt;device_name);     } else {         DevPinWrite(&amp;IOBspCfg[IOStatusHandle-&gt;id].pin, 0);         elog_d(TAG, \"Set IO %s OFF\", IOStatusHandle-&gt;device_name);     } } <pre><code>#### 2. \u786c\u4ef6\u9a71\u52a8API\u5b9e\u73b0\n\n```169:176:OpenIBBOs/Middlewares/bsp/dev_pin/dev_pin.c\n// DevPinWrite\nvoid DevPinWrite(const DevPinHandleStruct *ptrDevPinHandle, uint8_t bit_value) {\n    if (ptrDevPinHandle-&gt;pin_mode == DevPinModeOutput) {\n        gpio_bit_write(ptrDevPinHandle-&gt;base, ptrDevPinHandle-&gt;pin, bit_value ? SET : RESET);\n    } else {\n        printf(\"Error: Pin %s is not configured as output.\\r\\n\", ptrDevPinHandle-&gt;device_name);\n    }\n}\n</code></pre></p>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_9","title":"\u4f18\u70b9","text":"<ol> <li>\u5ef6\u8fdf\u6781\u4f4e\uff1a\u76f4\u63a5\u8c03\u7528\uff0c\u65e0\u6d88\u606f\u4f20\u9012\u5f00\u9500\uff0c\u5ef6\u8fdf\u901a\u5e38\u5728\u5fae\u79d2\u7ea7</li> <li>\u5b9e\u65f6\u6027\u597d\uff1a\u9002\u5408\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u6781\u9ad8\u7684\u573a\u666f</li> <li>\u5185\u5b58\u5f00\u9500\u5c0f\uff1a\u65e0\u9700\u5206\u914d\u6d88\u606f\u5185\u5b58\uff0c\u5185\u5b58\u4f7f\u7528\u66f4\u5c11</li> <li>\u4ee3\u7801\u7b80\u5355\uff1a\u76f4\u63a5\u8c03\u7528API\uff0c\u4ee3\u7801\u76f4\u89c2\u6613\u61c2</li> <li>\u8c03\u8bd5\u65b9\u4fbf\uff1a\u8c03\u7528\u8def\u5f84\u6e05\u6670\uff0c\u6613\u4e8e\u8c03\u8bd5\u548c\u8ddf\u8e2a</li> <li>\u540c\u6b65\u6267\u884c\uff1a\u64cd\u4f5c\u7acb\u5373\u6267\u884c\uff0c\u7ed3\u679c\u53ef\u7acb\u5373\u83b7\u53d6</li> </ol>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_10","title":"\u7f3a\u70b9","text":"<ol> <li>\u7ebf\u7a0b\u5b89\u5168\u98ce\u9669\uff1a\u591a\u7ebf\u7a0b\u76f4\u63a5\u8c03\u7528\u53ef\u80fd\u5bfc\u81f4\u8d44\u6e90\u7ade\u4e89</li> <li>\u8026\u5408\u5ea6\u9ad8\uff1a\u4e1a\u52a1\u903b\u8f91\u4e0e\u786c\u4ef6\u9a71\u52a8\u8026\u5408\uff0c\u4fee\u6539\u786c\u4ef6\u9a71\u52a8\u5f71\u54cd\u8c03\u7528\u65b9</li> <li>\u8d44\u6e90\u7ba1\u7406\u96be\uff1a\u591a\u4e2a\u4efb\u52a1\u76f4\u63a5\u8bbf\u95ee\u540c\u4e00\u786c\u4ef6\u8d44\u6e90\u65f6\uff0c\u9700\u8981\u81ea\u884c\u7ba1\u7406\u4e92\u65a5</li> <li>\u53ef\u6269\u5c55\u6027\u5dee\uff1a\u6dfb\u52a0\u65b0\u529f\u80fd\u53ef\u80fd\u9700\u8981\u4fee\u6539\u591a\u4e2a\u8c03\u7528\u70b9</li> <li>\u963b\u585e\u8c03\u7528\uff1a\u540c\u6b65\u6267\u884c\u53ef\u80fd\u963b\u585e\u8c03\u7528\u7ebf\u7a0b\uff0c\u5f71\u54cd\u7cfb\u7edf\u54cd\u5e94\u6027</li> </ol>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_11","title":"\u9002\u7528\u573a\u666f","text":"<ul> <li>\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u6781\u9ad8\u7684\u64cd\u4f5c\uff08\u5982GPIO\u63a7\u5236\u3001ADC\u91c7\u6837\uff09</li> <li>\u5355\u7ebf\u7a0b\u73af\u5883\u6216\u5df2\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u7684\u573a\u666f</li> <li>\u7b80\u5355\u7684\u786c\u4ef6\u64cd\u4f5c\uff08\u5982GPIO\u8bfb\u5199\uff09</li> <li>\u9700\u8981\u7acb\u5373\u83b7\u53d6\u64cd\u4f5c\u7ed3\u679c\u7684\u573a\u666f</li> <li>\u6027\u80fd\u654f\u611f\u7684\u64cd\u4f5c</li> </ul>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_12","title":"\u5bf9\u6bd4\u5206\u6790\u8868","text":"\u5bf9\u6bd4\u7ef4\u5ea6 \u72ec\u7acb\u7ebf\u7a0b\u65b9\u5f0f\uff08VFB\uff09 \u76f4\u63a5API\u8c03\u7528\u65b9\u5f0f \u5ef6\u8fdf \u8f83\u9ad8\uff08\u6beb\u79d2\u7ea7\uff09 \u6781\u4f4e\uff08\u5fae\u79d2\u7ea7\uff09 \u5b9e\u65f6\u6027 \u8f83\u5dee \u6781\u597d \u7ebf\u7a0b\u5b89\u5168 \u4f18\u79c0 \u9700\u8981\u81ea\u884c\u4fdd\u8bc1 \u5185\u5b58\u5f00\u9500 \u8f83\u9ad8\uff08\u9700\u8981\u6d88\u606f\u5185\u5b58\uff09 \u8f83\u4f4e \u4ee3\u7801\u590d\u6742\u5ea6 \u8f83\u9ad8\uff08\u9700\u8981\u4e8b\u4ef6\u5904\u7406\uff09 \u8f83\u4f4e\uff08\u76f4\u63a5\u8c03\u7528\uff09 \u8c03\u8bd5\u96be\u5ea6 \u8f83\u96be\uff08\u9700\u8981\u8ddf\u8e2a\u6d88\u606f\u6d41\uff09 \u8f83\u6613\uff08\u8c03\u7528\u8def\u5f84\u6e05\u6670\uff09 \u89e3\u8026\u6027 \u9ad8 \u4f4e \u53ef\u6269\u5c55\u6027 \u597d \u4e00\u822c \u8d44\u6e90\u7ba1\u7406 \u7edf\u4e00\u7ba1\u7406 \u9700\u8981\u81ea\u884c\u7ba1\u7406 \u9002\u7528\u573a\u666f \u975e\u5b9e\u65f6\u3001\u591a\u4efb\u52a1\u8bbf\u95ee \u5b9e\u65f6\u3001\u5355\u4efb\u52a1\u6216\u5df2\u4fdd\u8bc1\u5b89\u5168"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_13","title":"\u6df7\u5408\u4f7f\u7528\u7b56\u7565","text":"<p>\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u9700\u6c42\u6df7\u5408\u4f7f\u7528\u4e24\u79cd\u65b9\u5f0f\uff1a</p>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#1_1","title":"\u7b56\u75651\uff1a\u6309\u5b9e\u65f6\u6027\u8981\u6c42\u533a\u5206","text":"<ul> <li>\u5b9e\u65f6\u6027\u8981\u6c42\u9ad8\uff1a\u4f7f\u7528\u76f4\u63a5API\u8c03\u7528</li> <li>GPIO\u63a7\u5236</li> <li>ADC\u91c7\u6837</li> <li> <p>\u5b9a\u65f6\u5668\u64cd\u4f5c</p> </li> <li> <p>\u5b9e\u65f6\u6027\u8981\u6c42\u4f4e\uff1a\u4f7f\u7528\u72ec\u7acb\u7ebf\u7a0b\u65b9\u5f0f</p> </li> <li>UART\u901a\u4fe1</li> <li>HMI\u663e\u793a</li> <li>\u7f51\u7edc\u901a\u4fe1</li> </ul>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#2","title":"\u7b56\u75652\uff1a\u6309\u8bbf\u95ee\u9891\u7387\u533a\u5206","text":"<ul> <li>\u9ad8\u9891\u8bbf\u95ee\uff1a\u4f7f\u7528\u76f4\u63a5API\u8c03\u7528\uff08\u907f\u514d\u6d88\u606f\u961f\u5217\u5806\u79ef\uff09</li> <li>\u4f4e\u9891\u8bbf\u95ee\uff1a\u4f7f\u7528\u72ec\u7acb\u7ebf\u7a0b\u65b9\u5f0f\uff08\u7b80\u5316\u4ee3\u7801\uff09</li> </ul>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#3","title":"\u7b56\u75653\uff1a\u6309\u8d44\u6e90\u7ade\u4e89\u60c5\u51b5\u533a\u5206","text":"<ul> <li>\u591a\u4efb\u52a1\u8bbf\u95ee\uff1a\u4f7f\u7528\u72ec\u7acb\u7ebf\u7a0b\u65b9\u5f0f\uff08\u7edf\u4e00\u7ba1\u7406\uff09</li> <li>\u5355\u4efb\u52a1\u8bbf\u95ee\uff1a\u4f7f\u7528\u76f4\u63a5API\u8c03\u7528\uff08\u7b80\u5316\u4ee3\u7801\uff09</li> </ul>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_14","title":"\u5b9e\u9645\u9879\u76ee\u4e2d\u7684\u4f7f\u7528\u60c5\u51b5","text":""},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_15","title":"\u4f7f\u7528\u72ec\u7acb\u7ebf\u7a0b\u65b9\u5f0f\u7684\u6a21\u5757","text":"<ol> <li>UART\u901a\u4fe1\u6a21\u5757 (<code>Uart.c</code>)</li> <li>\u901a\u8fc7VFB\u63a5\u6536<code>UartSend</code>\u4e8b\u4ef6</li> <li> <p>\u5728\u72ec\u7acb\u4efb\u52a1\u7ebf\u7a0b\u4e2d\u5904\u7406UART\u53d1\u9001</p> </li> <li> <p>HMI\u663e\u793a\u6a21\u5757 (<code>app_hmi.c</code>)</p> </li> <li>\u901a\u8fc7<code>vfb_send(UartSend, ...)</code>\u53d1\u9001HMI\u547d\u4ee4</li> <li> <p>UART\u4efb\u52a1\u7ebf\u7a0b\u8d1f\u8d23\u5b9e\u9645\u53d1\u9001</p> </li> <li> <p>\u6570\u636e\u8f6c\u6362\u6a21\u5757 (<code>app_covert.c</code>)</p> </li> <li>\u901a\u8fc7VFB\u53d1\u9001\u5404\u79cd\u786c\u4ef6\u64cd\u4f5c\u4e8b\u4ef6</li> <li>\u5982\uff1a<code>vfb_send(DACSgm3533Set, ...)</code></li> </ol>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#api_1","title":"\u4f7f\u7528\u76f4\u63a5API\u8c03\u7528\u7684\u6a21\u5757","text":"<ol> <li>IO\u63a7\u5236\u6a21\u5757 (<code>app_io.c</code>)</li> <li>\u76f4\u63a5\u8c03\u7528<code>DevPinWrite()</code>\u63a7\u5236GPIO</li> <li> <p>\u76f4\u63a5\u8c03\u7528<code>DevPinRead()</code>\u8bfb\u53d6GPIO\u72b6\u6001</p> </li> <li> <p>\u786c\u4ef6\u9a71\u52a8\u5c42 (<code>dev_pin.c</code>, <code>dev_spi.c</code>)</p> </li> <li>\u5e95\u5c42\u786c\u4ef6\u64cd\u4f5c\u76f4\u63a5\u8c03\u7528HAL\u5e93\u51fd\u6570</li> </ol>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_16","title":"\u6700\u4f73\u5b9e\u8df5\u5efa\u8bae","text":""},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#1_2","title":"1. \u786c\u4ef6\u9a71\u52a8\u5c42\u8bbe\u8ba1","text":"<ul> <li>\u5e95\u5c42\u786c\u4ef6\u64cd\u4f5c\uff1a\u4f7f\u7528\u76f4\u63a5API\u8c03\u7528\uff08\u5982<code>DevPinWrite()</code>\uff09</li> <li>\u786c\u4ef6\u62bd\u8c61\u5c42\uff1a\u63d0\u4f9b\u76f4\u63a5API\u63a5\u53e3\uff0c\u4f9b\u4e0a\u5c42\u9009\u62e9\u4f7f\u7528\u65b9\u5f0f</li> </ul>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#2_1","title":"2. \u5e94\u7528\u5c42\u8bbe\u8ba1","text":"<ul> <li>\u5b9e\u65f6\u6027\u8981\u6c42\u9ad8\uff1a\u76f4\u63a5\u8c03\u7528\u786c\u4ef6\u9a71\u52a8API</li> <li>\u5b9e\u65f6\u6027\u8981\u6c42\u4f4e\uff1a\u901a\u8fc7VFB\u53d1\u9001\u4e8b\u4ef6</li> <li>\u591a\u4efb\u52a1\u8bbf\u95ee\uff1a\u4f18\u5148\u4f7f\u7528VFB\u65b9\u5f0f</li> <li>\u5355\u4efb\u52a1\u8bbf\u95ee\uff1a\u53ef\u8003\u8651\u76f4\u63a5API\u8c03\u7528</li> </ul>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#3_1","title":"3. \u7ebf\u7a0b\u5b89\u5168\u4fdd\u8bc1","text":"<ul> <li>\u76f4\u63a5API\u8c03\u7528\uff1a\u4f7f\u7528\u4e92\u65a5\u9501\u4fdd\u62a4\u5171\u4eab\u8d44\u6e90</li> <li>VFB\u65b9\u5f0f\uff1a\u7531\u786c\u4ef6\u4efb\u52a1\u7ebf\u7a0b\u7edf\u4e00\u7ba1\u7406\uff0c\u5929\u7136\u7ebf\u7a0b\u5b89\u5168</li> </ul>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#4","title":"4. \u6027\u80fd\u4f18\u5316","text":"<ul> <li>\u9ad8\u9891\u64cd\u4f5c\uff1a\u8003\u8651\u76f4\u63a5API\u8c03\u7528\uff0c\u51cf\u5c11\u6d88\u606f\u961f\u5217\u5f00\u9500</li> <li>\u4f4e\u9891\u64cd\u4f5c\uff1a\u4f7f\u7528VFB\u65b9\u5f0f\uff0c\u7b80\u5316\u4ee3\u7801\u7ed3\u6784</li> </ul>"},{"location":"zero_topic_core/topic_bus/hardware_thread_vs_direct_api_analysis/#_17","title":"\u603b\u7ed3","text":"<p>OpenIBBOs\u9879\u76ee\u4e2d\u4e24\u79cd\u786c\u4ef6\u4f7f\u7528\u65b9\u5f0f\u5404\u6709\u4f18\u52bf\uff1a</p> <ul> <li>\u72ec\u7acb\u7ebf\u7a0b\u65b9\u5f0f\uff08VFB\uff09\uff1a\u9002\u5408\u975e\u5b9e\u65f6\u3001\u591a\u4efb\u52a1\u8bbf\u95ee\u3001\u9700\u8981\u7edf\u4e00\u7ba1\u7406\u7684\u573a\u666f</li> <li>\u76f4\u63a5API\u8c03\u7528\u65b9\u5f0f\uff1a\u9002\u5408\u5b9e\u65f6\u6027\u8981\u6c42\u9ad8\u3001\u5355\u4efb\u52a1\u8bbf\u95ee\u3001\u6027\u80fd\u654f\u611f\u7684\u573a\u666f</li> </ul> <p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u5e94\u8be5\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u65b9\u5f0f\uff0c\u751a\u81f3\u53ef\u4ee5\u5728\u540c\u4e00\u9879\u76ee\u4e2d\u6df7\u5408\u4f7f\u7528\u4e24\u79cd\u65b9\u5f0f\uff0c\u4ee5\u8fbe\u5230\u6700\u4f73\u7684\u6027\u80fd\u548c\u4ee3\u7801\u53ef\u7ef4\u62a4\u6027\u5e73\u8861\u3002</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/","title":"Zero Topic Core \u4e0e MCU \u5916\u8bbe\u6df1\u5ea6\u4f18\u5316\u53ef\u884c\u6027\u5206\u6790","text":""},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#_1","title":"\u6982\u8ff0","text":"<p>\u672c\u6587\u6863\u5206\u6790\u5982\u4f55\u5c06 zero topic core\uff08topic_bus + obj_dict\uff09\u4e0e MCU \u786c\u4ef6\u5916\u8bbe\uff08DMA\u3001Cache\u3001MMU\u3001IPC\u7b49\uff09\u8fdb\u884c\u6df1\u5ea6\u4f18\u5316\uff0c\u5728\u4e0d\u4fee\u6539\u73b0\u6709\u4ee3\u7801\u7684\u524d\u63d0\u4e0b\uff0c\u901a\u8fc7\u786c\u4ef6\u914d\u7f6e\u548c\u4f18\u5316\u7b56\u7565\u63d0\u5347\u7cfb\u7edf\u6027\u80fd\u3002</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#_2","title":"\u5f53\u524d\u67b6\u6784\u5206\u6790","text":""},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#zero-topic-core","title":"Zero Topic Core \u6838\u5fc3\u7ec4\u4ef6","text":"<ol> <li>topic_bus\uff08Topic\u603b\u7ebf\uff09</li> <li>\u57fa\u4e8e\u89c4\u5219\u7684\u4e8b\u4ef6\u53d1\u5e03\u8ba2\u9605\u6846\u67b6</li> <li>\u652f\u6301 OR/AND/MANUAL \u89c4\u5219</li> <li>\u56de\u8c03\u8ba2\u9605\u673a\u5236\uff0c\u96f6\u62f7\u8d1d\u6570\u636e\u8bbf\u95ee</li> <li>ISR \u5b89\u5168\u8def\u5f84\uff08\u901a\u8fc7 ring_buffer\uff09</li> <li> <p>\u8bbe\u8ba1\u76ee\u6807\uff1a\u4e8b\u4ef6\u53d1\u5e03\u5ef6\u8fdf &lt; 10us\uff0c\u89c4\u5219\u5339\u914d &lt; 5-8us</p> </li> <li> <p>obj_dict\uff08\u5bf9\u8c61\u5b57\u5178\uff09</p> </li> <li>\u952e\u503c\u5bf9\u6570\u636e\u5b58\u50a8</li> <li>\u652f\u6301\u5f15\u7528\u8ba1\u6570\u548c\u751f\u547d\u5468\u671f\u7ba1\u7406</li> <li>\u65f6\u95f4\u6233\u548c\u7248\u672c\u53f7\u7ba1\u7406</li> <li> <p>\u53ef\u9009\u5185\u5b58\u6c60\u9884\u5206\u914d</p> </li> <li> <p>\u6570\u636e\u6d41\u8def\u5f84 <pre><code>\u4e8b\u4ef6\u53d1\u5e03 \u2192 obj_dict_set (\u6570\u636e\u62f7\u8d1d) \u2192 \u89c4\u5219\u5339\u914d \u2192 \n\u4eceobj_dict\u83b7\u53d6\u6570\u636e\u6307\u9488 \u2192 \u56de\u8c03\u89e6\u53d1\uff08\u96f6\u62f7\u8d1d\uff09\n</code></pre></p> </li> </ol>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#mcu","title":"MCU \u5916\u8bbe\u4f18\u5316\u65b9\u6848","text":""},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#1-dma","title":"1. DMA\uff08\u76f4\u63a5\u5185\u5b58\u8bbf\u95ee\uff09\u4f18\u5316","text":""},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#11","title":"1.1 \u53ef\u884c\u6027\u5206\u6790","text":"<p>\u4f18\u5316\u573a\u666f\uff1a - <code>obj_dict_set</code> \u7684\u6570\u636e\u62f7\u8d1d\u64cd\u4f5c - ISR \u961f\u5217\u7684 ring_buffer \u6570\u636e\u4f20\u8f93 - \u8de8 MCU \u901a\u4fe1\u65f6\u7684\u6570\u636e\u642c\u8fd0</p> <p>\u53ef\u884c\u6027\uff1a\u9ad8</p> <p>\u539f\u56e0\uff1a - DMA \u53ef\u4ee5\u5b8c\u5168\u66ff\u4ee3 CPU \u7684\u6570\u636e\u62f7\u8d1d\u64cd\u4f5c - \u65e0\u9700\u4fee\u6539\u4ee3\u7801\uff0c\u53ea\u9700\u914d\u7f6e DMA \u901a\u9053 - \u53ef\u4ee5\u663e\u8457\u964d\u4f4e CPU \u8d1f\u8f7d\u548c\u5ef6\u8fdf</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#12","title":"1.2 \u4f18\u5316\u7b56\u7565","text":"<p>\u7b56\u75651\uff1aobj_dict \u6570\u636e\u62f7\u8d1d DMA \u5316</p> <p>\u5f53\u524d\u5b9e\u73b0\uff1a <pre><code>// obj_dict_set \u5185\u90e8\u4f7f\u7528 memcpy\nmemcpy(dict_entry-&gt;value, data, len);\n</code></pre></p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u914d\u7f6e DMA \u901a\u9053\uff0c\u5c06\u6570\u636e\u62f7\u8d1d\u64cd\u4f5c\u4ece CPU \u8f6c\u79fb\u5230 DMA - \u4f7f\u7528 DMA \u5185\u5b58\u5230\u5185\u5b58\u4f20\u8f93\u6a21\u5f0f - \u5bf9\u4e8e\u5c0f\u6570\u636e\uff08&lt; 32\u5b57\u8282\uff09\uff0cCPU \u62f7\u8d1d\u53ef\u80fd\u66f4\u5feb\uff0c\u53ef\u8bbe\u7f6e\u9608\u503c</p> <p>\u9884\u671f\u6536\u76ca\uff1a - CPU \u8d1f\u8f7d\u964d\u4f4e\uff1a30-50%\uff08\u53d6\u51b3\u4e8e\u6570\u636e\u5927\u5c0f\uff09 - \u5ef6\u8fdf\u964d\u4f4e\uff1a5-15%\uff08\u5927\u5757\u6570\u636e\u66f4\u660e\u663e\uff09 - \u91ca\u653e CPU \u8d44\u6e90\u7528\u4e8e\u5176\u4ed6\u4efb\u52a1</p> <p>\u5b9e\u65bd\u96be\u5ea6\uff1a\u4f4e - \u53ea\u9700\u914d\u7f6e DMA \u5916\u8bbe\uff0c\u65e0\u9700\u4fee\u6539\u4ee3\u7801\u903b\u8f91 - \u53ef\u4ee5\u901a\u8fc7\u6761\u4ef6\u7f16\u8bd1\u6216\u8fd0\u884c\u65f6\u5207\u6362\u9009\u62e9 DMA \u6216 CPU \u62f7\u8d1d</p> <p>\u7b56\u75652\uff1aISR \u961f\u5217 DMA \u4f20\u8f93</p> <p>\u5f53\u524d\u5b9e\u73b0\uff1a <pre><code>// ring_buffer \u5185\u90e8\u4f7f\u7528 memcpy\nmemcpy(buffer, data, size);\n</code></pre></p> <p>\u4f18\u5316\u65b9\u6848\uff1a - ISR \u961f\u5217\u7684\u5165\u961f/\u51fa\u961f\u64cd\u4f5c\u4f7f\u7528 DMA \u4f20\u8f93 - \u51cf\u5c11 ISR \u4e0a\u4e0b\u6587\u4e2d\u7684 CPU \u65f6\u95f4 - \u63d0\u9ad8 ISR \u54cd\u5e94\u901f\u5ea6</p> <p>\u9884\u671f\u6536\u76ca\uff1a - ISR \u6267\u884c\u65f6\u95f4\u964d\u4f4e\uff1a20-40% - \u7cfb\u7edf\u5b9e\u65f6\u6027\u63d0\u5347 - \u964d\u4f4e\u4e2d\u65ad\u5ef6\u8fdf</p> <p>\u7b56\u75653\uff1a\u6279\u91cf\u6570\u636e\u642c\u8fd0</p> <p>\u4f18\u5316\u573a\u666f\uff1a - \u591a\u4e2a topic \u4e8b\u4ef6\u6279\u91cf\u5904\u7406 - \u8de8 MCU \u901a\u4fe1\u65f6\u7684\u6570\u636e\u6253\u5305\u4f20\u8f93</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528 DMA \u94fe\u5f0f\u4f20\u8f93\uff08Linked List\uff09 - \u4e00\u6b21\u6027\u642c\u8fd0\u591a\u4e2a\u6570\u636e\u5757 - \u51cf\u5c11 DMA \u914d\u7f6e\u5f00\u9500</p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u6279\u91cf\u4f20\u8f93\u6548\u7387\u63d0\u5347\uff1a40-60% - \u964d\u4f4e DMA \u914d\u7f6e\u5f00\u9500</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#13","title":"1.3 \u5b9e\u65bd\u5efa\u8bae","text":"<ol> <li>DMA \u914d\u7f6e\u5c42\u62bd\u8c61</li> <li>\u521b\u5efa DMA \u62bd\u8c61\u5c42\uff0c\u5c01\u88c5 DMA \u64cd\u4f5c</li> <li>\u63d0\u4f9b\u7edf\u4e00\u7684\u63a5\u53e3\uff1a<code>dma_memcpy(dst, src, len)</code></li> <li> <p>\u652f\u6301\u8fd0\u884c\u65f6\u9009\u62e9 DMA \u6216 CPU \u62f7\u8d1d</p> </li> <li> <p>\u9608\u503c\u4f18\u5316</p> </li> <li>\u5c0f\u6570\u636e\uff08&lt; 16\u5b57\u8282\uff09\uff1aCPU \u62f7\u8d1d\uff08DMA \u914d\u7f6e\u5f00\u9500\u5927\uff09</li> <li>\u4e2d\u7b49\u6570\u636e\uff0816-64\u5b57\u8282\uff09\uff1a\u6839\u636e\u8d1f\u8f7d\u9009\u62e9</li> <li> <p>\u5927\u6570\u636e\uff08&gt; 64\u5b57\u8282\uff09\uff1a\u4f18\u5148\u4f7f\u7528 DMA</p> </li> <li> <p>DMA \u901a\u9053\u5206\u914d</p> </li> <li>\u4e3a obj_dict \u5206\u914d\u4e13\u7528 DMA \u901a\u9053</li> <li>\u4e3a ring_buffer \u5206\u914d\u4e13\u7528 DMA \u901a\u9053</li> <li>\u907f\u514d DMA \u901a\u9053\u51b2\u7a81</li> </ol>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#2-cache","title":"2. Cache \u4f18\u5316","text":""},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#21","title":"2.1 \u53ef\u884c\u6027\u5206\u6790","text":"<p>\u4f18\u5316\u573a\u666f\uff1a - topic_entry_t \u6570\u7ec4\u8bbf\u95ee\uff08\u89c4\u5219\u5339\u914d\uff09 - obj_dict_entry_t \u6570\u7ec4\u8bbf\u95ee\uff08\u6570\u636e\u67e5\u627e\uff09 - \u8ba2\u9605\u8005\u94fe\u8868\u904d\u5386 - \u89c4\u5219\u7f13\u5b58\uff08TOPIC_BUS_ENABLE_RULE_CACHE\uff09</p> <p>\u53ef\u884c\u6027\uff1a\u9ad8</p> <p>\u539f\u56e0\uff1a - Cache \u662f\u786c\u4ef6\u81ea\u52a8\u7ba1\u7406\u7684\uff0c\u53ea\u9700\u8981\u5408\u7406\u7684\u5185\u5b58\u5e03\u5c40 - \u901a\u8fc7\u5185\u5b58\u5bf9\u9f50\u548c\u6570\u636e\u7ed3\u6784\u4f18\u5316\u53ef\u4ee5\u63d0\u5347 Cache \u547d\u4e2d\u7387 - \u73b0\u6709\u4ee3\u7801\u5df2\u7ecf\u652f\u6301\u539f\u5b50\u64cd\u4f5c\uff0c\u5bf9 Cache \u53cb\u597d</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#22","title":"2.2 \u4f18\u5316\u7b56\u7565","text":"<p>\u7b56\u75651\uff1a\u6570\u636e\u7ed3\u6784 Cache Line \u5bf9\u9f50</p> <p>\u5f53\u524d\u95ee\u9898\uff1a - <code>topic_entry_t</code> \u7ed3\u6784\u53ef\u80fd\u8de8 Cache Line - <code>obj_dict_entry_t</code> \u7ed3\u6784\u53ef\u80fd\u8de8 Cache Line - \u9891\u7e41\u8bbf\u95ee\u7684\u5b57\u6bb5\u53ef\u80fd\u5206\u6563\u5728\u4e0d\u540c Cache Line</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528 <code>__attribute__((aligned(64)))</code> \u5bf9\u9f50\u5230 Cache Line\uff0864\u5b57\u8282\uff09 - \u5c06\u9891\u7e41\u8bbf\u95ee\u7684\u5b57\u6bb5\u653e\u5728\u7ed3\u6784\u4f53\u5f00\u5934 - \u5c06\u4e0d\u5e38\u8bbf\u95ee\u7684\u7edf\u8ba1\u5b57\u6bb5\u653e\u5728\u7ed3\u6784\u4f53\u672b\u5c3e</p> <p>\u4f18\u5316\u793a\u4f8b\uff1a <pre><code>// \u4f18\u5316\u524d\uff1a\u53ef\u80fd\u8de8 Cache Line\ntypedef struct {\n    uint16_t topic_id;\n    topic_rule_t rule;\n    topic_subscription_t* subscribers;\n    uint32_t event_count;  // \u7edf\u8ba1\u5b57\u6bb5\n} topic_entry_t;\n\n// \u4f18\u5316\u540e\uff1aCache Line \u5bf9\u9f50\ntypedef struct {\n    uint16_t topic_id;\n    topic_rule_t rule;\n    topic_subscription_t* subscribers;\n    // ... \u586b\u5145\u5230 64 \u5b57\u8282\u8fb9\u754c\n    uint32_t event_count;  // \u7edf\u8ba1\u5b57\u6bb5\n} __attribute__((aligned(64))) topic_entry_t;\n</code></pre></p> <p>\u9884\u671f\u6536\u76ca\uff1a - Cache \u547d\u4e2d\u7387\u63d0\u5347\uff1a15-30% - \u89c4\u5219\u5339\u914d\u5ef6\u8fdf\u964d\u4f4e\uff1a10-20% - \u51cf\u5c11 Cache \u5931\u6548\u5e26\u6765\u7684\u5ef6\u8fdf</p> <p>\u7b56\u75652\uff1a\u70ed\u70b9\u6570\u636e\u9884\u52a0\u8f7d</p> <p>\u4f18\u5316\u573a\u666f\uff1a - \u89c4\u5219\u5339\u914d\u65f6\u9700\u8981\u904d\u5386\u6240\u6709 topic_entry - obj_dict \u67e5\u627e\u65f6\u9700\u8981\u904d\u5386\u6240\u6709 entry</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528 Cache \u9884\u53d6\u6307\u4ee4\uff08Prefetch\uff09 - \u5728\u904d\u5386\u524d\u9884\u52a0\u8f7d\u4e0b\u4e00\u4e2a Cache Line - \u9488\u5bf9 ARM Cortex-M\uff1a\u4f7f\u7528 <code>__pld()</code> \u6216 <code>__prefetch()</code></p> <p>\u4f18\u5316\u793a\u4f8b\uff1a <pre><code>// \u5728 __find_topic \u4e2d\u9884\u52a0\u8f7d\nstatic topic_entry_t* __find_topic(topic_bus_t* bus, uint16_t topic_id) {\n    for (size_t i = 0; i &lt; bus-&gt;max_topics; ++i) {\n        // \u9884\u52a0\u8f7d\u4e0b\u4e00\u4e2a Cache Line\n        if (i + 1 &lt; bus-&gt;max_topics) {\n            __prefetch(&amp;bus-&gt;topics[i + 1]);\n        }\n        if (bus-&gt;topics[i].topic_id == topic_id) {\n            return &amp;bus-&gt;topics[i];\n        }\n    }\n    return NULL;\n}\n</code></pre></p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u67e5\u627e\u5ef6\u8fdf\u964d\u4f4e\uff1a5-15% - \u51cf\u5c11 Cache Miss \u5e26\u6765\u7684\u505c\u987f</p> <p>\u7b56\u75653\uff1aWrite-Back Cache \u4f18\u5316</p> <p>\u4f18\u5316\u573a\u666f\uff1a - <code>obj_dict_set</code> \u7684\u6570\u636e\u5199\u5165 - \u539f\u5b50\u64cd\u4f5c\uff08atomic_uint_fast32_t\uff09\u7684\u66f4\u65b0</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u914d\u7f6e Cache \u4e3a Write-Back \u6a21\u5f0f\uff08\u5982\u679c MCU \u652f\u6301\uff09 - \u51cf\u5c11\u5bf9\u4e3b\u5185\u5b58\u7684\u5199\u64cd\u4f5c - \u6279\u91cf\u5199\u56de\uff0c\u51cf\u5c11\u603b\u7ebf\u5360\u7528</p> <p>\u6ce8\u610f\u4e8b\u9879\uff1a - \u9700\u8981\u786e\u4fdd Cache \u4e00\u81f4\u6027\uff08Cache Coherency\uff09 - \u591a\u6838\u7cfb\u7edf\u9700\u8981 Cache \u540c\u6b65\u673a\u5236 - DMA \u64cd\u4f5c\u65f6\u53ef\u80fd\u9700\u8981 Cache \u65e0\u6548\u5316\uff08Invalidate\uff09</p> <p>\u7b56\u75654\uff1aCache \u9501\u5b9a\uff08Cache Locking\uff09</p> <p>\u4f18\u5316\u573a\u666f\uff1a - \u5173\u952e\u8def\u5f84\u4ee3\u7801\uff08\u89c4\u5219\u5339\u914d\u51fd\u6570\uff09 - \u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u7ed3\u6784</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u5c06\u5173\u952e\u4ee3\u7801\u9501\u5b9a\u5728 Cache \u4e2d\uff08\u5982\u679c MCU \u652f\u6301\uff09 - \u5c06\u70ed\u70b9\u6570\u636e\u9501\u5b9a\u5728 Cache \u4e2d - \u786e\u4fdd\u5173\u952e\u8def\u5f84\u7684 Cache \u547d\u4e2d\u7387</p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u5173\u952e\u8def\u5f84\u5ef6\u8fdf\u964d\u4f4e\uff1a20-40% - \u5b9e\u65f6\u6027\u663e\u8457\u63d0\u5347</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#23","title":"2.3 \u5b9e\u65bd\u5efa\u8bae","text":"<ol> <li>\u5185\u5b58\u5e03\u5c40\u4f18\u5316</li> <li>\u4f7f\u7528\u7f16\u8bd1\u9009\u9879\u5f3a\u5236 Cache Line \u5bf9\u9f50</li> <li>\u91cd\u65b0\u7ec4\u7ec7\u6570\u636e\u7ed3\u6784\uff0c\u5c06\u70ed\u70b9\u5b57\u6bb5\u96c6\u4e2d</li> <li> <p>\u4f7f\u7528\u7ed3\u6784\u4f53\u586b\u5145\u4f18\u5316</p> </li> <li> <p>\u7f16\u8bd1\u5668\u4f18\u5316</p> </li> <li>\u542f\u7528 <code>-falign-loops</code> \u548c <code>-falign-functions</code></li> <li>\u4f7f\u7528 <code>-mtune</code> \u9488\u5bf9\u7279\u5b9a CPU \u4f18\u5316</li> <li> <p>\u542f\u7528 <code>-funroll-loops</code>\uff08\u8c28\u614e\u4f7f\u7528\uff09</p> </li> <li> <p>\u8fd0\u884c\u65f6 Cache \u7ba1\u7406</p> </li> <li>DMA \u64cd\u4f5c\u524d\u540e\u6267\u884c Cache \u65e0\u6548\u5316/\u5199\u56de</li> <li>\u4f7f\u7528\u5185\u5b58\u5c4f\u969c\uff08Memory Barrier\uff09\u4fdd\u8bc1 Cache \u4e00\u81f4\u6027</li> </ol>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#3-mmu","title":"3. MMU\uff08\u5185\u5b58\u7ba1\u7406\u5355\u5143\uff09\u4f18\u5316","text":""},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#31","title":"3.1 \u53ef\u884c\u6027\u5206\u6790","text":"<p>\u4f18\u5316\u573a\u666f\uff1a - \u5185\u5b58\u4fdd\u62a4\uff08\u9632\u6b62\u975e\u6cd5\u8bbf\u95ee\uff09 - \u5185\u5b58\u5730\u5740\u91cd\u6620\u5c04 - \u5185\u5b58\u533a\u57df\u8bbf\u95ee\u63a7\u5236</p> <p>\u53ef\u884c\u6027\uff1a\u4e2d\u7b49</p> <p>\u539f\u56e0\uff1a - \u5927\u591a\u6570 MCU\uff08\u5982 Cortex-M3/M4\uff09\u4e0d\u652f\u6301 MMU - \u53ea\u6709\u9ad8\u7aef MCU\uff08\u5982 Cortex-A \u7cfb\u5217\uff09\u624d\u652f\u6301 MMU - \u5982\u679c MCU \u652f\u6301 MPU\uff08Memory Protection Unit\uff09\uff0c\u53ef\u4ee5\u90e8\u5206\u66ff\u4ee3</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#32-mmumpu-mcu","title":"3.2 \u4f18\u5316\u7b56\u7565\uff08\u9002\u7528\u4e8e\u652f\u6301 MMU/MPU \u7684 MCU\uff09","text":"<p>\u7b56\u75651\uff1a\u5185\u5b58\u4fdd\u62a4</p> <p>\u4f18\u5316\u573a\u666f\uff1a - \u4fdd\u62a4 obj_dict \u6570\u636e\u4e0d\u88ab\u975e\u6cd5\u8bbf\u95ee - \u4fdd\u62a4 topic_bus \u7ed3\u6784\u4e0d\u88ab\u7834\u574f - \u9632\u6b62\u7f13\u51b2\u533a\u6ea2\u51fa</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528 MMU/MPU \u8bbe\u7f6e\u53ea\u8bfb/\u53ea\u5199\u533a\u57df - \u5c06\u5173\u952e\u6570\u636e\u7ed3\u6784\u653e\u5728\u53d7\u4fdd\u62a4\u7684\u5185\u5b58\u533a\u57df - \u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\uff1a\u4ee3\u7801\u6bb5\u53ea\u8bfb\uff0c\u6570\u636e\u6bb5\u53ef\u8bfb\u5199</p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u7cfb\u7edf\u7a33\u5b9a\u6027\u63d0\u5347 - \u9632\u6b62\u5185\u5b58\u9519\u8bef\u5bfc\u81f4\u7684\u7cfb\u7edf\u5d29\u6e83 - \u63d0\u5347\u7cfb\u7edf\u5b89\u5168\u6027</p> <p>\u7b56\u75652\uff1a\u5185\u5b58\u5730\u5740\u91cd\u6620\u5c04</p> <p>\u4f18\u5316\u573a\u666f\uff1a - \u5c06\u70ed\u70b9\u6570\u636e\u6620\u5c04\u5230\u66f4\u5feb\u7684\u5185\u5b58\u533a\u57df - \u4f18\u5316\u5185\u5b58\u8bbf\u95ee\u5ef6\u8fdf</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528 MMU \u5c06 obj_dict \u6620\u5c04\u5230 TCM\uff08Tightly Coupled Memory\uff09 - \u5c06 topic_bus \u6620\u5c04\u5230 ITCM\uff08Instruction TCM\uff09 - \u5229\u7528\u4e0d\u540c\u5185\u5b58\u533a\u57df\u7684\u6027\u80fd\u5dee\u5f02</p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u5185\u5b58\u8bbf\u95ee\u5ef6\u8fdf\u964d\u4f4e\uff1a30-50%\uff08TCM \u8bbf\u95ee\uff09 - \u63d0\u5347\u7cfb\u7edf\u6574\u4f53\u6027\u80fd</p> <p>\u7b56\u75653\uff1a\u865a\u62df\u5185\u5b58\u7ba1\u7406</p> <p>\u4f18\u5316\u573a\u666f\uff1a - \u52a8\u6001\u5185\u5b58\u5206\u914d\u4f18\u5316 - \u5185\u5b58\u788e\u7247\u6574\u7406</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528 MMU \u5b9e\u73b0\u865a\u62df\u5185\u5b58\u7ba1\u7406 - \u5c06\u7269\u7406\u5185\u5b58\u6620\u5c04\u5230\u865a\u62df\u5730\u5740\u7a7a\u95f4 - \u5b9e\u73b0\u5185\u5b58\u9875\u9762\u7684\u52a8\u6001\u5206\u914d\u548c\u56de\u6536</p> <p>\u6ce8\u610f\u4e8b\u9879\uff1a - \u9700\u8981 MMU \u652f\u6301\uff0c\u5927\u591a\u6570 MCU \u4e0d\u652f\u6301 - \u5b9e\u73b0\u590d\u6742\u5ea6\u9ad8 - \u53ef\u80fd\u5f15\u5165\u6027\u80fd\u5f00\u9500</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#33-mpumemory-protection-unit","title":"3.3 MPU\uff08Memory Protection Unit\uff09\u66ff\u4ee3\u65b9\u6848","text":"<p>\u5bf9\u4e8e\u4e0d\u652f\u6301 MMU \u7684 MCU\uff1a</p> <p>\u7b56\u7565\uff1a\u4f7f\u7528 MPU \u5b9e\u73b0\u90e8\u5206\u4f18\u5316</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528 MPU \u8bbe\u7f6e\u5185\u5b58\u4fdd\u62a4\u533a\u57df - \u5c06\u5173\u952e\u6570\u636e\u7ed3\u6784\u653e\u5728\u53d7\u4fdd\u62a4\u533a\u57df - \u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\uff08\u53ea\u8bfb/\u53ea\u5199/\u7981\u6b62\u8bbf\u95ee\uff09</p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u5185\u5b58\u4fdd\u62a4\u529f\u80fd - \u9632\u6b62\u975e\u6cd5\u8bbf\u95ee - \u63d0\u5347\u7cfb\u7edf\u7a33\u5b9a\u6027</p> <p>\u5b9e\u65bd\u96be\u5ea6\uff1a\u4e2d\u7b49 - \u9700\u8981\u914d\u7f6e MPU \u5bc4\u5b58\u5668 - \u9700\u8981\u4e86\u89e3\u5185\u5b58\u5e03\u5c40 - \u9700\u8981\u5c0f\u5fc3\u5904\u7406 MPU \u914d\u7f6e\uff0c\u907f\u514d\u5f71\u54cd\u6b63\u5e38\u529f\u80fd</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#4-ipc","title":"4. IPC\uff08\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff09\u4f18\u5316","text":""},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#41","title":"4.1 \u53ef\u884c\u6027\u5206\u6790","text":"<p>\u4f18\u5316\u573a\u666f\uff1a - \u591a\u6838 MCU \u7684\u8de8\u6838\u901a\u4fe1 - \u5171\u4eab\u5185\u5b58\u8bbf\u95ee - \u6838\u95f4\u540c\u6b65\u673a\u5236</p> <p>\u53ef\u884c\u6027\uff1a\u9ad8\uff08\u4ec5\u9002\u7528\u4e8e\u591a\u6838 MCU\uff09</p> <p>\u539f\u56e0\uff1a - zero topic core \u672c\u8eab\u662f\u5355\u6838\u8bbe\u8ba1 - \u5982\u679c\u90e8\u7f72\u5728\u591a\u6838 MCU \u4e0a\uff0c\u53ef\u4ee5\u5229\u7528 IPC \u673a\u5236\u4f18\u5316 - \u53ef\u4ee5\u901a\u8fc7\u786c\u4ef6\u673a\u5236\u5b9e\u73b0\u96f6\u62f7\u8d1d\u8de8\u6838\u901a\u4fe1</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#42-mcu","title":"4.2 \u4f18\u5316\u7b56\u7565\uff08\u9002\u7528\u4e8e\u591a\u6838 MCU\uff09","text":"<p>\u7b56\u75651\uff1a\u5171\u4eab\u5185\u5b58\u4f18\u5316</p> <p>\u4f18\u5316\u573a\u666f\uff1a - \u591a\u4e2a\u6838\u5fc3\u5171\u4eab obj_dict - \u591a\u4e2a\u6838\u5fc3\u5171\u4eab topic_bus</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528\u5171\u4eab\u5185\u5b58\u533a\u57df\uff08Shared Memory Region\uff09 - \u914d\u7f6e\u5185\u5b58\u4e3a\u5171\u4eab\u5c5e\u6027\uff08Shareable\uff09 - \u4f7f\u7528\u786c\u4ef6 Cache \u4e00\u81f4\u6027\u534f\u8bae\uff08\u5982 MESI\uff09</p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u8de8\u6838\u901a\u4fe1\u5ef6\u8fdf\u964d\u4f4e\uff1a50-70% - \u51cf\u5c11\u6570\u636e\u62f7\u8d1d\u5f00\u9500 - \u63d0\u5347\u591a\u6838\u5229\u7528\u7387</p> <p>\u7b56\u75652\uff1a\u786c\u4ef6\u90ae\u7bb1\uff08Mailbox\uff09\u901a\u4fe1</p> <p>\u4f18\u5316\u573a\u666f\uff1a - \u8de8\u6838\u4e8b\u4ef6\u901a\u77e5 - \u8de8\u6838\u6570\u636e\u540c\u6b65</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528\u786c\u4ef6 Mailbox \u5b9e\u73b0\u8de8\u6838\u901a\u4fe1 - \u5c06\u4e8b\u4ef6\u901a\u77e5\u901a\u8fc7 Mailbox \u53d1\u9001 - \u51cf\u5c11\u8f6f\u4ef6\u4e2d\u65ad\u5f00\u9500</p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u8de8\u6838\u901a\u4fe1\u5ef6\u8fdf\u964d\u4f4e\uff1a30-50% - \u964d\u4f4e CPU \u8d1f\u8f7d - \u63d0\u5347\u5b9e\u65f6\u6027</p> <p>\u7b56\u75653\uff1a\u786c\u4ef6\u4fe1\u53f7\u91cf\uff08Semaphore\uff09</p> <p>\u4f18\u5316\u573a\u666f\uff1a - \u8de8\u6838\u540c\u6b65\u673a\u5236 - \u5171\u4eab\u8d44\u6e90\u8bbf\u95ee\u63a7\u5236</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528\u786c\u4ef6 Semaphore \u66ff\u4ee3\u8f6f\u4ef6\u9501 - \u51cf\u5c11\u9501\u7ade\u4e89\u5f00\u9500 - \u63d0\u5347\u5e76\u53d1\u6027\u80fd</p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u9501\u5ef6\u8fdf\u964d\u4f4e\uff1a40-60% - \u51cf\u5c11 CPU \u8d1f\u8f7d - \u63d0\u5347\u5e76\u53d1\u6027\u80fd</p> <p>\u7b56\u75654\uff1a\u6838\u95f4 DMA \u4f20\u8f93</p> <p>\u4f18\u5316\u573a\u666f\uff1a - \u8de8\u6838\u5927\u6570\u636e\u4f20\u8f93 - \u6838\u95f4\u6570\u636e\u642c\u8fd0</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528\u6838\u95f4 DMA \u5b9e\u73b0\u96f6\u62f7\u8d1d\u4f20\u8f93 - \u51cf\u5c11 CPU \u4ecb\u5165 - \u63d0\u5347\u4f20\u8f93\u6548\u7387</p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u8de8\u6838\u4f20\u8f93\u5ef6\u8fdf\u964d\u4f4e\uff1a50-70% - \u964d\u4f4e CPU \u8d1f\u8f7d</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#43","title":"4.3 \u5b9e\u65bd\u5efa\u8bae","text":"<ol> <li>\u591a\u6838\u67b6\u6784\u8bbe\u8ba1</li> <li>Core 0\uff1a\u8fd0\u884c topic_bus \u548c\u89c4\u5219\u5339\u914d</li> <li>Core 1\uff1a\u8fd0\u884c\u5e94\u7528\u4efb\u52a1\u548c\u56de\u8c03\u5904\u7406</li> <li> <p>\u5171\u4eab obj_dict \u6570\u636e</p> </li> <li> <p>\u6570\u636e\u4e00\u81f4\u6027\u4fdd\u8bc1</p> </li> <li>\u4f7f\u7528\u786c\u4ef6 Cache \u4e00\u81f4\u6027\u534f\u8bae</li> <li>\u4f7f\u7528\u5185\u5b58\u5c4f\u969c\u4fdd\u8bc1\u6570\u636e\u53ef\u89c1\u6027</li> <li> <p>\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027</p> </li> <li> <p>\u8d1f\u8f7d\u5747\u8861</p> </li> <li>\u5c06\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\u5206\u914d\u5230\u4e0d\u540c\u6838\u5fc3</li> <li>\u907f\u514d\u6838\u5fc3\u95f4\u8d1f\u8f7d\u4e0d\u5747\u8861</li> </ol>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#5","title":"5. \u5176\u4ed6\u786c\u4ef6\u4f18\u5316","text":""},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#51","title":"5.1 \u786c\u4ef6\u52a0\u901f\u5668","text":"<p>\u4f18\u5316\u573a\u666f\uff1a - \u89c4\u5219\u5339\u914d\u7684\u4f4d\u8fd0\u7b97 - \u6570\u636e\u6821\u9a8c\u548c\u8ba1\u7b97 - \u52a0\u5bc6/\u89e3\u5bc6\u64cd\u4f5c</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528\u786c\u4ef6\u4f4d\u64cd\u4f5c\u5355\u5143\uff08Bit Manipulation Unit\uff09 - \u4f7f\u7528\u786c\u4ef6 CRC \u8ba1\u7b97\u5355\u5143 - \u4f7f\u7528\u786c\u4ef6\u52a0\u5bc6\u5f15\u64ce</p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u7279\u5b9a\u64cd\u4f5c\u5ef6\u8fdf\u964d\u4f4e\uff1a50-80% - \u964d\u4f4e CPU \u8d1f\u8f7d</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#52","title":"5.2 \u786c\u4ef6\u5b9a\u65f6\u5668","text":"<p>\u4f18\u5316\u573a\u666f\uff1a - \u89c4\u5219\u8d85\u65f6\u68c0\u67e5 - \u65f6\u95f4\u6233\u751f\u6210 - \u5468\u671f\u6027\u4efb\u52a1\u8c03\u5ea6</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u4f7f\u7528\u786c\u4ef6\u5b9a\u65f6\u5668\u66ff\u4ee3\u8f6f\u4ef6\u5b9a\u65f6\u5668 - \u4f7f\u7528\u786c\u4ef6\u65f6\u95f4\u6233\u8ba1\u6570\u5668\uff08TSC\uff09 - \u51cf\u5c11\u8f6f\u4ef6\u5f00\u9500</p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u65f6\u95f4\u7cbe\u5ea6\u63d0\u5347 - \u964d\u4f4e CPU \u8d1f\u8f7d - \u63d0\u5347\u5b9e\u65f6\u6027</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#53","title":"5.3 \u786c\u4ef6\u4e2d\u65ad\u63a7\u5236\u5668","text":"<p>\u4f18\u5316\u573a\u666f\uff1a - \u4e8b\u4ef6\u89e6\u53d1\u4f18\u5316 - \u4e2d\u65ad\u4f18\u5148\u7ea7\u7ba1\u7406 - \u4e2d\u65ad\u5d4c\u5957\u63a7\u5236</p> <p>\u4f18\u5316\u65b9\u6848\uff1a - \u914d\u7f6e\u4e2d\u65ad\u4f18\u5148\u7ea7 - \u4f7f\u7528\u786c\u4ef6\u4e2d\u65ad\u5d4c\u5957 - \u4f18\u5316\u4e2d\u65ad\u5904\u7406\u6d41\u7a0b</p> <p>\u9884\u671f\u6536\u76ca\uff1a - \u4e2d\u65ad\u54cd\u5e94\u5ef6\u8fdf\u964d\u4f4e\uff1a10-20% - \u63d0\u5347\u7cfb\u7edf\u5b9e\u65f6\u6027</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#_3","title":"\u7efc\u5408\u4f18\u5316\u65b9\u6848","text":""},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#_4","title":"\u4f18\u5316\u4f18\u5148\u7ea7","text":"<ol> <li>\u9ad8\u4f18\u5148\u7ea7\uff08\u7acb\u5373\u5b9e\u65bd\uff09</li> <li>DMA \u4f18\u5316\uff1aobj_dict \u6570\u636e\u62f7\u8d1d</li> <li>Cache \u4f18\u5316\uff1a\u6570\u636e\u7ed3\u6784\u5bf9\u9f50</li> <li> <p>Cache \u9884\u53d6\uff1a\u70ed\u70b9\u6570\u636e\u9884\u52a0\u8f7d</p> </li> <li> <p>\u4e2d\u4f18\u5148\u7ea7\uff08\u77ed\u671f\u5b9e\u65bd\uff09</p> </li> <li>DMA \u4f18\u5316\uff1aISR \u961f\u5217\u4f20\u8f93</li> <li>Cache \u4f18\u5316\uff1aWrite-Back \u6a21\u5f0f</li> <li> <p>MPU \u4f18\u5316\uff1a\u5185\u5b58\u4fdd\u62a4</p> </li> <li> <p>\u4f4e\u4f18\u5148\u7ea7\uff08\u957f\u671f\u89c4\u5212\uff09</p> </li> <li>MMU \u4f18\u5316\uff1a\u5185\u5b58\u91cd\u6620\u5c04\uff08\u9700\u8981\u652f\u6301 MMU \u7684 MCU\uff09</li> <li>IPC \u4f18\u5316\uff1a\u591a\u6838\u901a\u4fe1\uff08\u9700\u8981\u591a\u6838 MCU\uff09</li> <li>\u786c\u4ef6\u52a0\u901f\u5668\uff1a\u7279\u5b9a\u64cd\u4f5c\u52a0\u901f</li> </ol>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#_5","title":"\u9884\u671f\u7efc\u5408\u6536\u76ca","text":"<p>\u6027\u80fd\u63d0\u5347\uff1a - \u4e8b\u4ef6\u53d1\u5e03\u5ef6\u8fdf\uff1a\u964d\u4f4e 30-50%\uff08\u4ece &lt; 10us \u964d\u81f3 &lt; 5-7us\uff09 - \u89c4\u5219\u5339\u914d\u5ef6\u8fdf\uff1a\u964d\u4f4e 20-40%\uff08\u4ece &lt; 5-8us \u964d\u81f3 &lt; 3-5us\uff09 - CPU \u8d1f\u8f7d\uff1a\u964d\u4f4e 40-60% - \u7cfb\u7edf\u541e\u5410\u91cf\uff1a\u63d0\u5347 50-100%</p> <p>\u5b9e\u65f6\u6027\u63d0\u5347\uff1a - ISR \u54cd\u5e94\u65f6\u95f4\uff1a\u964d\u4f4e 20-40% - \u8de8\u6838\u901a\u4fe1\u5ef6\u8fdf\uff1a\u964d\u4f4e 50-70%\uff08\u591a\u6838\u573a\u666f\uff09 - \u7cfb\u7edf\u786e\u5b9a\u6027\uff1a\u663e\u8457\u63d0\u5347</p>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#_6","title":"\u5b9e\u65bd\u5efa\u8bae","text":""},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#11-2","title":"\u9636\u6bb51\uff1a\u57fa\u7840\u4f18\u5316\uff081-2\u5468\uff09","text":"<ol> <li>DMA \u914d\u7f6e</li> <li>\u914d\u7f6e DMA \u901a\u9053\u7528\u4e8e obj_dict \u6570\u636e\u62f7\u8d1d</li> <li>\u5b9e\u73b0 DMA \u62bd\u8c61\u5c42</li> <li> <p>\u6d4b\u8bd5\u548c\u9a8c\u8bc1 DMA \u6027\u80fd</p> </li> <li> <p>Cache \u4f18\u5316</p> </li> <li>\u6570\u636e\u7ed3\u6784 Cache Line \u5bf9\u9f50</li> <li>\u6dfb\u52a0 Cache \u9884\u53d6\u6307\u4ee4</li> <li>\u6d4b\u8bd5 Cache \u547d\u4e2d\u7387</li> </ol>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#22-4","title":"\u9636\u6bb52\uff1a\u8fdb\u9636\u4f18\u5316\uff082-4\u5468\uff09","text":"<ol> <li>DMA \u6269\u5c55</li> <li>ISR \u961f\u5217 DMA \u4f20\u8f93</li> <li> <p>\u6279\u91cf\u6570\u636e\u4f20\u8f93\u4f18\u5316</p> </li> <li> <p>Cache \u9ad8\u7ea7\u4f18\u5316</p> </li> <li>Write-Back \u6a21\u5f0f\u914d\u7f6e</li> <li> <p>Cache \u9501\u5b9a\uff08\u5982\u679c\u652f\u6301\uff09</p> </li> <li> <p>MPU \u4fdd\u62a4</p> </li> <li>\u914d\u7f6e MPU \u4fdd\u62a4\u5173\u952e\u6570\u636e\u7ed3\u6784</li> <li>\u6d4b\u8bd5\u5185\u5b58\u4fdd\u62a4\u529f\u80fd</li> </ol>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#3","title":"\u9636\u6bb53\uff1a\u9ad8\u7ea7\u4f18\u5316\uff08\u957f\u671f\uff09","text":"<ol> <li>\u591a\u6838\u4f18\u5316\uff08\u5982\u679c\u652f\u6301\uff09</li> <li>\u5171\u4eab\u5185\u5b58\u914d\u7f6e</li> <li>\u786c\u4ef6 Mailbox \u901a\u4fe1</li> <li> <p>\u6838\u95f4\u540c\u6b65\u673a\u5236</p> </li> <li> <p>MMU \u4f18\u5316\uff08\u5982\u679c\u652f\u6301\uff09</p> </li> <li>\u5185\u5b58\u91cd\u6620\u5c04</li> <li> <p>\u865a\u62df\u5185\u5b58\u7ba1\u7406</p> </li> <li> <p>\u786c\u4ef6\u52a0\u901f</p> </li> <li>\u786c\u4ef6\u4f4d\u64cd\u4f5c\u5355\u5143</li> <li>\u786c\u4ef6 CRC \u8ba1\u7b97</li> <li>\u786c\u4ef6\u52a0\u5bc6\u5f15\u64ce</li> </ol>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#_7","title":"\u6ce8\u610f\u4e8b\u9879","text":""},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#1","title":"1. \u517c\u5bb9\u6027\u8003\u8651","text":"<ul> <li>\u5355\u6838/\u591a\u6838\u517c\u5bb9\uff1a\u4ee3\u7801\u9700\u8981\u540c\u65f6\u652f\u6301\u5355\u6838\u548c\u591a\u6838\u573a\u666f</li> <li>MMU/MPU \u517c\u5bb9\uff1a\u9700\u8981\u68c0\u6d4b\u786c\u4ef6\u652f\u6301\u60c5\u51b5</li> <li>Cache \u7b56\u7565\uff1a\u4e0d\u540c MCU \u7684 Cache \u7b56\u7565\u53ef\u80fd\u4e0d\u540c</li> </ul>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#2","title":"2. \u8c03\u8bd5\u548c\u9a8c\u8bc1","text":"<ul> <li>\u6027\u80fd\u6d4b\u8bd5\uff1a\u9700\u8981\u5efa\u7acb\u6027\u80fd\u57fa\u51c6\u6d4b\u8bd5</li> <li>\u529f\u80fd\u6d4b\u8bd5\uff1a\u786e\u4fdd\u4f18\u5316\u4e0d\u5f71\u54cd\u529f\u80fd\u6b63\u786e\u6027</li> <li>\u538b\u529b\u6d4b\u8bd5\uff1a\u9a8c\u8bc1\u4f18\u5316\u540e\u7684\u7cfb\u7edf\u7a33\u5b9a\u6027</li> </ul>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#3_1","title":"3. \u4ee3\u7801\u7ef4\u62a4","text":"<ul> <li>\u62bd\u8c61\u5c42\u8bbe\u8ba1\uff1a\u786c\u4ef6\u76f8\u5173\u4ee3\u7801\u9700\u8981\u826f\u597d\u62bd\u8c61</li> <li>\u914d\u7f6e\u9009\u9879\uff1a\u63d0\u4f9b\u7f16\u8bd1\u671f\u548c\u8fd0\u884c\u671f\u914d\u7f6e\u9009\u9879</li> <li>\u6587\u6863\u66f4\u65b0\uff1a\u66f4\u65b0\u76f8\u5173\u6587\u6863\u548c\u6ce8\u91ca</li> </ul>"},{"location":"zero_topic_core/topic_bus/mcu_hardware_optimization_analysis/#_8","title":"\u7ed3\u8bba","text":"<p>\u901a\u8fc7\u5229\u7528 MCU \u786c\u4ef6\u5916\u8bbe\uff08DMA\u3001Cache\u3001MMU\u3001IPC\u7b49\uff09\uff0c\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539 zero topic core \u6838\u5fc3\u4ee3\u7801\u7684\u524d\u63d0\u4e0b\uff0c\u663e\u8457\u63d0\u5347\u7cfb\u7edf\u6027\u80fd\u3002\u4f18\u5316\u4f18\u5148\u7ea7\u5efa\u8bae\uff1a</p> <ol> <li>DMA \u4f18\u5316\uff1a\u53ef\u884c\u6027\u9ad8\uff0c\u6536\u76ca\u660e\u663e\uff0c\u5b9e\u65bd\u96be\u5ea6\u4f4e</li> <li>Cache \u4f18\u5316\uff1a\u53ef\u884c\u6027\u9ad8\uff0c\u6536\u76ca\u660e\u663e\uff0c\u5b9e\u65bd\u96be\u5ea6\u4e2d\u7b49</li> <li>MPU \u4f18\u5316\uff1a\u53ef\u884c\u6027\u4e2d\u7b49\uff0c\u6536\u76ca\u4e2d\u7b49\uff0c\u5b9e\u65bd\u96be\u5ea6\u4e2d\u7b49</li> <li>IPC \u4f18\u5316\uff1a\u53ef\u884c\u6027\u9ad8\uff08\u591a\u6838\u573a\u666f\uff09\uff0c\u6536\u76ca\u9ad8\uff0c\u5b9e\u65bd\u96be\u5ea6\u9ad8</li> <li>MMU \u4f18\u5316\uff1a\u53ef\u884c\u6027\u4f4e\uff08\u9700\u8981\u652f\u6301 MMU \u7684 MCU\uff09\uff0c\u6536\u76ca\u9ad8\uff0c\u5b9e\u65bd\u96be\u5ea6\u9ad8</li> </ol> <p>\u5efa\u8bae\u4f18\u5148\u5b9e\u65bd DMA \u548c Cache \u4f18\u5316\uff0c\u8fd9\u4e24\u9879\u4f18\u5316\u7684\u7efc\u5408\u6536\u76ca\u6700\u660e\u663e\uff0c\u4e14\u5b9e\u65bd\u96be\u5ea6\u76f8\u5bf9\u8f83\u4f4e\u3002</p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/","title":"\u591a\u4e2aMCU\u8fd0\u884cmicroROS\u901a\u4fe1\u65b9\u6848","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_1","title":"\u6982\u8ff0","text":"<p>\u5f53\u591a\u4e2aMCU\u90fd\u8fd0\u884cmicroROS\u65f6\uff0c\u5b83\u4eec\u53ef\u4ee5\u901a\u8fc7\u591a\u79cd\u65b9\u5f0f\u8fdb\u884c\u901a\u4fe1\u3002\u672c\u6587\u6863\u4ecb\u7ecd\u5e38\u89c1\u7684\u901a\u4fe1\u67b6\u6784\u548c\u5b9e\u73b0\u65b9\u6848\u3002</p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#mcu","title":"MCU\u5185\u90e8\u7ebf\u7a0b\u95f4\u901a\u4fe1","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#microrosmcuthread","title":"\u95ee\u9898\uff1a\u53ef\u4ee5\u4f7f\u7528microROS\u505aMCU\u5185\u90e8\u5404\u4e2athread\u95f4\u7684\u901a\u4fe1\u5417\uff1f","text":"<p>\u7b80\u77ed\u56de\u7b54\uff1a\u6280\u672f\u4e0a\u53ef\u4ee5\uff0c\u4f46\u4e0d\u63a8\u8350\u3002</p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_2","title":"\u8be6\u7ec6\u5206\u6790","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#1","title":"1. \u6280\u672f\u53ef\u884c\u6027","text":"<p>microROS \u7406\u8bba\u4e0a\u53ef\u4ee5\u7528\u4e8eMCU\u5185\u90e8\u7ebf\u7a0b\u95f4\u901a\u4fe1\uff0c\u4f46\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\uff1a</p> <ul> <li>\u9700\u8981\u81ea\u5b9a\u4e49\u4f20\u8f93\u5c42\uff1amicroROS\u9ed8\u8ba4\u9700\u8981\u901a\u8fc7UDP/TCP/\u4e32\u53e3\u8fde\u63a5\u5230ROS2 Agent\u3002\u8981\u5b9e\u73b0MCU\u5185\u90e8\u901a\u4fe1\uff0c\u9700\u8981\u5b9e\u73b0\u4e00\u4e2a\"\u5185\u5b58\u4f20\u8f93\u5c42\"\u6216\"\u865a\u62df\u4f20\u8f93\u5c42\"\uff0c\u5c06ROS2\u6d88\u606f\u76f4\u63a5\u4f20\u9012\u7ed9\u540c\u4e00MCU\u5185\u7684\u5176\u4ed6\u7ebf\u7a0b\u3002</li> <li>\u9700\u8981Agent\u6216\u81ea\u5b9a\u4e49DDS\u5b9e\u73b0\uff1aROS2\u4f7f\u7528DDS\u8fdb\u884c\u670d\u52a1\u53d1\u73b0\u548c\u6d88\u606f\u8def\u7531\u3002\u5728MCU\u5185\u90e8\uff0c\u8981\u4e48\uff1a</li> <li>\u8fd0\u884c\u4e00\u4e2a\u8f7b\u91cf\u7ea7Agent\uff08\u5185\u5b58\u4e2d\uff09</li> <li>\u5b9e\u73b0\u7b80\u5316\u7248\u7684DDS\u53d1\u73b0\u673a\u5236</li> <li>\u4f7f\u7528\u9759\u6001\u914d\u7f6e\u7ed5\u8fc7\u670d\u52a1\u53d1\u73b0</li> </ul>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#2","title":"2. \u4e3a\u4ec0\u4e48\u4e0d\u63a8\u8350\uff1f","text":"<p>\u6027\u80fd\u95ee\u9898\uff1a - \u5f00\u9500\u5927\uff1amicroROS\u7684\u6d88\u606f\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u3001DDS\u534f\u8bae\u6808\u3001QoS\u7ba1\u7406\u7b49\u5f00\u9500\u5bf9\u4e8eMCU\u5185\u90e8\u901a\u4fe1\u6765\u8bf4\u8fc7\u5927 - \u5ef6\u8fdf\u9ad8\uff1a\u5373\u4f7f\u4f7f\u7528\u5185\u5b58\u4f20\u8f93\uff0cROS2\u7684\u6d88\u606f\u5904\u7406\u6d41\u7a0b\u4ecd\u7136\u6bd4\u76f4\u63a5\u7684\u6d88\u606f\u961f\u5217\u6162\u5f97\u591a - \u5185\u5b58\u5360\u7528\uff1amicroROS\u9700\u8981\u8f83\u591a\u5185\u5b58\uff08\u901a\u5e38&gt;50KB\uff09\uff0c\u5728\u8d44\u6e90\u53d7\u9650\u7684MCU\u4e0a\u53ef\u80fd\u9020\u6210\u95ee\u9898</p> <p>\u590d\u6742\u5ea6\u95ee\u9898\uff1a - \u5b9e\u73b0\u590d\u6742\uff1a\u9700\u8981\u5b9e\u73b0\u81ea\u5b9a\u4e49\u4f20\u8f93\u5c42\uff0c\u76f8\u5f53\u4e8e\u91cd\u65b0\u5b9e\u73b0microROS\u7684\u6838\u5fc3\u90e8\u5206 - \u8c03\u8bd5\u56f0\u96be\uff1a\u5185\u90e8\u901a\u4fe1\u4f7f\u7528ROS2\u5de5\u5177\u94fe\u8c03\u8bd5\u4e0d\u5982\u76f4\u63a5\u7684\u6d88\u606f\u961f\u5217\u76f4\u89c2 - \u7ef4\u62a4\u6210\u672c\u9ad8\uff1a\u589e\u52a0\u4e86\u7cfb\u7edf\u590d\u6742\u5ea6\uff0c\u7ef4\u62a4\u6210\u672c\u4e0a\u5347</p> <p>\u8bbe\u8ba1\u7406\u5ff5\u4e0d\u7b26\uff1a - microROS\u8bbe\u8ba1\u76ee\u6807\u662f\u8de8\u8bbe\u5907\u901a\u4fe1\u548c\u4e0eROS2\u751f\u6001\u7cfb\u7edf\u96c6\u6210 - MCU\u5185\u90e8\u7ebf\u7a0b\u901a\u4fe1\u5c5e\u4e8e\u8fdb\u7a0b\u5185\u901a\u4fe1\uff08IPC\uff09\uff0c\u66f4\u9002\u5408\u4f7f\u7528\u8f7b\u91cf\u7ea7\u673a\u5236</p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#3","title":"3. \u63a8\u8350\u7684\u66ff\u4ee3\u65b9\u6848","text":"<p>\u65b9\u6848A\uff1a\u4f7f\u7528\u73b0\u6709\u7684VFB\u7cfb\u7edf\uff08\u63a8\u8350\uff09</p> <p>\u60a8\u7684\u9879\u76ee\u5df2\u7ecf\u5b9e\u73b0\u4e86VFB\uff08Virtual Function Bus\uff09\u7cfb\u7edf\uff0c\u8fd9\u662f\u4e13\u95e8\u4e3aMCU\u5185\u90e8\u7ebf\u7a0b\u901a\u4fe1\u8bbe\u8ba1\u7684\uff1a</p> <pre><code>// VFB\u7684\u4f18\u52bf\uff1a\n// 1. \u8f7b\u91cf\u7ea7\uff0c\u5f00\u9500\u5c0f\n// 2. \u57fa\u4e8eFreeRTOS\u961f\u5217\uff0c\u9ad8\u6548\u53ef\u9760\n// 3. \u652f\u6301\u4e8b\u4ef6\u9a71\u52a8\u548c\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\n// 4. \u5df2\u7ecf\u5728\u9879\u76ee\u4e2d\u4f7f\u7528\uff0c\u6210\u719f\u7a33\u5b9a\n\n// \u793a\u4f8b\uff1a\u7ebf\u7a0bA\u53d1\u5e03\u4e8b\u4ef6\nvfb_send(SensorDataEvent, sensor_value, data_buffer, data_len);\n\n// \u7ebf\u7a0bB\u8ba2\u9605\u5e76\u63a5\u6536\nvoid thread_b_callback(void *msg) {\n    vfb_message_t msg = (vfb_message_t)msg;\n    // \u5904\u7406\u6d88\u606f...\n}\n</code></pre> <p>\u65b9\u6848B\uff1a\u4f7f\u7528FreeRTOS\u961f\u5217</p> <p>\u5bf9\u4e8e\u7b80\u5355\u7684\u70b9\u5bf9\u70b9\u901a\u4fe1\uff0c\u76f4\u63a5\u4f7f\u7528FreeRTOS\u961f\u5217\uff1a</p> <pre><code>// \u521b\u5efa\u961f\u5217\nQueueHandle_t xQueue = xQueueCreate(10, sizeof(MyMessage));\n\n// \u7ebf\u7a0bA\u53d1\u9001\nMyMessage msg;\nxQueueSend(xQueue, &amp;msg, portMAX_DELAY);\n\n// \u7ebf\u7a0bB\u63a5\u6536\nMyMessage received_msg;\nxQueueReceive(xQueue, &amp;received_msg, portMAX_DELAY);\n</code></pre> <p>\u65b9\u6848C\uff1a\u6df7\u5408\u67b6\u6784\uff08\u63a8\u8350\u7528\u4e8e\u9700\u8981\u5916\u90e8\u901a\u4fe1\u7684\u573a\u666f\uff09</p> <ul> <li>MCU\u5185\u90e8\uff1a\u4f7f\u7528VFB\u6216FreeRTOS\u961f\u5217\uff08\u9ad8\u6548\u3001\u4f4e\u5ef6\u8fdf\uff09</li> <li>\u8de8MCU\u901a\u4fe1\uff1a\u4f7f\u7528microROS\uff08\u6807\u51c6\u3001\u53ef\u6269\u5c55\uff09</li> <li>\u6865\u63a5\u5c42\uff1a\u5728VFB\u548cmicroROS\u4e4b\u95f4\u5efa\u7acb\u6865\u63a5</li> </ul> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 MCU\u5185\u90e8                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  VFB     \u2502\u25c4\u2500\u25ba\u2502 microROS   \u2502  \u2502\n\u2502  \u2502(\u7ebf\u7a0b\u95f4)  \u2502   \u2502(\u8de8\u8bbe\u5907)    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                    ROS2 Network\n</code></pre> <p>\u8fd9\u79cd\u67b6\u6784\u65e2\u4fdd\u8bc1\u4e86\u5185\u90e8\u901a\u4fe1\u7684\u9ad8\u6548\u6027\uff0c\u53c8\u63d0\u4f9b\u4e86\u6807\u51c6\u7684\u5916\u90e8\u901a\u4fe1\u63a5\u53e3\u3002</p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#4-microros","title":"4. \u5982\u679c\u786e\u5b9e\u9700\u8981\u4f7f\u7528microROS\u5185\u90e8\u901a\u4fe1","text":"<p>\u5982\u679c\u60a8\u7684\u573a\u666f\u786e\u5b9e\u9700\u8981\uff08\u4f8b\u5982\uff1a\u9700\u8981\u4e0eROS2\u751f\u6001\u7cfb\u7edf\u5b8c\u5168\u517c\u5bb9\u3001\u9700\u8981\u52a8\u6001\u670d\u52a1\u53d1\u73b0\u7b49\uff09\uff0c\u53ef\u4ee5\u8003\u8651\u4ee5\u4e0b\u5b9e\u73b0\uff1a</p> <p>\u5b9e\u73b0\u601d\u8def\uff1a</p> <pre><code>// 1. \u5b9e\u73b0\u5185\u5b58\u4f20\u8f93\u5c42\ntypedef struct {\n    uint8_t* buffer;\n    size_t size;\n} memory_transport_t;\n\n// 2. \u521b\u5efa\u5185\u5b58\u4e2d\u7684Agent\u6216\u7b80\u5316DDS\u5b9e\u73b0\n// 3. \u914d\u7f6emicroROS\u4f7f\u7528\u5185\u5b58\u4f20\u8f93\u5c42\nrmw_uros_options_t options;\noptions.transport = RMW_UXRCE_TRANSPORT_MEMORY;  // \u5047\u8bbe\u652f\u6301\noptions.memory_buffer = &amp;mem_buffer;\n\n// 4. \u5728\u5355\u4e2aMCU\u5185\u8fd0\u884c\u591a\u4e2amicroROS\u8282\u70b9\nrclc_node_init_default(&amp;node1, \"internal_node1\", \"\", &amp;context);\nrclc_node_init_default(&amp;node2, \"internal_node2\", \"\", &amp;context);\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879\uff1a - \u9700\u8981\u4fee\u6539microROS\u6e90\u7801\u6216\u5b9e\u73b0\u81ea\u5b9a\u4e49\u4f20\u8f93\u5c42 - \u6027\u80fd\u4ecd\u7136\u4e0d\u5982\u76f4\u63a5\u7684\u6d88\u606f\u961f\u5217 - \u53ef\u80fd\u9700\u8981\u66f4\u591a\u5185\u5b58\u548cCPU\u8d44\u6e90</p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_3","title":"\u603b\u7ed3","text":"\u901a\u4fe1\u573a\u666f \u63a8\u8350\u65b9\u6848 \u539f\u56e0 MCU\u5185\u90e8\u7ebf\u7a0b\u901a\u4fe1 VFB\u7cfb\u7edf\u6216FreeRTOS\u961f\u5217 \u9ad8\u6548\u3001\u4f4e\u5ef6\u8fdf\u3001\u4f4e\u5f00\u9500 \u8de8MCU\u901a\u4fe1 microROS \u6807\u51c6\u3001\u53ef\u6269\u5c55\u3001\u4e0eROS2\u517c\u5bb9 \u6df7\u5408\u573a\u666f VFB + microROS\u6865\u63a5 \u517c\u987e\u5185\u90e8\u6548\u7387\u548c\u5916\u90e8\u517c\u5bb9\u6027 <p>\u7ed3\u8bba\uff1a \u5bf9\u4e8eMCU\u5185\u90e8\u7ebf\u7a0b\u901a\u4fe1\uff0c\u4f18\u5148\u4f7f\u7528VFB\u6216FreeRTOS\u961f\u5217\uff1bmicroROS\u66f4\u9002\u5408\u8de8\u8bbe\u5907\u901a\u4fe1\u573a\u666f\u3002</p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_4","title":"\u901a\u4fe1\u67b6\u6784","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#1ros2-agent","title":"\u67b6\u67841\uff1a\u901a\u8fc7ROS2 Agent\u96c6\u4e2d\u901a\u4fe1\uff08\u63a8\u8350\uff09","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 MCU1    \u2502         \u2502 MCU2    \u2502         \u2502 MCU3    \u2502\n\u2502microROS \u2502         \u2502microROS \u2502         \u2502microROS \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n     \u2502                  \u2502                  \u2502\n     \u2502   UDP/TCP        \u2502   UDP/TCP        \u2502   UDP/TCP\n     \u2502   \u6216\u4e32\u53e3          \u2502   \u6216\u4e32\u53e3          \u2502   \u6216\u4e32\u53e3\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502                   \u2502\n              \u2502   ROS2 DDS        \u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502   ROS2 Agent      \u2502\n              \u2502  (Linux/PC)       \u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u5de5\u4f5c\u539f\u7406\uff1a - \u6bcf\u4e2aMCU\u901a\u8fc7microROS\u8fde\u63a5\u5230\u540c\u4e00\u4e2aROS2 Agent - Agent\u8d1f\u8d23DDS\u53d1\u73b0\u548c\u6d88\u606f\u8def\u7531 - \u6240\u6709MCU\u53ef\u4ee5\u4e92\u76f8\u53d1\u5e03/\u8ba2\u9605Topic\uff0c\u8c03\u7528\u670d\u52a1</p> <p>\u4f18\u70b9\uff1a - \u6807\u51c6ROS2\u901a\u4fe1\u65b9\u5f0f - \u652f\u6301\u591a\u5bf9\u591a\u901a\u4fe1 - \u6613\u4e8e\u8c03\u8bd5\u548c\u76d1\u63a7 - \u53ef\u4ee5\u4e0e\u6807\u51c6ROS2\u8282\u70b9\u901a\u4fe1</p> <p>\u7f3a\u70b9\uff1a - \u9700\u8981Agent\u4f5c\u4e3a\u4e2d\u95f4\u4ef6 - \u589e\u52a0\u7f51\u7edc\u5ef6\u8fdf\uff08\u5982\u679c\u4f7f\u7528\u7f51\u7edc\u4f20\u8f93\uff09</p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#2_1","title":"\u67b6\u67842\uff1a\u70b9\u5bf9\u70b9\u76f4\u63a5\u901a\u4fe1","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 MCU1    \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502 MCU2    \u2502\n\u2502microROS \u2502  UART/  \u2502microROS \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  CAN/   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              SPI\n</code></pre> <p>\u5de5\u4f5c\u539f\u7406\uff1a - MCU\u4e4b\u95f4\u76f4\u63a5\u901a\u8fc7\u7269\u7406\u63a5\u53e3\u901a\u4fe1 - \u9700\u8981\u81ea\u5b9a\u4e49\u534f\u8bae\u5c01\u88c5ROS2\u6d88\u606f - \u6216\u8005\u4f7f\u7528topic_bus\u4f5c\u4e3a\u4e2d\u95f4\u5c42</p> <p>\u4f18\u70b9\uff1a - \u65e0\u9700Agent - \u4f4e\u5ef6\u8fdf - \u9002\u5408\u56fa\u5b9a\u62d3\u6251</p> <p>\u7f3a\u70b9\uff1a - \u9700\u8981\u81ea\u5b9a\u4e49\u534f\u8bae - \u6269\u5c55\u6027\u5dee - \u8c03\u8bd5\u56f0\u96be</p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#3topic_bus-microros","title":"\u67b6\u67843\uff1a\u6df7\u5408\u67b6\u6784\uff08topic_bus + microROS\uff09","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 MCU1 (\u5185\u90e8)                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502topic_bus \u2502\u25c4\u2500\u25ba\u2502 microROS   \u2502  \u2502\n\u2502  \u2502          \u2502   \u2502  Bridge    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                    ROS2 Network\n                          \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 MCU2 (\u5185\u90e8)             \u2502        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502topic_bus \u2502\u25c4\u2500\u25ba\u2502 microROS   \u2502  \u2502\n\u2502  \u2502          \u2502   \u2502  Bridge    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u5de5\u4f5c\u539f\u7406\uff1a - MCU\u5185\u90e8\u4f7f\u7528topic_bus\u8fdb\u884c\u4e8b\u4ef6\u9a71\u52a8\u901a\u4fe1 - topic_bus\u4e0emicroROS\u901a\u8fc7\u6865\u63a5\u5c42\u8fde\u63a5 - \u5916\u90e8\u901a\u4fe1\u901a\u8fc7microROS\u548cAgent</p> <p>\u4f18\u70b9\uff1a - \u7ed3\u5408\u4e24\u8005\u4f18\u52bf - \u5185\u90e8\u901a\u4fe1\u9ad8\u6548\uff08topic_bus\uff09 - \u5916\u90e8\u901a\u4fe1\u6807\u51c6\uff08microROS\uff09</p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_5","title":"\u5b9e\u73b0\u65b9\u6848","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#1ros2-agent_1","title":"\u65b9\u68481\uff1a\u901a\u8fc7ROS2 Agent\u901a\u4fe1\uff08\u63a8\u8350\uff09","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#11-mcuagent","title":"1.1 \u914d\u7f6e\u6bcf\u4e2aMCU\u8fde\u63a5Agent","text":"<p>MCU1\u914d\u7f6e\uff1a <pre><code>#include &lt;rcl/rcl.h&gt;\n#include &lt;rclc/rclc.h&gt;\n#include &lt;rmw_microxrcedds_c/rmw_microxrcedds_c.h&gt;\n\n// \u914d\u7f6e\u4f20\u8f93\u5c42\uff08UDP\uff09\nrmw_uros_options_t options;\noptions.transport = RMW_UXRCE_TRANSPORT_UDP;\noptions.agent_address = \"192.168.1.100\";  // Agent IP\u5730\u5740\noptions.agent_port = 8888;                 // Agent\u7aef\u53e3\n\n// \u521d\u59cb\u5316microROS\nrcl_context_t context;\nrcl_init(0, NULL, &amp;context);\n\nrcl_node_t node;\nrclc_node_init_default(&amp;node, \"mcu1_node\", \"\", &amp;context);\n</code></pre></p> <p>MCU2\u914d\u7f6e\uff1a <pre><code>// \u540c\u6837\u7684\u914d\u7f6e\uff0c\u4f46\u8282\u70b9\u540d\u4e0d\u540c\nrclc_node_init_default(&amp;node, \"mcu2_node\", \"\", &amp;context);\n</code></pre></p> <p>MCU3\u914d\u7f6e\uff1a <pre><code>rclc_node_init_default(&amp;node, \"mcu3_node\", \"\", &amp;context);\n</code></pre></p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#12-topic","title":"1.2 \u53d1\u5e03/\u8ba2\u9605Topic","text":"<p>MCU1\u53d1\u5e03\u6570\u636e\uff1a <pre><code>// MCU1\u4e2d\nrcl_publisher_t publisher;\nstd_msgs__msg__Int32 msg;\n\nvoid mcu1_init(void) {\n    const rosidl_message_type_support_t * ts = \n        ROSIDL_GET_MSG_TYPE_SUPPORT(std_msgs, msg, Int32);\n    rclc_publisher_init_default(&amp;publisher, &amp;node, ts, \"mcu1_sensor_data\");\n    msg.data = 0;\n}\n\nvoid mcu1_publish(void) {\n    msg.data++;\n    rcl_publish(&amp;publisher, &amp;msg, NULL);\n}\n</code></pre></p> <p>MCU2\u8ba2\u9605MCU1\u7684\u6570\u636e\uff1a <pre><code>// MCU2\u4e2d\nrcl_subscription_t subscription;\nstd_msgs__msg__Int32 received_msg;\n\nvoid mcu2_subscription_callback(const void * msgin) {\n    const std_msgs__msg__Int32 * msg = (const std_msgs__msg__Int32 *)msgin;\n    printf(\"MCU2 received from MCU1: %d\\n\", msg-&gt;data);\n}\n\nvoid mcu2_init(void) {\n    const rosidl_message_type_support_t * ts = \n        ROSIDL_GET_MSG_TYPE_SUPPORT(std_msgs, msg, Int32);\n    rclc_subscription_init_default(&amp;subscription, &amp;node, ts, \"mcu1_sensor_data\");\n\n    rclc_executor_t executor;\n    rclc_executor_init(&amp;executor, &amp;context, 1, NULL);\n    rclc_executor_add_subscription(\n        &amp;executor, &amp;subscription, &amp;received_msg,\n        &amp;mcu2_subscription_callback, ON_NEW_DATA\n    );\n}\n</code></pre></p> <p>MCU3\u8ba2\u9605MCU1\u7684\u6570\u636e\uff1a <pre><code>// MCU3\u4e2d\uff08\u7c7b\u4f3cMCU2\uff09\nrclc_subscription_init_default(&amp;subscription, &amp;node, ts, \"mcu1_sensor_data\");\n</code></pre></p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#13-ros2-agent","title":"1.3 \u542f\u52a8ROS2 Agent","text":"<p>\u5728Linux PC\u4e0a\u542f\u52a8Agent\uff1a <pre><code># \u5b89\u88c5microROS Agent\nsudo apt install ros-humble-micro-ros-agent\n\n# \u542f\u52a8Agent\uff08UDP\u6a21\u5f0f\uff09\nros2 run micro_ros_agent micro_ros_agent udp4 --port 8888\n\n# \u6216\u4e32\u53e3\u6a21\u5f0f\nros2 run micro_ros_agent micro_ros_agent serial --dev /dev/ttyUSB0\n</code></pre></p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#2uartspican","title":"\u65b9\u68482\uff1a\u70b9\u5bf9\u70b9\u901a\u4fe1\uff08UART/SPI/CAN\uff09","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#21","title":"2.1 \u81ea\u5b9a\u4e49\u534f\u8bae\u5c01\u88c5","text":"<p>\u5982\u679cMCU\u4e4b\u95f4\u76f4\u63a5\u901a\u4fe1\uff0c\u9700\u8981\u81ea\u5b9a\u4e49\u534f\u8bae\uff1a</p> <pre><code>// \u6d88\u606f\u5e27\u7ed3\u6784\ntypedef struct {\n    uint8_t start_flag;      // 0xAA\n    uint16_t topic_id;       // Topic ID\n    uint16_t data_len;        // \u6570\u636e\u957f\u5ea6\n    uint8_t data[256];        // \u6570\u636e\u5185\u5bb9\n    uint8_t checksum;         // \u6821\u9a8c\u548c\n} microros_frame_t;\n\n// \u53d1\u9001\u51fd\u6570\nvoid send_to_peer_mcu(uint16_t topic_id, const void* data, size_t len) {\n    microros_frame_t frame;\n    frame.start_flag = 0xAA;\n    frame.topic_id = topic_id;\n    frame.data_len = len;\n    memcpy(frame.data, data, len);\n    frame.checksum = calculate_checksum(&amp;frame);\n\n    // \u901a\u8fc7UART\u53d1\u9001\n    uart_send((uint8_t*)&amp;frame, sizeof(frame));\n}\n</code></pre>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#22","title":"2.2 \u63a5\u6536\u548c\u8def\u7531","text":"<pre><code>void receive_from_peer_mcu(void) {\n    microros_frame_t frame;\n    if (uart_receive((uint8_t*)&amp;frame, sizeof(frame))) {\n        // \u9a8c\u8bc1\u5e27\n        if (frame.start_flag == 0xAA &amp;&amp; \n            verify_checksum(&amp;frame)) {\n            // \u8def\u7531\u5230microROS\n            route_to_microros(frame.topic_id, frame.data, frame.data_len);\n        }\n    }\n}\n</code></pre>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#3topic_bus-microros_1","title":"\u65b9\u68483\uff1atopic_bus + microROS\u6865\u63a5","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#31","title":"3.1 \u6865\u63a5\u5c42\u5b9e\u73b0","text":"<pre><code>// topic_bus_microros_bridge.c\n#include \"topic_bus.h\"\n#include \"rcl/rcl.h\"\n\n// Topic ID\u5230ROS Topic\u540d\u79f0\u7684\u6620\u5c04\ntypedef struct {\n    uint16_t topic_id;\n    const char* ros_topic_name;\n    const rosidl_message_type_support_t* type_support;\n} topic_mapping_t;\n\nstatic topic_mapping_t topic_map[] = {\n    {1, \"mcu1_sensor_data\", ROSIDL_GET_MSG_TYPE_SUPPORT(std_msgs, msg, Int32)},\n    {2, \"mcu2_sensor_data\", ROSIDL_GET_MSG_TYPE_SUPPORT(std_msgs, msg, Int32)},\n    // ... \u66f4\u591a\u6620\u5c04\n};\n\n// Topic Bus\u56de\u8c03\uff1a\u53d1\u5e03\u5230microROS\nvoid topic_bus_to_microros_callback(uint16_t topic_id, const void* data, \n                                     size_t len, void* user_data) {\n    // \u67e5\u627e\u6620\u5c04\n    for (size_t i = 0; i &lt; sizeof(topic_map)/sizeof(topic_map[0]); i++) {\n        if (topic_map[i].topic_id == topic_id) {\n            // \u53d1\u5e03\u5230microROS\n            rcl_publisher_t* pub = (rcl_publisher_t*)user_data;\n            rcl_publish(pub, data, NULL);\n            break;\n        }\n    }\n}\n\n// microROS\u56de\u8c03\uff1a\u53d1\u5e03\u5230Topic Bus\nvoid microros_to_topic_bus_callback(const void* msgin) {\n    // \u4ecemicroROS\u63a5\u6536\u6d88\u606f\n    // \u8f6c\u6362\u4e3aTopic Bus\u4e8b\u4ef6\n    topic_publish_event(&amp;bus, topic_id);\n}\n</code></pre>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#32","title":"3.2 \u521d\u59cb\u5316\u6865\u63a5","text":"<pre><code>void init_bridge(topic_bus_t* bus, rcl_node_t* node) {\n    // \u4e3a\u6bcf\u4e2aTopic\u521b\u5efaPublisher\n    for (size_t i = 0; i &lt; sizeof(topic_map)/sizeof(topic_map[0]); i++) {\n        rcl_publisher_t publisher;\n        rclc_publisher_init_default(\n            &amp;publisher, node, \n            topic_map[i].type_support,\n            topic_map[i].ros_topic_name\n        );\n\n        // \u8ba2\u9605Topic Bus\n        topic_subscribe(bus, topic_map[i].topic_id,\n                       topic_bus_to_microros_callback,\n                       &amp;publisher);\n    }\n}\n</code></pre>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_6","title":"\u7f51\u7edc\u914d\u7f6e","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#udpip","title":"\u4f7f\u7528UDP/IP\u901a\u4fe1","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#mcu_1","title":"MCU\u7aef\u914d\u7f6e","text":"<pre><code>// \u914d\u7f6eUDP\u4f20\u8f93\nrmw_uros_options_t options;\noptions.transport = RMW_UXRCE_TRANSPORT_UDP;\noptions.agent_address = \"192.168.1.100\";  // Agent IP\noptions.agent_port = 8888;\n</code></pre>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#agent","title":"Agent\u7aef\u542f\u52a8","text":"<pre><code>ros2 run micro_ros_agent micro_ros_agent udp4 --port 8888\n</code></pre>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#tcpip","title":"\u4f7f\u7528TCP/IP\u901a\u4fe1","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#mcu_2","title":"MCU\u7aef\u914d\u7f6e","text":"<pre><code>options.transport = RMW_UXRCE_TRANSPORT_TCP;\noptions.agent_address = \"192.168.1.100\";\noptions.agent_port = 8888;\n</code></pre>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#agent_1","title":"Agent\u7aef\u542f\u52a8","text":"<pre><code>ros2 run micro_ros_agent micro_ros_agent tcp4 --port 8888\n</code></pre>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_7","title":"\u4f7f\u7528\u4e32\u53e3\u901a\u4fe1","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#mcu_3","title":"MCU\u7aef\u914d\u7f6e","text":"<pre><code>options.transport = RMW_UXRCE_TRANSPORT_SERIAL;\noptions.device = \"/dev/ttyUSB0\";\noptions.baudrate = 115200;\n</code></pre>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#agent_2","title":"Agent\u7aef\u542f\u52a8","text":"<pre><code>ros2 run micro_ros_agent micro_ros_agent serial --dev /dev/ttyUSB0 -b 115200\n</code></pre>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#mcu_4","title":"\u591aMCU\u901a\u4fe1\u793a\u4f8b","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#mcu1mcu2mcu3","title":"\u793a\u4f8b\uff1aMCU1\u53d1\u5e03\uff0cMCU2\u548cMCU3\u8ba2\u9605","text":"<p>MCU1\u4ee3\u7801\uff1a <pre><code>#include &lt;rcl/rcl.h&gt;\n#include &lt;rclc/rclc.h&gt;\n#include &lt;std_msgs/msg/int32.h&gt;\n\nrcl_node_t node;\nrcl_publisher_t publisher;\nstd_msgs__msg__Int32 msg;\nrcl_context_t context;\n\nvoid mcu1_init(void) {\n    // \u521d\u59cb\u5316microROS\n    rcl_init(0, NULL, &amp;context);\n    rclc_node_init_default(&amp;node, \"mcu1_node\", \"\", &amp;context);\n\n    // \u521b\u5efaPublisher\n    const rosidl_message_type_support_t * ts = \n        ROSIDL_GET_MSG_TYPE_SUPPORT(std_msgs, msg, Int32);\n    rclc_publisher_init_default(&amp;publisher, &amp;node, ts, \"sensor_data\");\n\n    msg.data = 0;\n}\n\nvoid mcu1_loop(void) {\n    // \u53d1\u5e03\u6570\u636e\n    msg.data++;\n    rcl_publish(&amp;publisher, &amp;msg, NULL);\n    rclc_sleep_ms(1000);  // \u6bcf\u79d2\u53d1\u5e03\u4e00\u6b21\n}\n</code></pre></p> <p>MCU2\u4ee3\u7801\uff1a <pre><code>rcl_node_t node;\nrcl_subscription_t subscription;\nstd_msgs__msg__Int32 received_msg;\nrclc_executor_t executor;\nrcl_context_t context;\n\nvoid mcu2_subscription_callback(const void * msgin) {\n    const std_msgs__msg__Int32 * msg = (const std_msgs__msg__Int32 *)msgin;\n    printf(\"MCU2: Received %d\\n\", msg-&gt;data);\n    // \u5904\u7406\u6570\u636e...\n}\n\nvoid mcu2_init(void) {\n    rcl_init(0, NULL, &amp;context);\n    rclc_node_init_default(&amp;node, \"mcu2_node\", \"\", &amp;context);\n\n    // \u521b\u5efaSubscription\n    const rosidl_message_type_support_t * ts = \n        ROSIDL_GET_MSG_TYPE_SUPPORT(std_msgs, msg, Int32);\n    rclc_subscription_init_default(&amp;subscription, &amp;node, ts, \"sensor_data\");\n\n    // \u6dfb\u52a0\u5230\u6267\u884c\u5668\n    rclc_executor_init(&amp;executor, &amp;context, 1, NULL);\n    rclc_executor_add_subscription(\n        &amp;executor, &amp;subscription, &amp;received_msg,\n        &amp;mcu2_subscription_callback, ON_NEW_DATA\n    );\n}\n\nvoid mcu2_loop(void) {\n    rclc_executor_spin_some(&amp;executor, RCL_MS_TO_NS(100));\n}\n</code></pre></p> <p>MCU3\u4ee3\u7801\uff1a <pre><code>// \u4e0eMCU2\u7c7b\u4f3c\uff0c\u53ea\u9700\u4fee\u6539\u8282\u70b9\u540d\nrclc_node_init_default(&amp;node, \"mcu3_node\", \"\", &amp;context);\n</code></pre></p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_8","title":"\u8c03\u8bd5\u548c\u76d1\u63a7","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_9","title":"\u67e5\u770b\u8fde\u63a5\u72b6\u6001","text":"<p>\u5728Agent\u7aef\u8fd0\u884c\uff1a <pre><code># \u67e5\u770b\u6240\u6709\u8fde\u63a5\u7684\u8282\u70b9\nros2 node list\n\n# \u67e5\u770b\u6240\u6709Topic\nros2 topic list\n\n# \u67e5\u770bTopic\u6570\u636e\nros2 topic echo /sensor_data\n\n# \u67e5\u770bTopic\u4fe1\u606f\nros2 topic info /sensor_data\n</code></pre></p>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#mcu_5","title":"MCU\u7aef\u8c03\u8bd5","text":"<pre><code>// \u68c0\u67e5\u8fde\u63a5\u72b6\u6001\nrmw_ret_t ret = rmw_uros_ping_agent(1000);  // 1\u79d2\u8d85\u65f6\nif (ret != RMW_RET_OK) {\n    printf(\"Agent not connected!\\n\");\n}\n</code></pre>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_10","title":"\u6027\u80fd\u4f18\u5316","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#1_1","title":"1. \u51cf\u5c11\u6d88\u606f\u5927\u5c0f","text":"<ul> <li>\u4f7f\u7528\u7d27\u51d1\u7684\u6d88\u606f\u7c7b\u578b</li> <li>\u907f\u514d\u53d1\u9001\u4e0d\u5fc5\u8981\u7684\u6570\u636e</li> </ul>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#2-qos","title":"2. \u8c03\u6574QoS","text":"<pre><code>rcl_publisher_options_t pub_options = rcl_publisher_get_default_options();\npub_options.qos.reliability = RMW_QOS_POLICY_RELIABILITY_BEST_EFFORT;\npub_options.qos.durability = RMW_QOS_POLICY_DURABILITY_VOLATILE;\nrclc_publisher_init(&amp;publisher, &amp;node, ts, \"topic\", &amp;pub_options);\n</code></pre>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#3_1","title":"3. \u6279\u91cf\u5904\u7406","text":"<ul> <li>\u4f7f\u7528\u6d88\u606f\u6570\u7ec4\u6279\u91cf\u53d1\u9001</li> <li>\u51cf\u5c11\u7f51\u7edc\u5f00\u9500</li> </ul>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_11","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u8282\u70b9\u547d\u540d\u552f\u4e00\u6027\uff1a\u786e\u4fdd\u6bcf\u4e2aMCU\u7684\u8282\u70b9\u540d\u79f0\u552f\u4e00</li> <li>Topic\u547d\u540d\u89c4\u8303\uff1a\u4f7f\u7528\u6e05\u6670\u7684Topic\u547d\u540d\uff0c\u4fbf\u4e8e\u8bc6\u522b\u6765\u6e90</li> <li>\u7f51\u7edc\u914d\u7f6e\uff1a\u786e\u4fdd\u6240\u6709MCU\u548cAgent\u5728\u540c\u4e00\u7f51\u7edc</li> <li>\u65f6\u95f4\u540c\u6b65\uff1a\u8003\u8651\u4f7f\u7528NTP\u6216ROS2\u65f6\u95f4\u540c\u6b65</li> <li>\u9519\u8bef\u5904\u7406\uff1a\u5b9e\u73b0\u8fde\u63a5\u91cd\u8bd5\u548c\u9519\u8bef\u6062\u590d\u673a\u5236</li> <li>\u8d44\u6e90\u9650\u5236\uff1a\u6ce8\u610fMCU\u5185\u5b58\u548c\u8ba1\u7b97\u8d44\u6e90\u9650\u5236</li> </ol>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_12","title":"\u603b\u7ed3","text":""},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_13","title":"\u63a8\u8350\u65b9\u6848","text":"<ol> <li>\u6807\u51c6\u573a\u666f\uff1a\u4f7f\u7528\u65b9\u68481\uff08\u901a\u8fc7ROS2 Agent\uff09\uff0c\u7b80\u5355\u53ef\u9760</li> <li>\u9ad8\u6027\u80fd\u573a\u666f\uff1a\u4f7f\u7528\u65b9\u68483\uff08topic_bus + microROS\uff09\uff0c\u5185\u90e8\u9ad8\u6548\uff0c\u5916\u90e8\u6807\u51c6</li> <li>\u7279\u6b8a\u573a\u666f\uff1a\u4f7f\u7528\u65b9\u68482\uff08\u70b9\u5bf9\u70b9\uff09\uff0c\u9002\u5408\u56fa\u5b9a\u62d3\u6251</li> </ol>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_14","title":"\u9009\u62e9\u4f9d\u636e","text":"<ul> <li>\u6709Agent\uff1a\u4f7f\u7528\u65b9\u68481\u62163</li> <li>\u65e0Agent\u4f46\u9700\u8981\u6807\u51c6\u901a\u4fe1\uff1a\u5b9e\u73b0\u65b9\u68482\u7684\u81ea\u5b9a\u4e49\u534f\u8bae</li> <li>\u9700\u8981\u9ad8\u6027\u80fd\u5185\u90e8\u901a\u4fe1\uff1a\u4f7f\u7528\u65b9\u68483\u7684topic_bus</li> </ul>"},{"location":"zero_topic_core/topic_bus/multi_mcu_microros_communication/#_15","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>microROS\u5b98\u65b9\u6587\u6863</li> <li>ROS2 DDS\u914d\u7f6e</li> <li>topic_bus\u6a21\u5757\u6587\u6863</li> </ul>"},{"location":"zero_topic_core/topic_bus/topic_bus/","title":"topic_bus \u6a21\u5757\u8bf4\u660e","text":""},{"location":"zero_topic_core/topic_bus/topic_bus/#_1","title":"\u6982\u8ff0","text":"<p>Topic\u603b\u7ebf\u662f\u57fa\u4e8e\u89c4\u5219\u7684\u4e8b\u4ef6\u53d1\u5e03\u8ba2\u9605\u6846\u67b6\uff0c\u7528\u4e8e\u66ff\u4ee3\u961f\u5217\u591a\u64ad\u65b9\u6848\u3002\u652f\u6301OR/AND/MANUAL\u4e09\u79cd\u89c4\u5219\u7c7b\u578b\uff0c\u91c7\u7528\u56de\u8c03\u8ba2\u9605\u673a\u5236\uff0c\u4e0e\u5bf9\u8c61\u5b57\u5178\u6df1\u5ea6\u96c6\u6210\uff0c\u63d0\u4f9b\u9ad8\u6548\u7684\u4e8b\u4ef6\u9a71\u52a8\u901a\u4fe1\u3002</p>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_2","title":"\u76ee\u5f55\u7ed3\u6784","text":"<ul> <li><code>topic_bus.h/.c</code>\uff1a\u6838\u5fc3\u5b9e\u73b0</li> <li><code>topic_rule.h/.c</code>\uff1a\u89c4\u5219\u5f15\u64ce\u5b9e\u73b0</li> <li><code>topic_bus_config.h</code>\uff1a\u7f16\u8bd1\u671f\u914d\u7f6e</li> <li><code>perf_test_topic_bus.c</code>\uff1a\u529f\u80fd\u4e0e\u6027\u80fd\u6d4b\u8bd5</li> </ul>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_3","title":"\u8bbe\u8ba1\u7406\u5ff5","text":""},{"location":"zero_topic_core/topic_bus/topic_bus/#_4","title":"\u89c4\u5219\u9a71\u52a8","text":"<ul> <li>OR\u89c4\u5219\uff1a\u4efb\u4e00\u4e8b\u4ef6\u89e6\u53d1\u5373\u53ef\u53d1\u5e03Topic</li> <li>AND\u89c4\u5219\uff1a\u5168\u90e8\u4e8b\u4ef6\u89e6\u53d1\u540e\u624d\u53d1\u5e03Topic</li> <li>MANUAL\u89c4\u5219\uff1a\u9700\u624b\u52a8\u8c03\u7528<code>topic_publish_manual</code>\u53d1\u5e03</li> </ul>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_5","title":"\u56de\u8c03\u8ba2\u9605","text":"<ul> <li>\u4f7f\u7528\u56de\u8c03\u51fd\u6570\u66ff\u4ee3\u961f\u5217\u673a\u5236\uff0c\u964d\u4f4e\u5ef6\u8fdf\u548c\u5185\u5b58\u5f00\u9500</li> <li>\u652f\u6301\u591a\u4e2a\u8ba2\u9605\u8005\u540c\u65f6\u8ba2\u9605\u540c\u4e00Topic</li> </ul>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_6","title":"\u4e0e\u5bf9\u8c61\u5b57\u5178\u96c6\u6210","text":"<ul> <li>\u53d1\u5e03\u4e8b\u4ef6\u65f6\u81ea\u52a8\u4eceobj_dict\u83b7\u53d6\u6700\u65b0\u6570\u636e</li> <li>\u56de\u8c03\u51fd\u6570\u63a5\u6536\u6570\u636e\u6307\u9488\u548c\u957f\u5ea6\uff0c\u5b9e\u73b0\u96f6\u62f7\u8d1d\u8bbf\u95ee</li> </ul>"},{"location":"zero_topic_core/topic_bus/topic_bus/#isr","title":"ISR\u5b89\u5168","text":"<ul> <li>\u652f\u6301ISR\u4e0a\u4e0b\u6587\u53d1\u5e03\u4e8b\u4ef6\uff08\u901a\u8fc7\u73af\u5f62\u961f\u5217\u7f13\u51b2\uff09</li> <li>\u4efb\u52a1\u6a21\u5f0f\u5904\u7406ISR\u961f\u5217\u4e2d\u7684\u4e8b\u4ef6</li> </ul>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_7","title":"\u914d\u7f6e","text":"<pre><code>#define TOPIC_BUS_MAX_TOPICS                  64    // \u6700\u5927Topic\u6570\u91cf\n#define TOPIC_BUS_MAX_SUBSCRIBERS_PER_TOPIC   16    // \u6bcf\u4e2aTopic\u6700\u5927\u8ba2\u9605\u8005\u6570\n#define TOPIC_BUS_ISR_QUEUE_SIZE              32    // ISR\u961f\u5217\u5bb9\u91cf\n#define TOPIC_BUS_ENABLE_STATS                1     // \u542f\u7528\u7edf\u8ba1\u4fe1\u606f\n#define TOPIC_BUS_ENABLE_ATOMICS              1     // \u542f\u7528C11\u539f\u5b50\u4f18\u5316\n#define TOPIC_BUS_ENABLE_RULES                1     // \u542f\u7528\u89c4\u5219\u652f\u6301\n#define TOPIC_BUS_ENABLE_ISR                  1     // \u542f\u7528ISR\u5b89\u5168\u8def\u5f84\n#define TOPIC_BUS_MAX_RULE_EVENTS             16    // \u6bcf\u4e2a\u89c4\u5219\u6700\u5927\u4e8b\u4ef6\u6570\n// \u53ef\u9009\u4f18\u5316/\u8bca\u65ad\n#define TOPIC_BUS_ENABLE_RULE_CACHE           1     // \u542f\u7528\u89c4\u5219\u5339\u914d\u7ed3\u679c\u7f13\u5b58\uff08\u70ed\u4e8b\u4ef6\u52a0\u901f\uff09\n#define TOPIC_BUS_ENABLE_DIAG                 1     // \u542f\u7528\u8bca\u65ad\u7edf\u8ba1\uff08\u6700\u8fd1\u89e6\u53d1\u4e8b\u4ef6/\u957f\u5ea6/\u65f6\u95f4\u6233\uff09\n</code></pre>"},{"location":"zero_topic_core/topic_bus/topic_bus/#api","title":"\u6838\u5fc3API","text":""},{"location":"zero_topic_core/topic_bus/topic_bus/#_8","title":"\u521d\u59cb\u5316\u4e0e\u7ba1\u7406","text":"<pre><code>int topic_bus_init(topic_bus_t* bus, topic_entry_t* entries, \n                   size_t max_topics, obj_dict_t* dict);\n</code></pre> <p>\u521d\u59cb\u5316Topic\u603b\u7ebf\uff0c\u9700\u8981\u63d0\u4f9bTopic\u6761\u76ee\u6570\u7ec4\u548c\u5173\u8054\u7684\u5bf9\u8c61\u5b57\u5178\u3002</p>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_9","title":"\u89c4\u5219\u7ba1\u7406","text":"<pre><code>int topic_rule_create(topic_bus_t* bus, uint16_t topic_id, const topic_rule_t* rule);\n</code></pre> <p>\u521b\u5efaTopic\u89c4\u5219\uff0c\u5b9a\u4e49\u89e6\u53d1\u6761\u4ef6\u548c\u4e8b\u4ef6\u5217\u8868\u3002</p>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_10","title":"\u8ba2\u9605\u7ba1\u7406","text":"<pre><code>int topic_subscribe(topic_bus_t* bus, uint16_t topic_id,\n                    void (*callback)(uint16_t, const void*, size_t, void*),\n                    void* user_data);\n\nint topic_unsubscribe(topic_bus_t* bus, uint16_t topic_id,\n                      void (*callback)(uint16_t, const void*, size_t, void*),\n                      void* user_data);\n</code></pre> <p>\u8ba2\u9605/\u53d6\u6d88\u8ba2\u9605Topic\uff0c\u6ce8\u518c/\u79fb\u9664\u56de\u8c03\u51fd\u6570\u3002</p>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_11","title":"\u4e8b\u4ef6\u53d1\u5e03","text":"<pre><code>int topic_publish_event(topic_bus_t* bus, obj_dict_key_t event_key);\nint topic_publish_manual(topic_bus_t* bus, uint16_t topic_id);\n#if TOPIC_BUS_ENABLE_ISR\nint topic_publish_isr(topic_bus_t* bus, obj_dict_key_t event_key);\nvoid topic_bus_process_isr_queue(topic_bus_t* bus);\n#endif\n</code></pre> <p>\u53d1\u5e03\u4e8b\u4ef6\uff08\u4efb\u52a1\u6a21\u5f0f\uff09\u3001\u624b\u52a8\u53d1\u5e03Topic\u3001ISR\u5b89\u5168\u53d1\u5e03\u3001\u5904\u7406ISR\u961f\u5217\u3002</p>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_12","title":"\u4f7f\u7528\u793a\u4f8b","text":""},{"location":"zero_topic_core/topic_bus/topic_bus/#or","title":"\u57fa\u7840\u793a\u4f8b\uff1aOR\u89c4\u5219","text":"<pre><code>/* \u521d\u59cb\u5316\u5bf9\u8c61\u5b57\u5178 */\nobj_dict_entry_t dict_entries[100];\nobj_dict_t dict;\nobj_dict_init(&amp;dict, dict_entries, 100);\n\n/* \u521d\u59cb\u5316Topic\u603b\u7ebf */\ntopic_entry_t topic_entries[16];\ntopic_bus_t bus;\ntopic_bus_init(&amp;bus, topic_entries, 16, &amp;dict);\n\n/* \u521b\u5efaOR\u89c4\u5219\uff1a\u4efb\u4e00\u4e8b\u4ef6\u89e6\u53d1 */\nobj_dict_key_t events[] = {10, 20, 30};\ntopic_rule_t rule = {\n    .type = TOPIC_RULE_OR,\n    .events = events,\n    .event_count = 3,\n};\n#if TOPIC_BUS_ENABLE_ATOMICS\n    atomic_init(&amp;rule.trigger_mask, 0);\n#endif\ntopic_rule_create(&amp;bus, 1, &amp;rule);\n\n/* \u8ba2\u9605Topic */\nvoid my_callback(uint16_t topic_id, const void* data, size_t len, void* user) {\n    printf(\"Topic %d triggered, data_len=%zu\\n\", topic_id, len);\n}\ntopic_subscribe(&amp;bus, 1, my_callback, NULL);\n\n/* \u53d1\u5e03\u4e8b\u4ef6\u89e6\u53d1Topic */\nmy_data_t data = {.value = 123};\nobj_dict_set(&amp;dict, 10, &amp;data, sizeof(data), 0);\ntopic_publish_event(&amp;bus, 10);  // \u89e6\u53d1\u56de\u8c03\n</code></pre>"},{"location":"zero_topic_core/topic_bus/topic_bus/#and","title":"AND\u89c4\u5219\u793a\u4f8b","text":"<pre><code>/* \u521b\u5efaAND\u89c4\u5219\uff1a\u5168\u90e8\u4e8b\u4ef6\u89e6\u53d1 */\nobj_dict_key_t events[] = {40, 50};\ntopic_rule_t rule = {\n    .type = TOPIC_RULE_AND,\n    .events = events,\n    .event_count = 2,\n};\n#if TOPIC_BUS_ENABLE_ATOMICS\n    atomic_init(&amp;rule.trigger_mask, 0);\n#endif\ntopic_rule_create(&amp;bus, 2, &amp;rule);\n\n/* \u8ba2\u9605 */\ntopic_subscribe(&amp;bus, 2, my_callback, NULL);\n\n/* \u53d1\u5e03\u7b2c\u4e00\u4e2a\u4e8b\u4ef6\uff08\u4e0d\u89e6\u53d1\uff09 */\nobj_dict_set(&amp;dict, 40, &amp;data, sizeof(data), 0);\ntopic_publish_event(&amp;bus, 40);  // \u4e0d\u89e6\u53d1\n\n/* \u53d1\u5e03\u7b2c\u4e8c\u4e2a\u4e8b\u4ef6\uff08\u89e6\u53d1\uff09 */\nobj_dict_set(&amp;dict, 50, &amp;data, sizeof(data), 0);\ntopic_publish_event(&amp;bus, 50);  // \u89e6\u53d1\u56de\u8c03\n</code></pre>"},{"location":"zero_topic_core/topic_bus/topic_bus/#isr_1","title":"ISR\u5b89\u5168\u53d1\u5e03","text":"<pre><code>/* \u5728ISR\u4e2d\u53d1\u5e03\u4e8b\u4ef6 */\nvoid gpio_isr_handler(void) {\n    topic_publish_isr(&amp;bus, 100);\n}\n\n/* \u5728\u4efb\u52a1\u4e2d\u5904\u7406ISR\u961f\u5217 */\nvoid task_process_events(void) {\n    while (1) {\n        topic_bus_process_isr_queue(&amp;bus);\n        os_delay_ms(10);\n    }\n}\n</code></pre>"},{"location":"zero_topic_core/topic_bus/topic_bus/#manual","title":"MANUAL\u89c4\u5219\u793a\u4f8b","text":"<pre><code>/* \u521b\u5efaMANUAL\u89c4\u5219 */\nobj_dict_key_t events[] = {60};\ntopic_rule_t rule = {\n    .type = TOPIC_RULE_MANUAL,\n    .events = events,\n    .event_count = 1,\n};\n#if TOPIC_BUS_ENABLE_ATOMICS\n    atomic_init(&amp;rule.trigger_mask, 0);\n#endif\ntopic_rule_create(&amp;bus, 3, &amp;rule);\ntopic_subscribe(&amp;bus, 3, my_callback, NULL);\n\n/* \u624b\u52a8\u89e6\u53d1\uff08\u4e8b\u4ef6\u53d1\u5e03\u4e0d\u4f1a\u89e6\u53d1\uff09 */\ntopic_publish_event(&amp;bus, 60);  // \u4e0d\u89e6\u53d1\ntopic_publish_manual(&amp;bus, 3);  // \u624b\u52a8\u89e6\u53d1\n</code></pre>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_13","title":"\u6027\u80fd\u6307\u6807","text":""},{"location":"zero_topic_core/topic_bus/topic_bus/#_14","title":"\u8bbe\u8ba1\u76ee\u6807","text":"<ul> <li>\u4e8b\u4ef6\u53d1\u5e03\u5ef6\u8fdf\uff1a&lt; 10us\uff08\u975e\u963b\u585e\u6a21\u5f0f\uff09</li> <li>\u89c4\u5219\u5339\u914d\uff1a&lt; 5us\uff08OR\u89c4\u5219\uff09\uff0c&lt; 8us\uff08AND\u89c4\u5219\uff09</li> <li>ISR\u8def\u5f84\uff1a&lt; 3us\uff08\u5165\u961f\uff09</li> <li>\u56de\u8c03\u6267\u884c\uff1a\u53d6\u51b3\u4e8e\u7528\u6237\u56de\u8c03\uff0c\u6846\u67b6\u5f00\u9500 &lt; 2us</li> </ul>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_15","title":"\u4f18\u5316\u7279\u6027","text":"<ul> <li>C11\u539f\u5b50\u64cd\u4f5c\uff1a\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\u4f18\u5316\u7248\u672c\u53f7\u548c\u63a9\u7801\u7ba1\u7406</li> <li>\u65e0\u9501\u8bbe\u8ba1\uff1aSPSC\u573a\u666f\u4e0b\u7684\u65e0\u9501\u8ba2\u9605\u5217\u8868\u904d\u5386</li> <li>\u96f6\u62f7\u8d1d\uff1a\u56de\u8c03\u76f4\u63a5\u8bbf\u95eeobj_dict\u4e2d\u7684\u6570\u636e\uff0c\u65e0\u9700\u62f7\u8d1d</li> <li>\u89c4\u5219\u7f13\u5b58\uff08\u53ef\u9009\uff09\uff1a\u5bf9\u6700\u8fd1\u4e00\u6b21\u4e8b\u4ef6\u5339\u914d\u7ed3\u679c\u8fdb\u884c\u7f13\u5b58\uff0c\u63d0\u5347\u9ad8\u9891\u91cd\u590d\u4e8b\u4ef6\u7684\u5339\u914d\u6548\u7387\uff08<code>TOPIC_BUS_ENABLE_RULE_CACHE</code>\uff09</li> <li>\u8bca\u65ad\u7edf\u8ba1\uff08\u53ef\u9009\uff09\uff1a\u8bb0\u5f55\u6700\u8fd1\u4e00\u6b21\u89e6\u53d1\u7684\u4e8b\u4ef6\u952e\u3001\u6570\u636e\u957f\u5ea6\u4e0e\u65f6\u95f4\u6233\uff0c\u4fbf\u4e8e\u8fd0\u884c\u671f\u5b9a\u4f4d\u95ee\u9898\uff08<code>TOPIC_BUS_ENABLE_DIAG</code>\uff09</li> <li>\u751f\u547d\u5468\u671f\u4fdd\u62a4\uff1a\u81ea\u52a8\u4f7f\u7528\u5f15\u7528\u8ba1\u6570\u673a\u5236\uff0c\u786e\u4fdd\u56de\u8c03\u671f\u95f4\u6570\u636e\u6307\u9488\u6709\u6548\u6027</li> <li>\u5e76\u53d1\u5b89\u5168\u4f18\u5316\uff1a\u5728\u65e0\u9501\u72b6\u6001\u4e0b\u89e6\u53d1\u56de\u8c03\uff0c\u907f\u514d\u6b7b\u9501\uff0c\u5141\u8bb8\u5e76\u53d1\u56de\u8c03\u6267\u884c</li> </ul>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_16","title":"\u6d4b\u8bd5","text":"<p>\u8fd0\u884c\u6027\u80fd\u6d4b\u8bd5\uff1a <pre><code>int topic_bus_perf_test_main(void);\n</code></pre></p> <p>\u6d4b\u8bd5\u5185\u5bb9\uff1a - \u57fa\u7840\u529f\u80fd\u6d4b\u8bd5\uff1aOR/AND/MANUAL\u89c4\u5219\u3001\u8ba2\u9605/\u53d1\u5e03 - \u4e8b\u4ef6\u53d1\u5e03\u5ef6\u8fdf\u6d4b\u8bd5 - \u89c4\u5219\u5339\u914d\u6027\u80fd\u6d4b\u8bd5  - \uff08\u53ef\u9009\uff09\u8bca\u65ad\u6253\u5370\uff1a\u5f53\u5f00\u542f\u7edf\u8ba1\u4e0e\u8bca\u65ad\u5b8f\u540e\uff0c\u6027\u80fd\u6d4b\u8bd5\u5c06\u8f93\u51fa\u6bcf\u4e2aTopic\u6700\u8fd1\u4e00\u6b21\u89e6\u53d1\u4fe1\u606f</p>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_17","title":"\u5173\u95ed\u4e0d\u9700\u8981\u7684\u6d4b\u8bd5","text":"<p>\u5728 <code>apps/linux_demo/config.h</code> \u901a\u8fc7\u5b8f\u63a7\u5236\u6d4b\u8bd5\u5f00\u5173\uff0c\u9ed8\u8ba4\u4ec5\u5f00\u542f Topic Bus \u5b8c\u6574\u6d4b\u8bd5\uff1a</p> <pre><code>#define ENABLE_THREAD_DEMO      0\n#define ENABLE_VFB_TEST         0\n#define ENABLE_RING_BUFFER_TEST 0\n#define ENABLE_OBJ_DICT_TEST    0\n#define ENABLE_TOPIC_BUS_TEST   1\n</code></pre>"},{"location":"zero_topic_core/topic_bus/topic_bus/#obj_dict","title":"\u4e0eobj_dict\u7684\u5173\u7cfb","text":"<p>Topic\u603b\u7ebf\u4e0e\u5bf9\u8c61\u5b57\u5178\u6df1\u5ea6\u96c6\u6210\uff1a 1. \u53d1\u5e03\u4e8b\u4ef6\u65f6\uff0c\u5148\u901a\u8fc7<code>obj_dict_set</code>\u66f4\u65b0\u6570\u636e 2. \u89c4\u5219\u5339\u914d\u540e\uff0c\u81ea\u52a8\u4eceobj_dict\u83b7\u53d6\u6700\u65b0\u6570\u636e 3. \u56de\u8c03\u51fd\u6570\u63a5\u6536\u6570\u636e\u6307\u9488\uff0c\u5b9e\u73b0\u96f6\u62f7\u8d1d\u8bbf\u95ee</p>"},{"location":"zero_topic_core/topic_bus/topic_bus/#ring_buffer","title":"\u4e0ering_buffer\u7684\u5173\u7cfb","text":"<p>Topic\u603b\u7ebf\u4f7f\u7528ring_buffer\u5b9e\u73b0ISR\u5b89\u5168\u8def\u5f84\uff1a - ISR\u53d1\u5e03\u65f6\u5165\u961f\u5230ring_buffer - \u4efb\u52a1\u6a21\u5f0f\u4ecering_buffer\u51fa\u961f\u5e76\u5904\u7406</p>"},{"location":"zero_topic_core/topic_bus/topic_bus/#microros","title":"\u4e0emicroROS\u7684\u5173\u7cfb","text":"<p>Topic\u603b\u7ebf\u53ef\u5bf9\u63a5microROS\uff1a - Topic ID\u6620\u5c04\u5230ROS Topic\u540d\u79f0 - \u56de\u8c03\u673a\u5236\u9002\u914dROS\u8ba2\u9605\u8005 - \u5bf9\u8c61\u5b57\u5178\u652f\u6301ROS\u6d88\u606f\u7c7b\u578b</p>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_18","title":"\u5185\u5b58\u6a21\u578b","text":"<ul> <li>\u914d\u7f6e\u671f\u9759\u6001\u5206\u914d\uff1aTopic\u6761\u76ee\u6570\u7ec4\u3001\u8ba2\u9605\u8005\u94fe\u8868\u8282\u70b9</li> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a\u4f7f\u7528\u4fe1\u53f7\u91cf\u4fdd\u62a4\u5173\u952e\u8def\u5f84</li> <li>\u5e76\u53d1\u6a21\u578b\uff1aSPSC/MPMC\u652f\u6301\uff0cISR\u5b89\u5168\u4fdd\u8bc1</li> </ul>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_19","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u89c4\u5219\u4e8b\u4ef6\u6570\u7ec4\uff1a\u9700\u8981\u5728\u5916\u90e8\u6301\u4e45\u5316\u5b58\u50a8events\u6570\u7ec4</li> <li>\u56de\u8c03\u6267\u884c\u65f6\u95f4\uff1a\u56de\u8c03\u6267\u884c\u65f6\u95f4\u5e94\u5c3d\u91cf\u77ed\uff0c\u907f\u514d\u963b\u585e\u53d1\u5e03\u7ebf\u7a0b</li> <li>\u5185\u5b58\u5bf9\u9f50\uff1a\u6570\u636e\u5e94\u6309\u7167\u5e73\u53f0\u5bf9\u9f50\u8981\u6c42\u5bf9\u9f50</li> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a\u8ba2\u9605/\u53d6\u6d88\u8ba2\u9605\u9700\u8981\u52a0\u9501\u4fdd\u62a4</li> <li>\u6570\u636e\u751f\u547d\u5468\u671f\uff1a\u56de\u8c03\u4e2d\u7684\u6570\u636e\u6307\u9488\u5728\u56de\u8c03\u671f\u95f4\u6709\u6548\uff0c\u65e0\u9700\u62c5\u5fc3\u6570\u636e\u88ab\u5220\u9664\uff08\u81ea\u52a8\u5f15\u7528\u8ba1\u6570\u4fdd\u62a4\uff09</li> <li>\u5e76\u53d1\u5b89\u5168\uff1a\u53d1\u5e03\u4e8b\u4ef6\u65f6\u5728\u65e0\u9501\u72b6\u6001\u4e0b\u89e6\u53d1\u56de\u8c03\uff0c\u907f\u514d\u6b7b\u9501\uff0c\u652f\u6301\u5e76\u53d1\u56de\u8c03\u6267\u884c</li> </ol>"},{"location":"zero_topic_core/topic_bus/topic_bus/#_20","title":"\u6269\u5c55\u6027","text":"<p>\u53ef\u901a\u8fc7\u914d\u7f6e\u5f00\u5173\u7075\u6d3b\u88c1\u526a\u529f\u80fd\uff1a - \u5173\u95ed\u7edf\u8ba1\u4fe1\u606f\u51cf\u5c11\u5185\u5b58\u5f00\u9500 - \u5173\u95edISR\u652f\u6301\u7b80\u5316\u5b9e\u73b0 - \u5173\u95ed\u539f\u5b50\u64cd\u4f5c\u56de\u9000\u5230\u9501\u4fdd\u62a4</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/","title":"Topic \u5b57\u7b26\u4e32 vs \u6574\u6570 ID \u6027\u80fd\u5206\u6790","text":""},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#_1","title":"\u6982\u8ff0","text":"<p>\u672c\u6587\u6863\u5206\u6790\u5982\u679c\u5c06 topic \u4ece\u6574\u6570 ID\uff08<code>uint16_t</code>\uff09\u6539\u4e3a\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u6027\u80fd\u635f\u8017\u5dee\u5f02\u3002</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#_2","title":"\u5f53\u524d\u5b9e\u73b0\u5206\u6790","text":""},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#id","title":"\u5f53\u524d\u5b9e\u73b0\uff08\u6574\u6570 ID\uff09","text":"<p>```27:35:OpenIBBOs/zero_topic_core/topic_bus/topic_bus.c static topic_entry_t __find_topic(topic_bus_t bus, uint16_t topic_id) {     if (!bus || !bus-&gt;topics) return NULL;     for (size_t i = 0; i &lt; bus-&gt;max_topics; ++i) {         if (bus-&gt;topics[i].topic_id == topic_id) {             return &amp;bus-&gt;topics[i];         }     }     return NULL; } <pre><code>**\u7279\u70b9\uff1a**\n- Topic ID \u4e3a `uint16_t`\uff082 \u5b57\u8282\uff09\n- \u67e5\u627e\u4f7f\u7528\u7b80\u5355\u7684\u6574\u6570\u6bd4\u8f83\uff081 \u4e2a CPU \u5468\u671f\uff09\n- \u65f6\u95f4\u590d\u6742\u5ea6\uff1aO(n)\uff0cn \u4e3a Topic \u6570\u91cf\n- \u7a7a\u95f4\u590d\u6742\u5ea6\uff1a\u6bcf\u4e2a Topic \u6761\u76ee 2 \u5b57\u8282\n\n### \u5982\u679c\u6539\u4e3a\u5b57\u7b26\u4e32\u5b9e\u73b0\n\n```c\n// \u5047\u8bbe\u6539\u4e3a\u5b57\u7b26\u4e32\ntypedef struct {\n    const char* topic_name;  // \u5b57\u7b26\u4e32\u6307\u9488\n    // ... \u5176\u4ed6\u5b57\u6bb5\n} topic_entry_t;\n\nstatic topic_entry_t* __find_topic(topic_bus_t* bus, const char* topic_name) {\n    if (!bus || !bus-&gt;topics || !topic_name) return NULL;\n    for (size_t i = 0; i &lt; bus-&gt;max_topics; ++i) {\n        if (strcmp(bus-&gt;topics[i].topic_name, topic_name) == 0) {\n            return &amp;bus-&gt;topics[i];\n        }\n    }\n    return NULL;\n}\n</code></pre></p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#_3","title":"\u6027\u80fd\u635f\u8017\u5206\u6790","text":""},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#1","title":"1. \u67e5\u627e\u6027\u80fd\u5bf9\u6bd4","text":""},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#11","title":"1.1 \u65f6\u95f4\u590d\u6742\u5ea6","text":"\u64cd\u4f5c \u6574\u6570 ID \u5b57\u7b26\u4e32 \u5355\u6b21\u6bd4\u8f83 O(1) - 1 \u4e2a CPU \u5468\u671f O(m) - m \u4e3a\u5b57\u7b26\u4e32\u957f\u5ea6 \u5e73\u5747\u67e5\u627e O(n/2) - n \u4e3a Topic \u6570\u91cf O(n\u00d7m/2) \u6700\u574f\u67e5\u627e O(n) O(n\u00d7m) <p>\u793a\u4f8b\u8ba1\u7b97\uff0864 \u4e2a Topic\uff0c\u5e73\u5747\u5b57\u7b26\u4e32\u957f\u5ea6 20 \u5b57\u7b26\uff09\uff1a - \u6574\u6570 ID\uff1a\u5e73\u5747 32 \u6b21\u6bd4\u8f83 \u00d7 1 \u5468\u671f = 32 \u5468\u671f - \u5b57\u7b26\u4e32\uff1a\u5e73\u5747 32 \u6b21\u6bd4\u8f83 \u00d7 20 \u5b57\u7b26 = 640 \u5468\u671f</p> <p>\u6027\u80fd\u5dee\u5f02\uff1a\u7ea6 20 \u500d</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#12","title":"1.2 \u5b9e\u9645\u6027\u80fd\u6d4b\u8bd5\u4f30\u7b97","text":"<p>\u5047\u8bbe\u5178\u578b\u573a\u666f\uff1a - Topic \u6570\u91cf\uff1a64 - \u5e73\u5747\u5b57\u7b26\u4e32\u957f\u5ea6\uff1a20 \u5b57\u7b26 - CPU\uff1aARM Cortex-M4 @ 168MHz</p> <p>\u6574\u6570 ID \u67e5\u627e\uff1a <pre><code>\u5e73\u5747\u67e5\u627e\u6b21\u6570\uff1a32 \u6b21\n\u6bcf\u6b21\u6bd4\u8f83\uff1a1 \u4e2a\u5468\u671f\n\u603b\u5468\u671f\uff1a32 \u5468\u671f\n\u65f6\u95f4\uff1a32 / 168MHz \u2248 0.19 us\n</code></pre></p> <p>\u5b57\u7b26\u4e32\u67e5\u627e\uff1a <pre><code>\u5e73\u5747\u67e5\u627e\u6b21\u6570\uff1a32 \u6b21\n\u6bcf\u6b21 strcmp\uff1a\u5e73\u5747 20 \u5b57\u7b26\u6bd4\u8f83 = 20 \u5468\u671f\n\u603b\u5468\u671f\uff1a32 \u00d7 20 = 640 \u5468\u671f\n\u65f6\u95f4\uff1a640 / 168MHz \u2248 3.81 us\n</code></pre></p> <p>\u6027\u80fd\u5dee\u5f02\uff1a\u7ea6 20 \u500d\uff083.81 / 0.19\uff09</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#2","title":"2. \u5185\u5b58\u5f00\u9500\u5bf9\u6bd4","text":""},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#21","title":"2.1 \u5b58\u50a8\u7a7a\u95f4","text":"<p>\u6574\u6570 ID\uff1a <pre><code>typedef struct {\n    uint16_t topic_id;  // 2 \u5b57\u8282\n    // ...\n} topic_entry_t;\n</code></pre></p> <p>\u5b57\u7b26\u4e32\uff1a <pre><code>typedef struct {\n    const char* topic_name;  // \u6307\u9488\uff1a4/8 \u5b57\u8282\uff0832/64\u4f4d\u7cfb\u7edf\uff09\n    // \u52a0\u4e0a\u5b57\u7b26\u4e32\u672c\u8eab\uff1a\u5e73\u5747 20 \u5b57\u8282\n    // \u603b\u8ba1\uff1a24-28 \u5b57\u8282\n} topic_entry_t;\n</code></pre></p> <p>\u5185\u5b58\u5f00\u9500\u5bf9\u6bd4\uff1a</p> \u9879\u76ee \u6574\u6570 ID \u5b57\u7b26\u4e32 \u5dee\u5f02 Topic \u6761\u76ee\u5b57\u6bb5 2 \u5b57\u8282 4-8 \u5b57\u8282 +2-6 \u5b57\u8282 \u5b57\u7b26\u4e32\u5b58\u50a8 0 20 \u5b57\u8282\uff08\u5e73\u5747\uff09 +20 \u5b57\u8282 \u603b\u8ba1 2 \u5b57\u8282 24-28 \u5b57\u8282 +12-14 \u500d <p>\u793a\u4f8b\uff1a64 \u4e2a Topic - \u6574\u6570 ID\uff1a64 \u00d7 2 = 128 \u5b57\u8282 - \u5b57\u7b26\u4e32\uff1a64 \u00d7 24 = 1536 \u5b57\u8282 - \u5185\u5b58\u589e\u52a0\uff1a12 \u500d</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#22","title":"2.2 \u7f13\u5b58\u53cb\u597d\u6027","text":"<p>\u6574\u6570 ID\uff1a - \u6570\u636e\u7d27\u51d1\uff0c\u7f13\u5b58\u547d\u4e2d\u7387\u9ad8 - \u4e00\u6b21\u7f13\u5b58\u884c\uff0864 \u5b57\u8282\uff09\u53ef\u5bb9\u7eb3 32 \u4e2a Topic ID - \u7f13\u5b58\u53cb\u597d</p> <p>\u5b57\u7b26\u4e32\uff1a - \u5b57\u7b26\u4e32\u5206\u6563\u5b58\u50a8\uff0c\u7f13\u5b58\u547d\u4e2d\u7387\u4f4e - \u5b57\u7b26\u4e32\u6bd4\u8f83\u9700\u8981\u591a\u6b21\u5185\u5b58\u8bbf\u95ee - \u7f13\u5b58\u4e0d\u53cb\u597d</p> <p>\u7f13\u5b58\u6027\u80fd\u5f71\u54cd\uff1a - \u6574\u6570 ID\uff1aL1 \u7f13\u5b58\u547d\u4e2d\u7387 &gt; 95% - \u5b57\u7b26\u4e32\uff1aL1 \u7f13\u5b58\u547d\u4e2d\u7387 &lt; 80%\uff08\u4f30\u8ba1\uff09 - \u6027\u80fd\u8fdb\u4e00\u6b65\u4e0b\u964d\u7ea6 20%</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#3","title":"3. \u5b57\u7b26\u4e32\u6bd4\u8f83\u5f00\u9500","text":""},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#31-strcmp","title":"3.1 strcmp \u51fd\u6570\u5f00\u9500","text":"<pre><code>// strcmp \u5b9e\u73b0\uff08\u7b80\u5316\u7248\uff09\nint strcmp(const char* s1, const char* s2) {\n    while (*s1 &amp;&amp; (*s1 == *s2)) {\n        s1++;\n        s2++;\n    }\n    return *s1 - *s2;\n}\n</code></pre> <p>\u6bcf\u6b21\u6bd4\u8f83\u7684\u5f00\u9500\uff1a - \u5b57\u7b26\u52a0\u8f7d\uff1a1 \u5468\u671f - \u5b57\u7b26\u6bd4\u8f83\uff1a1 \u5468\u671f - \u6307\u9488\u9012\u589e\uff1a1 \u5468\u671f - \u5206\u652f\u5224\u65ad\uff1a1 \u5468\u671f\uff08\u5982\u679c\u5206\u652f\u9884\u6d4b\u5931\u8d25\uff09 - \u5e73\u5747\u6bcf\u4e2a\u5b57\u7b26\uff1a3-4 \u5468\u671f</p> <p>20 \u5b57\u7b26\u5b57\u7b26\u4e32\u6bd4\u8f83\uff1a - \u6700\u4f73\u60c5\u51b5\uff08\u524d\u51e0\u4e2a\u5b57\u7b26\u4e0d\u540c\uff09\uff1a3-4 \u5468\u671f - \u5e73\u5747\u60c5\u51b5\uff08\u4e2d\u95f4\u5b57\u7b26\u4e0d\u540c\uff09\uff1a30-40 \u5468\u671f - \u6700\u574f\u60c5\u51b5\uff08\u5b8c\u5168\u76f8\u540c\uff09\uff1a60-80 \u5468\u671f</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#32","title":"3.2 \u4f18\u5316\u65b9\u6848\u5bf9\u6bd4","text":"<p>\u65b9\u6848 A\uff1a\u5b57\u7b26\u4e32\u54c8\u5e0c <pre><code>uint32_t topic_hash(const char* name) {\n    uint32_t hash = 0;\n    while (*name) {\n        hash = hash * 31 + *name++;\n    }\n    return hash;\n}\n</code></pre> - \u4f18\u70b9\uff1a\u53ef\u5c06\u67e5\u627e\u964d\u4e3a O(n) - \u7f3a\u70b9\uff1a\u9700\u8981\u5b58\u50a8\u54c8\u5e0c\u503c\uff0c\u4ecd\u6709\u5b57\u7b26\u4e32\u6bd4\u8f83\u5f00\u9500 - \u6027\u80fd\u63d0\u5347\uff1a\u7ea6 5-10 \u500d\uff08\u4f46\u4ecd\u4e0d\u5982\u6574\u6570 ID\uff09</p> <p>\u65b9\u6848 B\uff1a\u5b57\u7b26\u4e32\u6c60 <pre><code>// \u4f7f\u7528\u5b57\u7b26\u4e32\u6c60\uff0c\u53ea\u6bd4\u8f83\u6307\u9488\nstatic const char* topic_pool[] = {\n    \"sensor_data\",\n    \"motor_control\",\n    // ...\n};\n</code></pre> - \u4f18\u70b9\uff1a\u67e5\u627e\u65f6\u53ea\u9700\u6bd4\u8f83\u6307\u9488\uff08O(1)\uff09 - \u7f3a\u70b9\uff1a\u9700\u8981\u9884\u5148\u5b9a\u4e49\u6240\u6709 Topic \u540d\u79f0 - \u6027\u80fd\uff1a\u63a5\u8fd1\u6574\u6570 ID\uff0c\u4f46\u7075\u6d3b\u6027\u964d\u4f4e</p> <p>\u65b9\u6848 C\uff1a\u6df7\u5408\u65b9\u6848 <pre><code>typedef struct {\n    uint16_t topic_id;      // \u5185\u90e8\u4f7f\u7528\u6574\u6570 ID\n    const char* topic_name; // \u5916\u90e8\u4f7f\u7528\u5b57\u7b26\u4e32\uff08\u4ec5\u7528\u4e8e\u8c03\u8bd5/\u65e5\u5fd7\uff09\n} topic_entry_t;\n</code></pre> - \u4f18\u70b9\uff1a\u5185\u90e8\u9ad8\u6548\uff0c\u5916\u90e8\u517c\u5bb9\u5b57\u7b26\u4e32 - \u7f3a\u70b9\uff1a\u9700\u8981\u7ef4\u62a4 ID \u5230\u540d\u79f0\u7684\u6620\u5c04\u8868</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#4","title":"4. \u5b9e\u9645\u573a\u666f\u6027\u80fd\u5f71\u54cd","text":""},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#41","title":"4.1 \u4e8b\u4ef6\u53d1\u5e03\u6027\u80fd","text":"<p>\u5f53\u524d\u5b9e\u73b0\uff08\u6574\u6570 ID\uff09\uff1a <pre><code>int topic_publish_event(topic_bus_t* bus, obj_dict_key_t event_key) {\n    // ... \u904d\u5386\u6240\u6709 Topic\uff0c\u68c0\u67e5\u89c4\u5219\u5339\u914d\n    for (size_t i = 0; i &lt; bus-&gt;max_topics; ++i) {\n        topic_entry_t* entry = &amp;bus-&gt;topics[i];\n        if (entry-&gt;topic_id == 0xFFFF) continue;\n        // \u89c4\u5219\u5339\u914d\uff1a\u4f7f\u7528\u6574\u6570\u6bd4\u8f83\n        if (topic_rule_can_trigger(&amp;entry-&gt;rule, event_key)) {\n            // ...\n        }\n    }\n}\n</code></pre></p> <p>\u5173\u952e\u8def\u5f84\uff1a - \u904d\u5386\uff1aO(n) - \u89c4\u5219\u5339\u914d\uff1aO(m)\uff0cm \u4e3a\u89c4\u5219\u4e8b\u4ef6\u6570 - \u603b\u5f00\u9500\uff1aO(n\u00d7m)</p> <p>\u5982\u679c\u6539\u4e3a\u5b57\u7b26\u4e32\uff1a - \u6bcf\u6b21\u67e5\u627e\u90fd\u9700\u8981\u5b57\u7b26\u4e32\u6bd4\u8f83 - \u5728\u89c4\u5219\u5339\u914d\u4e2d\u4e5f\u9700\u8981\u5b57\u7b26\u4e32\u6bd4\u8f83 - \u603b\u5f00\u9500\uff1aO(n\u00d7m\u00d7strlen)</p> <p>\u6027\u80fd\u5f71\u54cd\u4f30\u7b97\uff1a - \u5f53\u524d\uff1a64 Topic \u00d7 16 \u4e8b\u4ef6 \u00d7 1 \u5468\u671f = 1024 \u5468\u671f \u2248 6.1 us - \u5b57\u7b26\u4e32\uff1a64 Topic \u00d7 16 \u4e8b\u4ef6 \u00d7 20 \u5468\u671f = 20480 \u5468\u671f \u2248 121.9 us - \u6027\u80fd\u4e0b\u964d\uff1a\u7ea6 20 \u500d</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#42","title":"4.2 \u8ba2\u9605/\u53d6\u6d88\u8ba2\u9605\u6027\u80fd","text":"<p>\u5f53\u524d\u5b9e\u73b0\uff1a <pre><code>int topic_subscribe(topic_bus_t* bus, uint16_t topic_id, ...) {\n    topic_entry_t* entry = __find_topic(bus, topic_id);\n    // \u67e5\u627e\uff1aO(n)\uff0c\u5e73\u5747 32 \u6b21\u6574\u6570\u6bd4\u8f83\n}\n</code></pre></p> <p>\u5b57\u7b26\u4e32\u5b9e\u73b0\uff1a <pre><code>int topic_subscribe(topic_bus_t* bus, const char* topic_name, ...) {\n    topic_entry_t* entry = __find_topic(bus, topic_name);\n    // \u67e5\u627e\uff1aO(n\u00d7m)\uff0c\u5e73\u5747 32 \u00d7 20 = 640 \u6b21\u5b57\u7b26\u6bd4\u8f83\n}\n</code></pre></p> <p>\u6027\u80fd\u5f71\u54cd\uff1a - \u8ba2\u9605\u64cd\u4f5c\u4e0d\u662f\u9ad8\u9891\u64cd\u4f5c\uff08\u521d\u59cb\u5316\u65f6\u6267\u884c\uff09 - \u4f46\u5b57\u7b26\u4e32\u67e5\u627e\u4ecd\u7136\u6162 20 \u500d</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#43-isr","title":"4.3 ISR \u8def\u5f84\u6027\u80fd","text":"<p>\u5f53\u524d\u5b9e\u73b0\uff08ISR \u5b89\u5168\uff09\uff1a <pre><code>int topic_publish_isr(topic_bus_t* bus, obj_dict_key_t event_key) {\n    // \u4ec5\u5165\u961f\uff0c\u4e0d\u67e5\u627e\n    topic_bus_isr_event_t evt = { .event_key = event_key };\n    return ring_buffer_write_isr(bus-&gt;isr_queue, &amp;evt);\n}\n</code></pre></p> <p>\u5982\u679c\u6539\u4e3a\u5b57\u7b26\u4e32\uff1a - ISR \u4e2d\u4e0d\u80fd\u4f7f\u7528\u5b57\u7b26\u4e32\u6bd4\u8f83\uff08\u53ef\u80fd\u89e6\u53d1\u9875\u9519\u8bef\uff09 - \u9700\u8981\u5728 ISR \u4e2d\u5148\u8fdb\u884c\u5b57\u7b26\u4e32\u5230 ID \u7684\u8f6c\u6362 - \u6216\u8005\u5b8c\u5168\u7981\u7528 ISR \u8def\u5f84</p> <p>\u5f71\u54cd\uff1a - ISR \u8def\u5f84\u6027\u80fd\u4e0d\u53d7\u5f71\u54cd\uff08\u5982\u679c\u4f7f\u7528\u6df7\u5408\u65b9\u6848\uff09 - \u4f46\u5982\u679c\u5b8c\u5168\u4f7f\u7528\u5b57\u7b26\u4e32\uff0cISR \u8def\u5f84\u53ef\u80fd\u4e0d\u53ef\u7528</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#5","title":"5. \u7efc\u5408\u6027\u80fd\u5bf9\u6bd4","text":""},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#51","title":"5.1 \u6027\u80fd\u6307\u6807\u5bf9\u6bd4\u8868","text":"\u6307\u6807 \u6574\u6570 ID \u5b57\u7b26\u4e32 \u6027\u80fd\u5dee\u5f02 \u67e5\u627e\u6027\u80fd 0.19 us 3.81 us 20 \u500d \u5185\u5b58\u5360\u7528 128 \u5b57\u8282 1536 \u5b57\u8282 12 \u500d \u7f13\u5b58\u547d\u4e2d\u7387 &gt; 95% &lt; 80% -15% \u4e8b\u4ef6\u53d1\u5e03 6.1 us 121.9 us 20 \u500d \u8ba2\u9605\u64cd\u4f5c 0.19 us 3.81 us 20 \u500d \u4ee3\u7801\u590d\u6742\u5ea6 \u4f4e \u9ad8 - ISR \u5b89\u5168 \u662f \u5426\uff08\u7eaf\u5b57\u7b26\u4e32\uff09 -"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#52","title":"5.2 \u5b9e\u9645\u5f71\u54cd\u8bc4\u4f30","text":"<p>\u9ad8\u9891\u64cd\u4f5c\uff08\u4e8b\u4ef6\u53d1\u5e03\uff09\uff1a - \u5f53\u524d\uff1a6.1 us - \u5b57\u7b26\u4e32\uff1a121.9 us - \u5ef6\u8fdf\u589e\u52a0\uff1a115.8 us - \u5f71\u54cd\uff1a\u5bf9\u4e8e 100Hz \u7684\u4e8b\u4ef6\u53d1\u5e03\uff0c\u5ef6\u8fdf\u589e\u52a0\u53ef\u80fd\u5bfc\u81f4\u5b9e\u65f6\u6027\u95ee\u9898</p> <p>\u4f4e\u9891\u64cd\u4f5c\uff08\u8ba2\u9605\uff09\uff1a - \u5f53\u524d\uff1a0.19 us - \u5b57\u7b26\u4e32\uff1a3.81 us - \u5f71\u54cd\uff1a\u53ef\u63a5\u53d7\uff08\u4ec5\u5728\u521d\u59cb\u5316\u65f6\u6267\u884c\uff09</p> <p>\u5185\u5b58\u5360\u7528\uff1a - \u5f53\u524d\uff1a128 \u5b57\u8282 - \u5b57\u7b26\u4e32\uff1a1536 \u5b57\u8282 - \u5f71\u54cd\uff1a\u5bf9\u4e8e\u8d44\u6e90\u53d7\u9650\u7684 MCU\uff0c\u5185\u5b58\u589e\u52a0\u53ef\u80fd\u4e0d\u53ef\u63a5\u53d7</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#6","title":"6. \u4f18\u5316\u5efa\u8bae","text":""},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#61","title":"6.1 \u6df7\u5408\u65b9\u6848\uff08\u63a8\u8350\uff09","text":"<p>\u5b9e\u73b0\u65b9\u5f0f\uff1a <pre><code>typedef struct {\n    uint16_t topic_id;              // \u5185\u90e8\u4f7f\u7528\u6574\u6570 ID\uff08\u9ad8\u6548\uff09\n    const char* topic_name;         // \u5916\u90e8\u4f7f\u7528\u5b57\u7b26\u4e32\uff08\u517c\u5bb9\u6027\uff09\n    // ...\n} topic_entry_t;\n\n// \u521d\u59cb\u5316\u65f6\u5efa\u7acb\u6620\u5c04\nint topic_bus_register(topic_bus_t* bus, const char* name, uint16_t* id) {\n    // \u67e5\u627e\u6216\u5206\u914d\u65b0\u7684 topic_id\n    // \u5b58\u50a8\u5b57\u7b26\u4e32\u540d\u79f0\n}\n\n// \u53d1\u5e03\u65f6\u4f7f\u7528\u6574\u6570 ID\uff08\u9ad8\u6548\uff09\nint topic_publish_event_by_id(topic_bus_t* bus, uint16_t topic_id, ...);\n\n// \u8ba2\u9605\u65f6\u4f7f\u7528\u5b57\u7b26\u4e32\uff08\u65b9\u4fbf\uff09\nint topic_subscribe_by_name(topic_bus_t* bus, const char* name, ...);\n</code></pre></p> <p>\u4f18\u70b9\uff1a - \u5185\u90e8\u4f7f\u7528\u6574\u6570 ID\uff0c\u4fdd\u6301\u9ad8\u6027\u80fd - \u5916\u90e8 API \u652f\u6301\u5b57\u7b26\u4e32\uff0c\u63d0\u4f9b\u4fbf\u5229\u6027 - \u6027\u80fd\u635f\u5931\uff1a\u4ec5\u5728\u4f7f\u7528\u5b57\u7b26\u4e32 API \u65f6\u6709\u989d\u5916\u8f6c\u6362\u5f00\u9500</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#62","title":"6.2 \u5b57\u7b26\u4e32\u54c8\u5e0c\u4f18\u5316","text":"<p>\u5b9e\u73b0\u65b9\u5f0f\uff1a <pre><code>typedef struct {\n    uint32_t topic_hash;            // \u5b57\u7b26\u4e32\u54c8\u5e0c\u503c\n    const char* topic_name;          // \u5b57\u7b26\u4e32\u540d\u79f0\n    // ...\n} topic_entry_t;\n\n// \u67e5\u627e\u65f6\u5148\u6bd4\u8f83\u54c8\u5e0c\uff0c\u518d\u6bd4\u8f83\u5b57\u7b26\u4e32\nstatic topic_entry_t* __find_topic(topic_bus_t* bus, const char* name) {\n    uint32_t hash = topic_hash(name);\n    for (size_t i = 0; i &lt; bus-&gt;max_topics; ++i) {\n        if (bus-&gt;topics[i].topic_hash == hash) {\n            // \u54c8\u5e0c\u5339\u914d\uff0c\u518d\u6bd4\u8f83\u5b57\u7b26\u4e32\uff08\u907f\u514d\u54c8\u5e0c\u51b2\u7a81\uff09\n            if (strcmp(bus-&gt;topics[i].topic_name, name) == 0) {\n                return &amp;bus-&gt;topics[i];\n            }\n        }\n    }\n    return NULL;\n}\n</code></pre></p> <p>\u6027\u80fd\u63d0\u5347\uff1a - \u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u54c8\u5e0c\u4e0d\u5339\u914d\uff0c\u76f4\u63a5\u8df3\u8fc7 - \u53ea\u6709\u54c8\u5e0c\u5339\u914d\u65f6\u624d\u8fdb\u884c\u5b57\u7b26\u4e32\u6bd4\u8f83 - \u6027\u80fd\u63d0\u5347\uff1a\u7ea6 5-10 \u500d\uff08\u4f46\u4ecd\u4e0d\u5982\u6574\u6570 ID\uff09</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#63","title":"6.3 \u5b57\u7b26\u4e32\u6c60\u4f18\u5316","text":"<p>\u5b9e\u73b0\u65b9\u5f0f\uff1a <pre><code>// \u9884\u5b9a\u4e49\u6240\u6709 Topic \u540d\u79f0\nstatic const char* TOPIC_NAME_POOL[] = {\n    \"sensor_data\",\n    \"motor_control\",\n    // ...\n};\n\n// Topic \u6761\u76ee\u5b58\u50a8\u7d22\u5f15\ntypedef struct {\n    uint16_t topic_name_idx;        // \u5b57\u7b26\u4e32\u6c60\u7d22\u5f15\n    // ...\n} topic_entry_t;\n\n// \u67e5\u627e\u65f6\u6bd4\u8f83\u7d22\u5f15\uff08O(1)\uff09\nstatic topic_entry_t* __find_topic(topic_bus_t* bus, const char* name) {\n    uint16_t idx = topic_name_to_index(name);  // \u9700\u8981\u7ef4\u62a4\u6620\u5c04\u8868\n    for (size_t i = 0; i &lt; bus-&gt;max_topics; ++i) {\n        if (bus-&gt;topics[i].topic_name_idx == idx) {\n            return &amp;bus-&gt;topics[i];\n        }\n    }\n    return NULL;\n}\n</code></pre></p> <p>\u4f18\u70b9\uff1a - \u67e5\u627e\u6027\u80fd\u63a5\u8fd1\u6574\u6570 ID - \u5185\u5b58\u5360\u7528\u8f83\u5c0f\uff08\u53ea\u9700\u5b58\u50a8\u7d22\u5f15\uff09</p> <p>\u7f3a\u70b9\uff1a - \u9700\u8981\u9884\u5148\u5b9a\u4e49\u6240\u6709 Topic - \u7075\u6d3b\u6027\u964d\u4f4e</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#7","title":"7. \u7ed3\u8bba\u4e0e\u5efa\u8bae","text":""},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#71","title":"7.1 \u6027\u80fd\u635f\u8017\u603b\u7ed3","text":"<p>\u5982\u679c\u5b8c\u5168\u91c7\u7528\u5b57\u7b26\u4e32\u5f62\u5f0f\uff1a - \u67e5\u627e\u6027\u80fd\uff1a\u4e0b\u964d\u7ea6 20 \u500d - \u5185\u5b58\u5360\u7528\uff1a\u589e\u52a0\u7ea6 12 \u500d - \u4e8b\u4ef6\u53d1\u5e03\u5ef6\u8fdf\uff1a\u589e\u52a0\u7ea6 115.8 us - \u7f13\u5b58\u6027\u80fd\uff1a\u4e0b\u964d\u7ea6 15%</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#72","title":"7.2 \u63a8\u8350\u65b9\u6848","text":"<p>\u65b9\u6848 1\uff1a\u4fdd\u6301\u6574\u6570 ID\uff08\u6700\u4f73\u6027\u80fd\uff09 - \u4f18\u70b9\uff1a\u6027\u80fd\u6700\u4f18\uff0c\u5185\u5b58\u5360\u7528\u6700\u5c0f - \u7f3a\u70b9\uff1a\u9700\u8981\u7ef4\u62a4 ID \u5230\u540d\u79f0\u7684\u6620\u5c04\uff08\u5916\u90e8\u7ef4\u62a4\uff09</p> <p>\u65b9\u6848 2\uff1a\u6df7\u5408\u65b9\u6848\uff08\u63a8\u8350\uff09 - \u5185\u90e8\u4f7f\u7528\u6574\u6570 ID\uff0c\u4fdd\u6301\u9ad8\u6027\u80fd - \u5916\u90e8 API \u652f\u6301\u5b57\u7b26\u4e32\uff0c\u63d0\u4f9b\u4fbf\u5229\u6027 - \u6027\u80fd\u635f\u5931\uff1a\u4ec5\u5728\u4f7f\u7528\u5b57\u7b26\u4e32 API \u65f6\u6709\u8f6c\u6362\u5f00\u9500</p> <p>\u65b9\u6848 3\uff1a\u5b57\u7b26\u4e32\u54c8\u5e0c\uff08\u6298\u4e2d\uff09 - \u5982\u679c\u5fc5\u987b\u4f7f\u7528\u5b57\u7b26\u4e32\uff0c\u4f7f\u7528\u54c8\u5e0c\u4f18\u5316 - \u6027\u80fd\u63d0\u5347\u7ea6 5-10 \u500d\uff0c\u4f46\u4ecd\u4e0d\u5982\u6574\u6570 ID</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#73","title":"7.3 \u9002\u7528\u573a\u666f","text":"<p>\u9002\u5408\u4f7f\u7528\u6574\u6570 ID\uff1a - \u8d44\u6e90\u53d7\u9650\u7684 MCU - \u9ad8\u9891\u4e8b\u4ef6\u53d1\u5e03\u573a\u666f - \u5b9e\u65f6\u6027\u8981\u6c42\u9ad8\u7684\u7cfb\u7edf - ISR \u8def\u5f84\u9700\u8981\u652f\u6301</p> <p>\u53ef\u4ee5\u63a5\u53d7\u5b57\u7b26\u4e32\uff1a - \u8d44\u6e90\u5145\u8db3\u7684\u7cfb\u7edf - \u4f4e\u9891\u64cd\u4f5c\u573a\u666f - \u9700\u8981\u52a8\u6001 Topic \u540d\u79f0 - \u4e0d\u9700\u8981 ISR \u652f\u6301</p>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#8","title":"8. \u6027\u80fd\u6d4b\u8bd5\u5efa\u8bae","text":"<p>\u5efa\u8bae\u5728\u5b9e\u9645\u786c\u4ef6\u4e0a\u6d4b\u8bd5\u4ee5\u4e0b\u573a\u666f\uff1a</p> <ol> <li>\u67e5\u627e\u6027\u80fd\u6d4b\u8bd5</li> <li>\u6d4b\u8bd5\u4e0d\u540c Topic \u6570\u91cf\u4e0b\u7684\u67e5\u627e\u65f6\u95f4</li> <li> <p>\u5bf9\u6bd4\u6574\u6570 ID \u548c\u5b57\u7b26\u4e32\u67e5\u627e</p> </li> <li> <p>\u4e8b\u4ef6\u53d1\u5e03\u6027\u80fd\u6d4b\u8bd5</p> </li> <li>\u6d4b\u8bd5\u9ad8\u9891\u4e8b\u4ef6\u53d1\u5e03\u7684\u5ef6\u8fdf</li> <li> <p>\u9a8c\u8bc1\u662f\u5426\u6ee1\u8db3\u5b9e\u65f6\u6027\u8981\u6c42</p> </li> <li> <p>\u5185\u5b58\u5360\u7528\u6d4b\u8bd5</p> </li> <li>\u6d4b\u91cf\u5b9e\u9645\u5185\u5b58\u5360\u7528</li> <li> <p>\u9a8c\u8bc1\u662f\u5426\u5728\u8d44\u6e90\u9650\u5236\u5185</p> </li> <li> <p>\u7f13\u5b58\u6027\u80fd\u6d4b\u8bd5</p> </li> <li>\u4f7f\u7528\u6027\u80fd\u5206\u6790\u5de5\u5177\u6d4b\u91cf\u7f13\u5b58\u547d\u4e2d\u7387</li> <li>\u8bc4\u4f30\u7f13\u5b58\u5bf9\u6027\u80fd\u7684\u5f71\u54cd</li> </ol>"},{"location":"zero_topic_core/topic_bus/topic_string_performance_analysis/#_4","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>topic_bus \u6a21\u5757\u6587\u6863</li> <li>topic_bus \u5b9e\u73b0\u4ee3\u7801</li> <li>ARM Cortex-M4 \u6027\u80fd\u53c2\u8003</li> </ul>"}]}